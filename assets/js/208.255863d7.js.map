{"version":3,"sources":["webpack:///./docs/elasticsearch-core/distributed-document/31-consistency-quorum.md","webpack:///./docs/elasticsearch-core/distributed-document/31-consistency-quorum.md?1cda","webpack:///./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106213737933.png","webpack:///./docs/elasticsearch-core/distributed-document/31-consistency-quorum.md?81e5"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAmG;AACnG;;;AAGA;AAC6F;AAC7F,gBAAgB,2GAAU;AAC1B;AACA,EAAE,+FAAM;AACR,EAAE,wGAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEe,gF;;;;;;;;;;;;ACjBf;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;ACAA,iBAAiB,qBAAuB,kE;;;;;;;;;;;;ACAxC;AAAA;AAAA;AAAA,0BAA0B,aAAa,0BAA0B,wBAAwB,qCAAqC,OAAO,gCAAgC,WAAW,OAAO,iCAAiC,UAAU,mCAAmC,oCAAoC,2EAA2E,OAAO,yBAAyB,UAAU,mCAAmC,4BAA4B,yNAAyN,8CAA8C,YAAY,gBAAgB,yBAAyB,yFAAyF,mCAAmC,aAAa,0BAA0B,ihBAAihB,OAAO,kBAAkB,UAAU,mCAAmC,qBAAqB,kjCAAkjC,mCAAmC,UAAU,iCAAiC,uHAAuH,OAAO,0EAA0E,+NAA+N,8CAA8C,YAAY,gBAAgB,yBAAyB,2MAA2M,gBAAgB,wBAAwB,gDAAgD,gBAAgB,wBAAwB,4BAA4B,gBAAgB,0BAA0B,2BAA2B,gBAAgB,wBAAwB,4BAA4B,gBAAgB,0BAA0B,2BAA2B,gBAAgB,wBAAwB,uEAAuE,gBAAgB,wBAAwB,+CAA+C,gBAAgB,wBAAwB,2CAA2C,gBAAgB,wBAAwB,0CAA0C,gBAAgB,wBAAwB,0CAA0C,gBAAgB,wBAAwB,0CAA0C,gBAAgB,wBAAwB,8CAA8C,gBAAgB,wBAAwB,mDAAmD,gBAAgB,wBAAwB,yEAAyE,gBAAgB,wBAAwB,gOAAgO,gBAAgB,wBAAwB,yCAAyC,gBAAgB,wBAAwB,gDAAgD,gBAAgB,wBAAwB,kDAAkD,gBAAgB,wBAAwB,2CAA2C,gBAAgB,wBAAwB,oDAAoD,gBAAgB,wBAAwB,+FAA+F,gBAAgB,wBAAwB,yCAAyC,gBAAgB,wBAAwB,gDAAgD,gBAAgB,wBAAwB,kDAAkD,gBAAgB,wBAAwB,2CAA2C,gBAAgB,wBAAwB,oDAAoD,gBAAgB,wBAAwB,+FAA+F,gBAAgB,wBAAwB,yCAAyC,gBAAgB,wBAAwB,gDAAgD,gBAAgB,wBAAwB,kDAAkD,gBAAgB,wBAAwB,4CAA4C,gBAAgB,wBAAwB,oDAAoD,gBAAgB,wBAAwB,6DAA6D,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,8DAA8D,OAAO,MAAM,mBAAO,CAAC,yJAAmD,YAAY;AACprO","file":"assets/js/208.255863d7.js","sourcesContent":["import { render, staticRenderFns } from \"./31-consistency-quorum.md?vue&type=template&id=195ff142&\"\nvar script = {}\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/@vuepress/core/node_modules/.cache/vuepress\\\",\\\"cacheIdentifier\\\":\\\"2e9acca5-vue-loader-template\\\"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??ref--1-1!../../../node_modules/@vuepress/markdown-loader/index.js??ref--1-2!./31-consistency-quorum.md?vue&type=template&id=195ff142&\"","module.exports = __webpack_public_path__ + \"assets/img/markdown-img-paste-20190106213737933.0531f082.png\";","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{\"slot-key\":_vm.$parent.slotKey}},[_c('h1',{attrs:{\"id\":\"图解写一致性原理以及-quorum-机制深入剖析\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#图解写一致性原理以及-quorum-机制深入剖析\"}},[_vm._v(\"#\")]),_vm._v(\" 图解写一致性原理以及 quorum 机制深入剖析\")]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"consistency-写一致性\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#consistency-写一致性\"}},[_vm._v(\"#\")]),_vm._v(\" consistency 写一致性\")]),_vm._v(\" \"),_c('p',[_vm._v(\"我们在发送任何一个增删改操作的时候，比如说 \"),_c('code',[_vm._v(\"put /index/type/id\")]),_vm._v(\"，\\n都可以带上一个 consistency 参数，指明我们想要的写一致性是什么？\")]),_vm._v(\" \"),_c('div',{staticClass:\"language-json line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-json\"}},[_c('code',[_vm._v(\"put /index/type/id?consistency=quorum\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br')])]),_c('p',[_vm._v(\"有三个可选\")]),_vm._v(\" \"),_c('ul',[_c('li',[_c('p',[_vm._v(\"one（primary shard）\")]),_vm._v(\" \"),_c('p',[_vm._v(\"要求我们这个写操作，只要有一个 primary shard 是 active 活跃可用的，就可以执行\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"all（all shard）\")]),_vm._v(\" \"),_c('p',[_vm._v(\"要求我们这个写操作，必须所有的 primary shard 和 replica shard 都是活跃的，才可以执行这个写操作\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"quorum（default）\")]),_vm._v(\" \"),_c('p',[_vm._v(\"默认的值，要求所有的 shard中，必须是大部分的 shard 都是活跃的，可用的，才可以执行这个写操作\")])])]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"quorum-机制\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#quorum-机制\"}},[_vm._v(\"#\")]),_vm._v(\" quorum 机制\")]),_vm._v(\" \"),_c('p',[_vm._v(\"写之前必须确保大多数 shard 都可用，当 \"),_c('code',[_vm._v(\"number_of_replicas>1\")]),_vm._v(\" 时才生效\")]),_vm._v(\" \"),_c('p',[_vm._v(\"计算公式：quorum = \"),_c('code',[_vm._v(\"int( (primary + number_of_replicas) / 2 ) + 1\")]),_vm._v(\"，\")]),_vm._v(\" \"),_c('p',[_vm._v(\"举个例子：3个 primary shard，number_of_replicas=1，总共有 3 + 3 * 1 = 6个 shard\")]),_vm._v(\" \"),_c('p',[_vm._v(\"quorum = int( (3 + 1) / 2 ) + 1 = 3\")]),_vm._v(\" \"),_c('p',[_vm._v(\"所以，要求 6个 shard中至少有 3个shard 是 active 状态的，才可以执行这个写操作\")]),_vm._v(\" \"),_c('p',[_vm._v(\"如果节点数少于quorum数量，可能导致quorum不齐全，进而导致无法执行任何写操作\")]),_vm._v(\" \"),_c('p',[_vm._v(\"3个 primary shard，replica=1，要求至少 3个 shard 是 active，3个 shard 按照之前学习的 shard&replica机制，必须在不同的节点上，如果说只有 2台 机器的话，是不是有可能出现说，3个 shard 都没法分配齐全，此时就可能会出现写操作无法执行的情况\")]),_vm._v(\" \"),_c('p',[_vm._v(\"es 提供了一种特殊的处理场景，就是说当 number_of_replicas>1 时才生效，因为假如说，你就一个 primary shard，replica=1，此时就 2个 shard\")]),_vm._v(\" \"),_c('p',[_vm._v(\"(1 + 1 / 2) + 1 = 2，要求必须有 2个 shard 是活跃的，但是可能就 1个 node，此时就 1个 shard是活跃的，如果你不特殊处理的话，导致我们的单节点集群就无法工作\")]),_vm._v(\" \"),_c('div',{staticClass:\"custom-block warning\"},[_c('p',{staticClass:\"custom-block-title\"},[_vm._v(\"疑问\")]),_vm._v(\" \"),_c('p',[_vm._v(\"p 和 r 不能在相同机器上。但是 r 和 r 也不能吗？\\np 和 p 可以再同一台机器上，现在是单节点，\"),_c('RouterLink',{attrs:{\"to\":\"/elasticsearch-core/quick-start-texample/06-crud.html#快速检查集群的健康状况\"}},[_vm._v(\"可以查看到他的健康状态\")]),_vm._v(\" 有 9个 p 被分配了，但是只有 3 个索引，也就是说一台机器上可以存在相同的 p ?\")],1),_vm._v(\" \"),_c('hr'),_vm._v(\" \"),_c('p',[_vm._v(\"经过测试：在同一台机器上启动两个 es 实例，9 个 pri 和 9 个 rep，都可以被完全分配，集群状态变为 green\")]),_vm._v(\" \"),_c('div',{staticClass:\"language-json line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-json\"}},[_c('code',[_vm._v(\"GET _cat/health?v\\nepoch      timestamp cluster       status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"1546783226\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"22\")]),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\":\")]),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"00\")]),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\":\")]),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"26\")]),_vm._v(\"  elasticsearch green           \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"2\")]),_vm._v(\"         \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"2\")]),_vm._v(\"     \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"18\")]),_vm._v(\"   \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"9\")]),_vm._v(\"    \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"0\")]),_vm._v(\"    \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"0\")]),_vm._v(\"        \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"0\")]),_vm._v(\"             \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"0\")]),_vm._v(\"                  -                \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"100.0\")]),_vm._v(\"%\\n\\nGET _cat/indices?v\\nhealth status index      uuid                   pri rep docs.count docs.deleted store.size pri.store.size\\ngreen  open   ecommerce  ZpGp7bIBQBaZFk9SYmbJVQ   \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"5\")]),_vm._v(\"   \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"1\")]),_vm._v(\"          \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"4\")]),_vm._v(\"            \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"0\")]),_vm._v(\"     \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"44\")]),_vm._v(\".5kb         \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"22\")]),_vm._v(\".2kb\\ngreen  open   test_index g4RJx2v8TXK95LdwlhRx5A   \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"3\")]),_vm._v(\"   \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"1\")]),_vm._v(\"          \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"8\")]),_vm._v(\"            \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"0\")]),_vm._v(\"     \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"56\")]),_vm._v(\".5kb         \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"28\")]),_vm._v(\".2kb\\ngreen  open   .kibana    id1SV_oGSjyGosKxeJApww   \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"1\")]),_vm._v(\"   \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"1\")]),_vm._v(\"          \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"1\")]),_vm._v(\"            \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"0\")]),_vm._v(\"      \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"6\")]),_vm._v(\".3kb          \"),_c('span',{pre:true,attrs:{\"class\":\"token number\"}},[_vm._v(\"3\")]),_vm._v(\".1kb\\n\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"8\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"9\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"10\")]),_c('br')])])]),_vm._v(\" \"),_c('p',[_c('img',{attrs:{\"src\":require(\"./assets/markdown-img-paste-20190106213737933.png\"),\"alt\":\"\"}})])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}