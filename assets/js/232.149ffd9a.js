(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[232],{

/***/ "./docs/posts/vuepress/nginx/README.md":
/*!*********************************************!*\
  !*** ./docs/posts/vuepress/nginx/README.md ***!
  \*********************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _README_md_vue_type_template_id_0c8e38d0___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./README.md?vue&type=template&id=0c8e38d0& */ "./docs/posts/vuepress/nginx/README.md?vue&type=template&id=0c8e38d0&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _README_md_vue_type_template_id_0c8e38d0___WEBPACK_IMPORTED_MODULE_0__["render"],
  _README_md_vue_type_template_id_0c8e38d0___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/posts/vuepress/nginx/README.md?vue&type=template&id=0c8e38d0&":
/*!****************************************************************************!*\
  !*** ./docs/posts/vuepress/nginx/README.md?vue&type=template&id=0c8e38d0& ***!
  \****************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_README_md_vue_type_template_id_0c8e38d0___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib??ref--1-1!../../../../node_modules/@vuepress/markdown-loader??ref--1-2!./README.md?vue&type=template&id=0c8e38d0& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/posts/vuepress/nginx/README.md?vue&type=template&id=0c8e38d0&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_README_md_vue_type_template_id_0c8e38d0___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_README_md_vue_type_template_id_0c8e38d0___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./docs/posts/vuepress/nginx/assets/image-20200715131405149.png":
/*!**********************************************************************!*\
  !*** ./docs/posts/vuepress/nginx/assets/image-20200715131405149.png ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/image-20200715131405149.1fbf837b.png";

/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/posts/vuepress/nginx/README.md?vue&type=template&id=0c8e38d0&":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/posts/vuepress/nginx/README.md?vue&type=template&id=0c8e38d0& ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"nginx-lua-webhook-自动化部署"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#nginx-lua-webhook-自动化部署"}},[_vm._v("#")]),_vm._v(" nginx + lua + webhook 自动化部署")]),_vm._v(" "),_c('p',[_vm._v("如果将 vuepress build 之后的静态网站部署在自己的服务器上，这里有一个自动化方案，思路如下：")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("在 linux 服务器上安装 node、yarn、git、nginx 软件")]),_vm._v(" "),_c('li',[_vm._v("编写一个脚本：用于更新 git 仓库项目，然后 build，再复制到 nginx 配置访问的文件位置")]),_vm._v(" "),_c('li',[_vm._v("使用 nginx 来作为静态网站的容器")]),_vm._v(" "),_c('li',[_vm._v("使用 nginx lua 模块提供一个调用脚本的入口")]),_vm._v(" "),_c('li',[_vm._v("在 github 上填写 webhook 地址为，调用脚本的入口地址")]),_vm._v(" "),_c('li',[_vm._v("达到：上传到 github 后，触发 webhook 事件，服务器自动构建并发布新笔记内容的功能")])]),_vm._v(" "),_c('h2',{attrs:{"id":"安装-openresty-lua-相关依赖包"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#安装-openresty-lua-相关依赖包"}},[_vm._v("#")]),_vm._v(" 安装 OpenResty + lua 相关依赖包")]),_vm._v(" "),_c('p',[_c('a',{attrs:{"href":"https://zq99299.github.io/note-book/cache-pdp/052.html","target":"_blank","rel":"noopener noreferrer"}},[_vm._v("安装 OpenResty 和 lua 入门请参考本文章"),_c('OutboundLink')],1)]),_vm._v(" "),_c('p',[_vm._v("请按该文章完成安装后，并完成  hello world lua 的测试，再继续下面的步骤")]),_vm._v(" "),_c('h2',{attrs:{"id":"nginx-执行-shell-脚本"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#nginx-执行-shell-脚本"}},[_vm._v("#")]),_vm._v(" nginx 执行 shell 脚本")]),_vm._v(" "),_c('p',[_c('a',{attrs:{"href":"https://blog.csdn.net/weixin_40429878/article/details/81908019","target":"_blank","rel":"noopener noreferrer"}},[_vm._v("本节内容参考文章"),_c('OutboundLink')],1)]),_vm._v(" "),_c('p',[_vm._v("要在 nginx 下执行 shell 脚本，主要使用以下两个软件：")]),_vm._v(" "),_c('ul',[_c('li',[_c('strong',[_vm._v("lua-resty-shell")]),_vm._v(" 模块")]),_vm._v(" "),_c('li',[_c('strong',[_vm._v("sockproc")])])]),_vm._v(" "),_c('p',[_vm._v("lua-resty-shell 通过 sockproc 去执行 shell 命令，并返回执行结果")]),_vm._v(" "),_c('h3',{attrs:{"id":"安装-sockproc"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#安装-sockproc"}},[_vm._v("#")]),_vm._v(" 安装 sockproc")]),_vm._v(" "),_c('p',[_vm._v("随意把 sockproc 安装在哪里，按你自己的习惯，只要能运行上就行")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_vm._v("git clone https"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("github"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("com"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("juce"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("sockproc\ncd sockproc\nmake\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("/sockproc "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("tmp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("shell"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("sock\nchmod "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0666")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("tmp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("shell"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("sock\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br')])]),_c('p',[_vm._v("sockproc 是一个服务器程序，侦测 unix socket 或者 tcp socket ， 并把收到的命令，传递给子进程执行，执行完毕后，把结果返回给客户端,，我们就让 sockproc 侦测 "),_c('code',[_vm._v("/tmp/shell.sock")]),_vm._v(" 的套接口有没有数据到来。")]),_vm._v(" "),_c('h3',{attrs:{"id":"安装-lua-resty-shell-模块"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#安装-lua-resty-shell-模块"}},[_vm._v("#")]),_vm._v(" 安装 lua-resty-shell 模块")]),_vm._v(" "),_c('p',[_vm._v("它是一个很小的库，配合 openresty 使用，目的是提供类似于 os.execute 或 io.popen 的功能， 唯一区别它是非阻塞的，也就是说即使需要耗时很久的命令，你也可以使用它")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 同样，在任意目录下，这里我们需要拿到仓库里面的 shell.lua 文件而已")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("git")]),_vm._v(" clone https://github.com/juce/lua-resty-shell\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" lua-resty-shell\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 把 shell.lua 文件复制到 openResty 中配置的 lualib 目录中")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 如果是按照上面教程安装的，那么我们的 lualib路径就如下")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("mkdir")]),_vm._v(" /usr/servers/lualib/resty/\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("cp")]),_vm._v(" lib/resty/shell.lua /usr/servers/lualib/resty/ \n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br')])]),_c('h3',{attrs:{"id":"测试执行-shell-脚本"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#测试执行-shell-脚本"}},[_vm._v("#")]),_vm._v(" 测试执行 shell 脚本")]),_vm._v(" "),_c('p',[_vm._v("创建一个 lua 脚本文件")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("vim")]),_vm._v(" /usr/servers/nginx/conf/test.lua\n\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" shell "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" require "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"resty.shell\"")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" args "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    socket "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"unix:/tmp/shell.sock\"")]),_vm._v(",  -- 这是第一步的 unxi socket\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" status, out, err "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" shell.execute"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"ls\"")]),_vm._v(", args"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("  -- "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ls")]),_vm._v(" 是想调用的命令,\nngx.header.content_type "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"text/plain\"")]),_vm._v("\nngx.say"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"Result:"),_c('span',{pre:true,attrs:{"class":"token entity","title":"\\n"}},[_vm._v("\\n")]),_vm._v("\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(" out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("                    -- 命令输出结果\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br')])]),_c('p',[_vm._v("修改 nginx 配置")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("vim")]),_vm._v(" /usr/servers/nginx/conf/lua.conf \n\nserver "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("  \n    listen       "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("9300")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("  \n    server_name  _"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    \n    location /lua "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("  \n      default_type "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'text/html'")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("  \n      "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# content_by_lua 'ngx.say(\"hello world\")';  ")]),_vm._v("\n      content_by_lua_file /usr/servers/nginx/conf/test.lua"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v(" \n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" \n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("  \n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br')])]),_c('p',[_vm._v("重新加载 nginx 配置文件后，访问 9300 端口，就可以看到 ls 命令执行后输出的内容了")]),_vm._v(" "),_c('h2',{attrs:{"id":"编写接受-webhook-的逻辑-lua-脚本"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#编写接受-webhook-的逻辑-lua-脚本"}},[_vm._v("#")]),_vm._v(" 编写接受 webhook 的逻辑 lua 脚本")]),_vm._v(" "),_c('p',[_vm._v("我们的这里的思路简单一点：")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("提供一个访问地址，接受 webhook 请求，请求的时候需要携带一个 token 参数")]),_vm._v(" "),_c('li',[_vm._v("在 lua 脚本中获取这个 token 参数，并校验是否自己设置的，如果不是，则直接丢弃这个请求")]),_vm._v(" "),_c('li',[_vm._v("执行笔记构建部署脚本")])]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("-- 拿一个地址来说明：http://eshop-cache03/lua?method"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("hello"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&")]),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("productId")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n-- 获取问号后面的参数列表\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" uri_args "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" ngx.req.get_uri_args"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n-- 获取参数\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" token "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" uri_args"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"token\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" checkToken "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"123456xxx\"")]),_vm._v("\n\n-- 如果没有提供 token 则输出一个 err 信息\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" not token "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("then")]),_vm._v("  \n    ngx.say"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"request error :\"")]),_vm._v(", err"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("  \n    "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("return")]),_vm._v("  \nend\n\n-- 判断是否与 token 相等\nif"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v(" token "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!=")]),_vm._v(" checkToken "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("then")]),_vm._v("\n    ngx.say"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"request error :\"")]),_vm._v(", err"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("  \n    "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("return")]),_vm._v("  \nend\n\n-- 校验通过后，执行脚本\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" shell "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" require "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"resty.shell\"")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" args "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    socket "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"unix:/tmp/shell.sock\"")]),_vm._v(", \n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" status, out, err "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" shell.execute"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"sh /xx/build.sh\"")]),_vm._v(", args"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("  \nngx.header.content_type "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"text/plain\"")]),_vm._v("\nngx.say"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"Result:"),_c('span',{pre:true,attrs:{"class":"token entity","title":"\\n"}},[_vm._v("\\n")]),_vm._v("\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(" out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" \n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br')])]),_c('p',[_vm._v("那么这个 "),_c('code',[_vm._v("/xx/build.sh")]),_vm._v(" 内容经过测试有如下的特性")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_vm._v("#"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("bin"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("bash\nll\ntouch "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("usr"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("servers"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("nginx"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("conf"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("testxxxxxxxxx\necho "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"Hello World !\"")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])]),_c('p',[_vm._v("命令会正常执行，但是只会输出  echo 打印的信息给调用处。")]),_vm._v(" "),_c('p',[_vm._v("前面验证了我们方案中的关键部分 "),_c('strong',[_vm._v("lua 执行 sh 脚本")]),_vm._v("，下面就开始真正实现自动构建")]),_vm._v(" "),_c('h2',{attrs:{"id":"vuepress-自动构建"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#vuepress-自动构建"}},[_vm._v("#")]),_vm._v(" vuepress 自动构建")]),_vm._v(" "),_c('p',[_vm._v("步骤如下：")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("安装 vuepress build 的软件环境："),_c('a',{attrs:{"href":"https://yarn.bootcss.com/docs/install/#centos-stable","target":"_blank","rel":"noopener noreferrer"}},[_vm._v("yarn"),_c('OutboundLink')],1),_vm._v(" 和 "),_c('a',{attrs:{"href":"https://github.com/zq99299/essay-note/blob/master/chapter/linux/install.md#node","target":"_blank","rel":"noopener noreferrer"}},[_vm._v("node"),_c('OutboundLink')],1)]),_vm._v(" "),_c('li',[_c('a',{attrs:{"href":"https://zq99299.github.io/note-book/posts/linux/git.html","target":"_blank","rel":"noopener noreferrer"}},[_vm._v("安装 git 软件"),_c('OutboundLink')],1),_vm._v("：用于克隆一个项目到本地，进行拉取最新的笔记内容")]),_vm._v(" "),_c('li',[_vm._v("编写构建脚本")]),_vm._v(" "),_c('li',[_vm._v("配置 nginx 访问构建好的静态网站")]),_vm._v(" "),_c('li',[_vm._v("在 Github 对应项目配置 webhook 地址到我们提供的 lua 入口")])]),_vm._v(" "),_c('h3',{attrs:{"id":"clone-项目"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#clone-项目"}},[_vm._v("#")]),_vm._v(" clone 项目")]),_vm._v(" "),_c('p',[_vm._v("把要自动部署构建的项目 clone 下来。我们的构建和发布目录都在 "),_c('code',[_vm._v("/usr/servers/notework/")]),_vm._v(" 目录下展开")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("mkdir")]),_vm._v(" -p /usr/servers/notework/gitrepo\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" /usr/servers/notework/gitrepo\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("## 在该路径下存放我们的笔记项目")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("git")]),_vm._v(" clone https://github.com/zq99299/mysql-tutorial.git\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("git")]),_vm._v(" clone https://github.com/zq99299/note-book.git\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("git")]),_vm._v(" clone https://github.com/zq99299/java-tutorial.git\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("git")]),_vm._v(" clone https://github.com/zq99299/linux-tutorial.git\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("git")]),_vm._v(" clone https://github.com/zq99299/mq-tutorial.git\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("git")]),_vm._v(" clone https://github.com/zq99299/dsalg-tutorial.git\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br')])]),_c('h3',{attrs:{"id":"编写构建脚本"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#编写构建脚本"}},[_vm._v("#")]),_vm._v(" 编写构建脚本")]),_vm._v(" "),_c('p',[_vm._v("这是一个公共的构建脚本，在调用该脚本的时候，需要把项目名传递进来")]),_vm._v(" "),_c('p',[_c('code',[_vm._v("/usr/servers/notework/build.sh")])]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token shebang important"}},[_vm._v("#!/bin/sh")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 一个工作目录，用于存放仓库、打包后部署目录")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("noteworkDir")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("/usr/servers/notework\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 笔记仓库名称，每个笔记一个，调用脚本时，将项目名传递进来")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("noteName")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$1")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 更新项目，并构建")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$noteworkDir")]),_vm._v("/gitrepo/"),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$noteName")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("git")]),_vm._v(" pull\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("yarn")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("install")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("yarn")]),_vm._v(" docs:build\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 删除构建好的包，并用新的覆盖")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("rm")]),_vm._v(" -rf "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$noteworkDir")]),_vm._v("/release/"),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$noteName")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("mkdir")]),_vm._v(" -p "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$noteworkDir")]),_vm._v("/release/"),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$noteName")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("mv")]),_vm._v(" build/.vuepress/dist/* "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$noteworkDir")]),_vm._v("/release/"),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$noteName")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br')])]),_c('p',[_vm._v("配置 nginx 访问构建好的静态网站")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("server {\n    listen       80;\n    server_name  localhost;\n\n    charset utf-8; \n\n    #access_log  logs/host.access.log  main;\n\n    location ^~ /linux-tutorial {\n        # root   /usr/servers/notework/release/linux-tutorial/;\n        alias /usr/servers/notework/release/linux-tutorial/;\n    }\n}\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br')])]),_c('p',[_vm._v("需要说明下的是：这里的 location 的配置，这个需要看你的 "),_c('code',[_vm._v("docs/.vuepress/config.js")]),_vm._v(" 中 bash 的设置，由于要部署到 githubio，这里使用了一个前缀路径。")]),_vm._v(" "),_c('p',[_vm._v("现在，可以通过 "),_c('code',[_vm._v("http://你的主机 IP/linux-tutorial/")]),_vm._v(" 访问到这个项目了。")]),_vm._v(" "),_c('h3',{attrs:{"id":"编写-lua-脚本自动构建逻辑"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#编写-lua-脚本自动构建逻辑"}},[_vm._v("#")]),_vm._v(" 编写 lua 脚本自动构建逻辑")]),_vm._v(" "),_c('p',[_vm._v("前面写了一部分，这里做一点修改")]),_vm._v(" "),_c('p',[_c('code',[_vm._v("/usr/servers/nginx/conf/noteBuild.lua")])]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("-- 拿一个地址来说明：http://eshop-cache03/lua?method"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("hello"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&")]),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("productId")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n-- 获取问号后面的参数列表\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" uri_args "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" ngx.req.get_uri_args"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n-- 获取参数\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" token "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" uri_args"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"token\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v("\n-- 这里增加一个 noteName 的参数值，需要 webhook 中回调，来构建不同的项目\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" noteName "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" uri_args"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"noteName\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v(" \n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" checkToken "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"123456xxx\"")]),_vm._v("\n\n-- 如果没有提供 token 则输出一个 err 信息\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" not token "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("then")]),_vm._v("  \n    ngx.say"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"request error token is null:\"")]),_vm._v(", err"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("  \n    "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("return")]),_vm._v("  \nend\n\n-- 判断是否与 token 相等\nif"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v(" token ~"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" checkToken "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("then")]),_vm._v("\n    ngx.say"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"request error token mismatching:\"")]),_vm._v(", err"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("  \n    "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("return")]),_vm._v("  \nend\n\n-- 检查当前笔记是否支持自动构建\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" not noteName "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("then")]),_vm._v("  \n    ngx.say"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"request error noteName is null:\"")]),_vm._v(", err"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("  \n    "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("return")]),_vm._v("  \nend\n\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" supportNotes "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"linux-tutorial\"")]),_vm._v(","),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"mysql-tutorial\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("function")]),_vm._v("  isInTable"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("value,list"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n   "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" not list "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("then")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("return")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean"}},[_vm._v("false")]),_vm._v("   \n   end \n   "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("for")]),_vm._v(" k, "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("v")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("in")]),_vm._v(" pairs"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("list"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("do")]),_vm._v("\n\t"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("v")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("==")]),_vm._v(" value "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("then")]),_vm._v("\n\t  "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("return")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean"}},[_vm._v("true")]),_vm._v("\n\tend\n   end\nend \nif"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v(" not isInTable"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("noteName,supportNotes"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("then")]),_vm._v("\n    ngx.say"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"request error noteName mismatching:\"")]),_vm._v(", err"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("  \n    "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("return")]),_vm._v("  \nend\n\n-- 校验通过后，执行脚本\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" shell "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" require "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"resty.shell\"")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" args "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    socket "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"unix:/tmp/shell.sock\"")]),_vm._v(", \n\t"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("timeout")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("120000")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n-- 不加 nohub "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("15")]),_vm._v("秒回执行超时，加了之后，貌似受上面的 "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("timeout")]),_vm._v(" 控制，不明白这一块是啥原因\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" exeStr "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"nohub sh /usr/servers/notework/build.sh \"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v("noteName\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("local")]),_vm._v(" status, out, err "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" shell.execute"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("exeStr, args"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\nngx.header.content_type "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"text/plain\"")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" out "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("then")]),_vm._v("\n ngx.say"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"Result:"),_c('span',{pre:true,attrs:{"class":"token entity","title":"\\n"}},[_vm._v("\\n")]),_vm._v("\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(" out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" \n "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("return")]),_vm._v("\nend\n\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" err "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("then")]),_vm._v("\n ngx.say"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"Result:"),_c('span',{pre:true,attrs:{"class":"token entity","title":"\\n"}},[_vm._v("\\n")]),_vm._v("\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(" err"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" \n "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("return")]),_vm._v("\nend\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("31")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("32")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("33")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("34")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("35")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("36")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("37")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("38")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("39")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("40")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("41")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("42")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("43")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("44")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("45")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("46")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("47")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("48")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("49")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("50")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("51")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("52")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("53")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("54")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("55")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("56")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("57")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("58")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("59")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("60")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("61")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("62")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("63")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("64")]),_c('br')])]),_c('p',[_c('code',[_vm._v("/usr/servers/nginx/conf/noteBuild.conf")])]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_vm._v("server "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    listen       "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("80")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("  \n    server_name  _"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    charset utf"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("-")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("8")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("  # 中文不乱码\n    \n    location "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("lua "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("  \n      default_type "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'text/html'")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("  \n      # content_by_lua "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'ngx.say(\"hello world\")'")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("  \n      content_by_lua_file "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("usr"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("servers"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("nginx"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("conf"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("/")]),_vm._v("noteBuild"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("lua"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" \n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br')])]),_c('p',[_vm._v("同样需要在 nginx.conf 中引用这个 noteBuild.conf 文件")]),_vm._v(" "),_c('p',[_c('strong',[_vm._v("注意：")]),_vm._v(" 这里的 conf 中的监听端口不能与前面配置访问静态文件的端口一致，一致的话，前面的配置将被覆盖，同样可以将调用脚本的这代码与前面访问静态文件的配置在同一个 server 中，就不会出现这种问题了")]),_vm._v(" "),_c('p',[_vm._v("配置完成之后可以简单测试下，访问地址 "),_c('code',[_vm._v("http://你的 ip/lua?token=123456xxx&noteName=linux-tutorial")]),_vm._v("，比如这个 linux-tutorial 整个构建响应信息如下")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("Result:\nAlready up to date.\nyarn install v1.22.4\n[1/4] Resolving packages...\nsuccess Already up-to-date.\nDone in 1.11s.\nyarn run v1.22.4\n$ vuepress build docs\nwait Extracting site metadata...\ntip Apply theme @vuepress/theme-default ...\ntip Apply plugin container (i.e. \"vuepress-plugin-container\") ...\ntip Apply plugin @vuepress/register-components (i.e. \"@vuepress/plugin-register-components\") ...\ntip Apply plugin @vuepress/active-header-links (i.e. \"@vuepress/plugin-active-header-links\") ...\ntip Apply plugin @vuepress/nprogress (i.e. \"@vuepress/plugin-nprogress\") ...\ntip Apply plugin smooth-scroll (i.e. \"vuepress-plugin-smooth-scroll\") ...\ntip Apply plugin @vuepress/back-to-top (i.e. \"@vuepress/plugin-back-to-top\") ...\ntip Apply plugin @vuepress/pwa (i.e. \"@vuepress/plugin-pwa\") ...\ntip Apply plugin @vuepress/medium-zoom (i.e. \"@vuepress/plugin-medium-zoom\") ...\ntip Apply plugin @vuepress/search (i.e. \"@vuepress/plugin-search\") ...\ntip Apply plugin @vssue/vssue (i.e. \"@vssue/vuepress-plugin-vssue\") ...\ntip Apply plugin code-copy (i.e. \"vuepress-plugin-code-copy\") ...\ntip Apply plugin @vuepress/last-updated (i.e. \"@vuepress/plugin-last-updated\") ...\ntip Apply plugin baidu-tongji-analytics (i.e. \"vuepress-plugin-baidu-tongji-analytics\") ...\ntip Apply plugin baidu-autopush (i.e. \"vuepress-plugin-baidu-autopush\") ...\nℹ Compiling Client\nℹ Compiling Server\n✔ Server: Compiled successfully in 53.18s\n✔ Client: Compiled successfully in 53.67s\nwait Rendering static HTML...\n\u001b[2K\u001b[1Gwait Generating service worker...\nsuccess Generated static files in build/.vuepress/dist.\n\nDone in 80.58s.\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("31")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("32")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("33")]),_c('br')])]),_c('h3',{attrs:{"id":"配置-github-webhook-地址"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#配置-github-webhook-地址"}},[_vm._v("#")]),_vm._v(" 配置 github webhook 地址")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/image-20200715131405149.png */ "./docs/posts/vuepress/nginx/assets/image-20200715131405149.png"),"alt":"image-20200715131405149"}})]),_vm._v(" "),_c('p',[_vm._v("关于上图中的 URL，换成你自己的 IP 和开放的端口，还有各种参数。")]),_vm._v(" "),_c('p',[_vm._v("之后就可以测试下，往 gitHub 上 push 一个文档的修改，看是否能触发自动构建。")]),_vm._v(" "),_c('h2',{attrs:{"id":"配置自定义域名"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#配置自定义域名"}},[_vm._v("#")]),_vm._v(" 配置自定义域名")]),_vm._v(" "),_c('p',[_vm._v("本人的 DNS 在万网，完全的网址重定向，只能在万网的机器才可以，所以只能使用转发到一个 IP 上，所以笔记访问端口就只能是 80 端口了，其他的端口不支持配置。")]),_vm._v(" "),_c('p',[_vm._v("下面是修改后的配置")]),_vm._v(" "),_c('p',[_c('code',[_vm._v("/usr/servers/nginx/conf/nginx.conf")])]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("worker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#pid        logs/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    lua_package_path \"/usr/servers/lualib/?.lua;;\";  \n    lua_package_cpath \"/usr/servers/lualib/?.so;;\"; \n    # include noteBuild.conf; \n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    server {\n        listen       80;\n        server_name  _;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n        \n        # 将 github webhook 调用的入口移动到这里来了，公用一个域名\n        location /note-auto-build {  \n          default_type 'text/html';    \n          content_by_lua_file /usr/servers/nginx/conf/noteBuild.lua;\n        } \n\n        # 有几个笔记项目就写几个指向\n        location ^~ /linux-tutorial {\n          alias /usr/servers/notework/release/linux-tutorial/;\n        }\n    }\n    \n    # 这个是针对不同域名的配置\n    # 我这里给每一个笔记项目都配置了一个二级域名\n    server {\n      server_name linux-tutorial.mrcode.cn;\n      listen 80;\n      # 这个是能访问到 index.html 文件\n      location / {\n          alias /usr/servers/notework/release/linux-tutorial/;\n      }\n      # 这里是兼容有前缀的 css 等资源下载，由于我们的 .vuepress/config.js base 中配置了前缀\n      # 要同时兼容能推送到 githubio 上，这里就只能这样曲线救国了\n      # 实现的效果就是访问 inux-tutorial.mrcode.cn ,就能正常阅读\n      location ^~ /linux-tutorial {\n          alias /usr/servers/notework/release/linux-tutorial/;\n      }\n    }\n}\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("31")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("32")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("33")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("34")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("35")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("36")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("37")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("38")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("39")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("40")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("41")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("42")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("43")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("44")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("45")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("46")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("47")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("48")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("49")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("50")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("51")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("52")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("53")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("54")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("55")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("56")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("57")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("58")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("59")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("60")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("61")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("62")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("63")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("64")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("65")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("66")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("67")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("68")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("69")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("70")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("71")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("72")]),_c('br')])]),_c('p',[_vm._v("关于上面的配置，按照你自己的需求来组织是否给二级域名，还是一个域名就全部搞定")])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=232.149ffd9a.js.map