(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[236],{

/***/ "./docs/spring-cloud-tutorial/config/009.md":
/*!**************************************************!*\
  !*** ./docs/spring-cloud-tutorial/config/009.md ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _009_md_vue_type_template_id_1deebfee___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./009.md?vue&type=template&id=1deebfee& */ "./docs/spring-cloud-tutorial/config/009.md?vue&type=template&id=1deebfee&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _009_md_vue_type_template_id_1deebfee___WEBPACK_IMPORTED_MODULE_0__["render"],
  _009_md_vue_type_template_id_1deebfee___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/spring-cloud-tutorial/config/009.md?vue&type=template&id=1deebfee&":
/*!*********************************************************************************!*\
  !*** ./docs/spring-cloud-tutorial/config/009.md?vue&type=template&id=1deebfee& ***!
  \*********************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_009_md_vue_type_template_id_1deebfee___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib??ref--1-1!../../../node_modules/@vuepress/markdown-loader??ref--1-2!./009.md?vue&type=template&id=1deebfee& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/spring-cloud-tutorial/config/009.md?vue&type=template&id=1deebfee&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_009_md_vue_type_template_id_1deebfee___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_009_md_vue_type_template_id_1deebfee___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./docs/spring-cloud-tutorial/config/assets/markdown-img-paste-2019062218081305.png":
/*!******************************************************************************************!*\
  !*** ./docs/spring-cloud-tutorial/config/assets/markdown-img-paste-2019062218081305.png ***!
  \******************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-2019062218081305.4c7ad7cd.png";

/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/spring-cloud-tutorial/config/009.md?vue&type=template&id=1deebfee&":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/spring-cloud-tutorial/config/009.md?vue&type=template&id=1deebfee& ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"spring-cloud-config-client"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#spring-cloud-config-client"}},[_vm._v("#")]),_vm._v(" Spring Cloud Config Client")]),_vm._v(" "),_c('p',[_vm._v("Spring boot 程序可以立即利用 Spring config server(或应用程序开发人员提供的其他外部属性源)。它还获得了一些与环境更改事件相关的其他有用特性。")]),_vm._v(" "),_c('h2',{attrs:{"id":"直连配置服务器模式-config-first-bootstrap"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#直连配置服务器模式-config-first-bootstrap"}},[_vm._v("#")]),_vm._v(" 直连配置服务器模式 / Config First Bootstrap")]),_vm._v(" "),_c('p',[_vm._v("客户端程序在类路径下包含 Spring Cloud Config Client 时，它的默认行为如下：\n当客户端启动时，自动绑定到 config server（通过 spring.cloud.config.uri 配置）并使用远程属性源初始化 spring Environment")]),_vm._v(" "),_c('p',[_vm._v("这种行为的最终结果是，所有希望使用配置服务器的客户机应用程序都需要一个 bootstrap.yml (或 environment variable，这个环境变量到现在我都不知道是什么东西)，\n可以通过 "),_c('code',[_vm._v("spring.cloud.config.uri")]),_vm._v(" 来配置 config server 地址，默认地址是 "),_c('code',[_vm._v("http://localhost:8888")])]),_vm._v(" "),_c('p',[_vm._v("添加 spring-cloud-starter-config 依赖")]),_vm._v(" "),_c('div',{staticClass:"language-groovy line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-groovy"}},[_c('code',[_vm._v("implementation "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'org.springframework.cloud:spring-cloud-starter-config'")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 下面的依赖在快速开始里面讲解过")]),_vm._v("\nimplementation "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'org.springframework.boot:spring-boot-starter-web'")]),_vm._v("\nimplementation "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'org.springframework.boot:spring-boot-starter-actuator'")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])]),_c('p',[_vm._v("在 bootstrap.yml 中配置 配置中心的地址")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("spring")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("application")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("name")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" config"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("client  "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 默认名称为 application")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("profiles")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("active")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" dev\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("cloud")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("config")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("uri")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" http"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("//localhost"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("11000")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br')])]),_c('h2',{attrs:{"id":"服务发现模式-discovery-first-bootstrap"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#服务发现模式-discovery-first-bootstrap"}},[_vm._v("#")]),_vm._v(" 服务发现模式 / Discovery First Bootstrap")]),_vm._v(" "),_c('p',[_vm._v("如果您使用 DiscoveryClient 实现，比如 Spring Cloud Netflix 和 Eureka Service Discovery 或 Spring Cloud Consul，\n您可以让配置服务器注册到注册中心。但是，在 Config First 模式下，客户端就不能通过服务注册中心来发现配置服务器")]),_vm._v(" "),_c('p',[_vm._v("客户端：bootstrap.yml")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("spring")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("cloud")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("config")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("discovery")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("enabled")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean important"}},[_vm._v("true")]),_vm._v("  "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 默认值是关闭的")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("service-id")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" config"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("server  "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 默认值是 configserver，配置中心的服务 ID，也就是 spring.application.name")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br')])]),_c('p',[_vm._v("如果配置服务器使用了 HTTP Basic 保护的，则可以通过 eureka 元数据进行配置，让客户端能正常连接上")]),_vm._v(" "),_c('p',[_vm._v("配置服务：bootstrap.yml")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("eureka")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("instance")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("...")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("metadataMap")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# Http Basic 所需要的用户名和密码")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("user")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" osufhalskjrtl\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("password")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" lviuhlszvaorhvlo5847\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("configPath")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" /config  "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 如果配置中心有项目名称（学名称为上下文路径），可以通过该属性指定")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br')])]),_c('p',[_vm._v("这样配置之后，客户端通过服务注册中心获取到配置服务信息，并通过这个信息链接上配置服务。\n这样就多了一次网络开销，但是带来的好处是，配置中心可以更改自己的坐标（如 ip 地址，上下文路径等）、 而客户端在最差的情况下，只需要重启即可")]),_vm._v(" "),_c('h2',{attrs:{"id":"配置客户端快速失败-config-client-fail-fast"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#配置客户端快速失败-config-client-fail-fast"}},[_vm._v("#")]),_vm._v(" 配置客户端快速失败 / Config Client Fail Fast")]),_vm._v(" "),_c('p',[_vm._v("在某些情况下，如果服务无法连接到配置服务器，则可能希望启动失败。\n可以通过以下属性，假如不能连接到配置服务器则抛出异常\n"),_c('code',[_vm._v("java.lang.IllegalStateException: Could not locate PropertySource and the fail fast property is set, failing")]),_vm._v("\n项目启动失败；为 false 则不能连接到配置中心项目也可以启动成功")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("spring")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("cloud")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("config")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("failFast")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean important"}},[_vm._v("true")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])]),_c('h2',{attrs:{"id":"配置客户端重试-config-client-retry"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#配置客户端重试-config-client-retry"}},[_vm._v("#")]),_vm._v(" 配置客户端重试 / Config Client Retry")]),_vm._v(" "),_c('p',[_vm._v("希望开启重试机制需要满足以下 2 点：")]),_vm._v(" "),_c('ol',[_c('li',[_c('code',[_vm._v("spring.cloud.config.fail-fast=true")])]),_vm._v(" "),_c('li',[_vm._v("添加依赖\n"),_c('ul',[_c('li',[_c('code',[_vm._v("'org.springframework.boot:spring-boot-starter-aop'")])]),_vm._v(" "),_c('li',[_c('code',[_vm._v("org.springframework.retry:spring-retry")])])])])]),_vm._v(" "),_c('p',[_vm._v("默认行为是重试 6 次，初始重试间隔为 1000ms，后续间隔的指数乘数为 1.1。")]),_vm._v(" "),_c('p',[_vm._v("可以通过 "),_c('code',[_vm._v("spring.cloud.config.retry.* configuration")]),_vm._v(" 定制重试")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("cloud:\n  config:\n    retry:\n      initial-interval: 10000\n      max-interval: 20000\n      max-attempts: 10\n      multiplier: 1.2\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br')])]),_c('p',[_vm._v("要完全控制重试行为，可以提供一个 RetryOperationsInterceptor")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_vm._v("该段代码是 自动配置里面的，也就是默认重试机制里面的声明，我们只要模仿这个提供即可\n"),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@Bean")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@ConditionalOnMissingBean")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("name "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"configServerRetryInterceptor\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("RetryOperationsInterceptor")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("configServerRetryInterceptor")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("RetryProperties")]),_vm._v(" properties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("RetryInterceptorBuilder")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("stateless")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("backOffOptions")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("properties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getInitialInterval")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("\n          properties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getMultiplier")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" properties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getMaxInterval")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("maxAttempts")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("properties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getMaxAttempts")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("build")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br')])]),_c('h2',{attrs:{"id":"定位远程配置资源"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#定位远程配置资源"}},[_vm._v("#")]),_vm._v(" 定位远程配置资源")]),_vm._v(" "),_c('p',[_vm._v("服务端使用端点 "),_c('code',[_vm._v("/{name}/{profile}/{label}")]),_vm._v(" 提供属性源服务，其中客户端应用程序的默认绑定如下:")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("\"name\" = "),_c('code',[_vm._v("${spring.application.name}")])]),_vm._v(" "),_c('li',[_vm._v("\"profile\" = "),_c('code',[_vm._v("${spring.profiles.active}")]),_vm._v(" (实际上是通过 Environment.getActiveProfiles() 获取的)")]),_vm._v(" "),_c('li',[_vm._v("\"label\" = \"master\"")])]),_vm._v(" "),_c('div',{staticClass:"custom-block tip"},[_c('p',{staticClass:"custom-block-title"},[_vm._v("TIP")]),_vm._v(" "),_c('p',[_vm._v("在配置 "),_c('code',[_vm._v("${spring.application.name}")]),_vm._v(" 时，不要使用暴露前缀 "),_c('code',[_vm._v("application-")]),_vm._v("，否则有可能出现找不到资源的问题")])]),_vm._v(" "),_c('p',[_vm._v("可以通过配置覆盖默认值，"),_c('code',[_vm._v("spring.cloud.config.*")]),_vm._v(" （ "),_c('code',[_vm._v("*")]),_vm._v(" 可以是 name, profile or label）；\nlabel 对于回滚到以前版本的配置非常有用。使用默认的配置服务实现，label 的值可以是")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("git label")]),_vm._v(" "),_c('li',[_vm._v("branch name")]),_vm._v(" "),_c('li',[_vm._v("commit ID")])]),_vm._v(" "),_c('p',[_vm._v("同时 label 也可以使用逗号分隔提供多个值。在这种情况下，列表中的项将逐一尝试，直到成功为止。在处理特性分支时，此行为可能非常有用。比如你希望通过 label 配置分支名称 "),_c('code',[_vm._v("spring.cloud.config.label=myfeature,develop")])]),_vm._v(" "),_c('h2',{attrs:{"id":"配置服务的高可用性"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#配置服务的高可用性"}},[_vm._v("#")]),_vm._v(" 配置服务的高可用性")]),_vm._v(" "),_c('p',[_vm._v("如果部署了多个配置服务，那么客户端需要提供多个配置中心的地址信息，\n才能做到当其中一个或多个配置服务不可用时，具有高可用性")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("Config First 模式下可以使用 "),_c('code',[_vm._v("spring.cloud.config.uri")]),_vm._v(" 用逗号分隔方式提供多个地址")]),_vm._v(" "),_c('li',[_vm._v("Discovery-First 模式下，需要将所有配置服务都注册到服务注册中心")])]),_vm._v(" "),_c('p',[_vm._v("注意：只有在配置服务器不运行时(即应用程序退出时)或连接超时时，这样做才能确保高可用性。例如，如果配置服务器返回 500(内部服务器错误)响应，或者配置客户端从配置服务器接收 401(由于糟糕的凭证或其他原因)，配置客户端不会尝试从其他 url 获取属性。这种错误表示用户问题，而不是可用性问题。")]),_vm._v(" "),_c('p',[_vm._v("配置服务如果使用 HTTP basic 方式进行安全保护那么需要将用户名和密码嵌入到每个 uri 地址中；如果使用任何其他类型的安全机制，则无法(目前)支持每配置服务器身份验证和授权。")]),_vm._v(" "),_c('p',[_vm._v("怎么内嵌用户名和密码到 uri 中，后面章节会讲解")]),_vm._v(" "),_c('h2',{attrs:{"id":"配置读取超时"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#配置读取超时"}},[_vm._v("#")]),_vm._v(" 配置读取超时")]),_vm._v(" "),_c('p',[_vm._v("如果想配置读取超时，可以使用 "),_c('code',[_vm._v("spring.cloud.config.request-read-timeout")]),_vm._v(" 属性，以毫秒为单位，默认值 0（不超时）")]),_vm._v(" "),_c('h2',{attrs:{"id":"安全-security"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#安全-security"}},[_vm._v("#")]),_vm._v(" 安全 / Security")]),_vm._v(" "),_c('p',[_vm._v("如果是使用  HTTP Basic security 来保护 config server，客户端需要知道用户名和密码，可以通过以下方式指定")]),_vm._v(" "),_c('p',[_vm._v("bootstrap.yml")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("spring")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("cloud")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("config")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("uri")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" http"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("//user"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("123456@localhost"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("11000")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 多个配置服务实例可以使用逗号分隔")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# uri: http://user:123456@localhost:11000,http://user:123456@localhost:11003")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br')])]),_c('p',[_vm._v("这里为了测试方便，简单说下服务端的配置，默认密码是随机的，这里需要修改为固定的")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("spring")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("security")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("user")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("name")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" user\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("password")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("123456")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br')])]),_c('p',[_vm._v("下面例子可以配置所有 uri 的用户名和密码为同一个")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("spring")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("cloud")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("config")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("uri")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" http"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("//user"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("123456@localhost"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("11000")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("http"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("//user"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("0123@localhost"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("11003")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("username")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" user\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("password")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("123456")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br')])]),_c('p',[_vm._v("uri 中的用户名和密码配置会被覆盖")]),_vm._v(" "),_c('p',[_vm._v("如果你使用的是其他的安全认证方式，就需要为 ConfigServicePropertySourceLocator（环境定位(可能是远程)属性源的策略） 提供一个 "),_c('RouterLink',{attrs:{"to":"/spring-cloud-tutorial/config/009.html#提供自定义-resttemplate"}},[_vm._v("RestTemplate")]),_vm._v(" 实现，并注入到 spring boot 上下文中")],1),_vm._v(" "),_c('h3',{attrs:{"id":"健康指示器-health-indicator"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#健康指示器-health-indicator"}},[_vm._v("#")]),_vm._v(" 健康指示器 / Health Indicator")]),_vm._v(" "),_c('p',[_vm._v("客户机通过 "),_c('code',[_vm._v("org.springframework.boot:spring-boot-starter-actuator")]),_vm._v(" 尝试从配置服务器加载配置（这里也作解释了之前搭建客户机时为什么需要添加一个 actuator 的依赖了）。")]),_vm._v(" "),_c('p',[_vm._v("可以通过 "),_c('code',[_vm._v("health.config.enabled=false")]),_vm._v(" 关闭指示器")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-2019062218081305.png */ "./docs/spring-cloud-tutorial/config/assets/markdown-img-paste-2019062218081305.png"),"alt":""}})]),_vm._v(" "),_c('p',[_vm._v("通过尝试，发现关闭之后，只是这个状态没有了，那么健康指示器应该只是用于检查健康状态的。")]),_vm._v(" "),_c('p',[_vm._v("出于性能原因，还缓存了响应。默认的缓存存活时间是 5分钟。要更改该值，请设置 "),_c('code',[_vm._v("health.config.time-to-live")]),_vm._v("。属性(以毫秒为单位)。")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("health")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("config")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("enabled")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean important"}},[_vm._v("true")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("time-to-live")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("50000")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 健康结果缓存 5 分钟")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])]),_c('h3',{attrs:{"id":"提供自定义-resttemplate"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#提供自定义-resttemplate"}},[_vm._v("#")]),_vm._v(" 提供自定义 RestTemplate")]),_vm._v(" "),_c('p',[_vm._v("在某些情况下，您可能需要自定义从客户机向配置服务器发出的请求。通常，这样做需要传递特殊的授权头来对服务器的请求进行身份验证。要提供自定义 RestTemplate:")]),_vm._v(" "),_c('p',[_vm._v("第一步：创建一个绑定了自定义 RestTemplate 的 PropertySourceLocator 实例")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("package")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("cn"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("mrcode"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("example"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("spring"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("cloud"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("tutorial"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("config"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("configclient")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("cloud"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("config"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigClientProperties")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("cloud"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("config"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigServicePropertySourceLocator")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("context"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("annotation"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Bean")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("context"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("annotation"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Configuration")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("/**\n * @author : zhuqiang\n * @date : 2019/6/22 18:11\n */")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@Configuration")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("class")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CustomConfigServiceBootstrapConfiguration")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@Bean")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigServicePropertySourceLocator")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("configServicePropertySourceLocator")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// ConfigClientProperties 配置属性就是 spring.cloud.config 下的配置实现类")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigClientProperties")]),_vm._v(" clientProperties "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("configClientProperties")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigServicePropertySourceLocator")]),_vm._v(" configServicePropertySourceLocator "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigServicePropertySourceLocator")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("clientProperties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// org.springframework.cloud.config.client.ConfigServicePropertySourceLocator.getSecureRestTemplate")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 提供了一个 SecureRestTemplate 的实现，可以模仿这个")]),_vm._v("\n        configServicePropertySourceLocator"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("setRestTemplate")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("customRestTemplate")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("clientProperties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" configServicePropertySourceLocator"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br')])]),_c('p',[_vm._v("第二步：在 "),_c('code',[_vm._v("resources/META-INF")]),_vm._v(" 下创建 "),_c('code',[_vm._v("spring.factories")]),_vm._v(" 并提供自定义配置")]),_vm._v(" "),_c('p',[_vm._v("spring.factories")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("org.springframework.cloud.bootstrap.BootstrapConfiguration = cn.mrcode.example.spring.cloud.tutorial.config.configclient.CustomConfigServiceBootstrapConfiguration\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br')])]),_c('p',[_vm._v("下面是复制源码中的 org.springframework.cloud.config.client.ConfigServicePropertySourceLocator#getSecureRestTemplate 实现。")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("package")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("cn"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("mrcode"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("example"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("spring"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("cloud"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("tutorial"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("config"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("configclient")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("beans"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("factory"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("annotation"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Autowired")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("cloud"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("config"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigClientProperties")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("cloud"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("config"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigServicePropertySourceLocator")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("context"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("annotation"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Bean")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("context"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("annotation"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Configuration")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("http"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ClientHttpRequestInterceptor")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("http"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("SimpleClientHttpRequestFactory")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("web"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("RestTemplate")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("java"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("util"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Arrays")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("java"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("util"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("HashMap")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("java"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("util"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Map")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("static")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("cloud"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("config"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigClientProperties")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("AUTHORIZATION"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("/**\n * @author : zhuqiang\n * @date : 2019/6/22 18:11\n */")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@Configuration")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("class")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CustomConfigServiceBootstrapConfiguration")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@Autowired")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("private")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigClientProperties")]),_vm._v(" configClientProperties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@Bean")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigServicePropertySourceLocator")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("configServicePropertySourceLocator")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// ConfigClientProperties 配置属性就是 spring.cloud.config 下的配置实现类")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigClientProperties")]),_vm._v(" clientProperties "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("configClientProperties")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigServicePropertySourceLocator")]),_vm._v(" configServicePropertySourceLocator "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigServicePropertySourceLocator")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("clientProperties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// org.springframework.cloud.config.client.ConfigServicePropertySourceLocator.getSecureRestTemplate")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 提供了一个 SecureRestTemplate 的实现，可以模仿这个")]),_vm._v("\n        configServicePropertySourceLocator"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("setRestTemplate")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("customRestTemplate")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("clientProperties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" configServicePropertySourceLocator"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("private")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigClientProperties")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("configClientProperties")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" configClientProperties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("private")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("RestTemplate")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("customRestTemplate")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigClientProperties")]),_vm._v(" client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("SimpleClientHttpRequestFactory")]),_vm._v(" requestFactory "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("SimpleClientHttpRequestFactory")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getRequestReadTimeout")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("throw")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("IllegalStateException")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"Invalid Value for Read Timeout set.\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n        requestFactory"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("setReadTimeout")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getRequestReadTimeout")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("RestTemplate")]),_vm._v(" template "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("RestTemplate")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("requestFactory"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Map")]),_c('span',{pre:true,attrs:{"class":"token generics"}},[_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("<")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(">")])]),_vm._v(" headers "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("HashMap")]),_c('span',{pre:true,attrs:{"class":"token generics"}},[_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("<")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(">")])]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("client"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getHeaders")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("headers"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("containsKey")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("AUTHORIZATION"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            headers"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("remove")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("AUTHORIZATION"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// To avoid redundant addition of header")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v("headers"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("isEmpty")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            template"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("setInterceptors")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Arrays")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token generics"}},[_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("<")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ClientHttpRequestInterceptor")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(">")])]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("asList")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("\n                    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ConfigServicePropertySourceLocator"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("GenericRequestHeaderInterceptor")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("headers"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" template"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("31")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("32")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("33")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("34")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("35")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("36")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("37")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("38")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("39")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("40")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("41")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("42")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("43")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("44")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("45")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("46")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("47")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("48")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("49")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("50")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("51")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("52")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("53")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("54")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("55")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("56")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("57")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("58")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("59")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("60")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("61")]),_c('br')])]),_c('p',[_vm._v("测试过可以正常使用，但是目前还是不了解 RestTemplate 在这充当上面角色功能，请求流程是上面样子的，所以不知道怎么利用这个之定义配置来实现自己的其他授权")])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=236.6a077fd9.js.map