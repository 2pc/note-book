(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[250],{

/***/ "./docs/cache-pdp/044.md":
/*!*******************************!*\
  !*** ./docs/cache-pdp/044.md ***!
  \*******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _044_md_vue_type_template_id_e44bab72___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./044.md?vue&type=template&id=e44bab72& */ "./docs/cache-pdp/044.md?vue&type=template&id=e44bab72&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _044_md_vue_type_template_id_e44bab72___WEBPACK_IMPORTED_MODULE_0__["render"],
  _044_md_vue_type_template_id_e44bab72___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/cache-pdp/044.md?vue&type=template&id=e44bab72&":
/*!**************************************************************!*\
  !*** ./docs/cache-pdp/044.md?vue&type=template&id=e44bab72& ***!
  \**************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_044_md_vue_type_template_id_e44bab72___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib??ref--1-1!../../node_modules/@vuepress/markdown-loader??ref--1-2!./044.md?vue&type=template&id=e44bab72& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/044.md?vue&type=template&id=e44bab72&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_044_md_vue_type_template_id_e44bab72___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_044_md_vue_type_template_id_e44bab72___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/044.md?vue&type=template&id=e44bab72&":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/cache-pdp/044.md?vue&type=template&id=e44bab72& ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"_044-库存服务代码调试以及打印日志观察服务的运行流程是否正确"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#_044-库存服务代码调试以及打印日志观察服务的运行流程是否正确"}},[_vm._v("#")]),_vm._v(" 044. 库存服务代码调试以及打印日志观察服务的运行流程是否正确")]),_vm._v(" "),_c('p',[_vm._v("创建数据库 product_inventory，两个字段 Integer product_id、Long inventory_cnt")]),_vm._v(" "),_c('p',[_vm._v("测试场景：")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("一个写请求：")]),_vm._v(" "),_c('li',[_vm._v("写请求模拟耗时操作：休眠 10 秒")]),_vm._v(" "),_c('li',[_vm._v("在写休眠中，来一个读请求")])]),_vm._v(" "),_c('p',[_vm._v("观察日志，是否按照预想流程和结果进行；")]),_vm._v(" "),_c('p',[_vm._v("在这之前，需要再关键位置添加日志打印，笔记就不贴代码了；")]),_vm._v(" "),_c('p',[_vm._v("在数据库插入一条数据")]),_vm._v(" "),_c('div',{staticClass:"language-sql line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-sql"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("INSERT")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("INTO")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("`")]),_vm._v("eshop"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("`")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("`")]),_vm._v("product_inventory"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("`")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("`")]),_vm._v("product_id"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("`")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("`")]),_vm._v("inventory_cnt"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("`")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("VALUES")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'1'")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'100'")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br')])]),_c('h2',{attrs:{"id":"redis-中无数据情况下"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#redis-中无数据情况下"}},[_vm._v("#")]),_vm._v(" redis 中无数据情况下")]),_vm._v(" "),_c('p',[_vm._v("在以上场景的基础下，先来模拟 redis 中无数据的情况下的流程是否正确，因为刚好往数据库中增加了数据，还没有往 redis 中增加数据。 正好测试这个场景")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("// 写请求\nhttp://localhost:6001/updateProductInventory?productId=1&inventoryCnt=99\n// 读请求\nhttp://localhost:6001/getProductInventory?productId=1\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])]),_c('p',[_vm._v("日志信息")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("2019-04-06 20:55:16.257  INFO 9420 --- [nio-6001-exec-1] c.m.c.e.i.w.ProductInventoryController   : 更新商品库存请求：商品id=1，库存=99\n2019-04-06 20:55:16.258  INFO 9420 --- [nio-6001-exec-1] c.e.i.s.i.RequestAsyncProcessServiceImpl : 路由信息：key=1,商品 ID =1,队列 index=1\n2019-04-06 20:55:16.375  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 处理请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 20:55:16.376  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 写请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 20:55:16.440  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 已删除缓存：商品 ID=1\n2019-04-06 20:55:16.440  INFO 9420 --- [pool-1-thread-2] .c.e.i.r.ProductInventoryDBUpdateRequest : 写请求：模拟写耗时操作，休眠 10 秒钟\n// 上面开始模拟耗时操作了\n2019-04-06 20:55:17.970  INFO 9420 --- [nio-6001-exec-2] c.m.c.e.i.w.ProductInventoryController   : 读取商品库存请求：商品id=1\n2019-04-06 20:55:17.971  INFO 9420 --- [nio-6001-exec-2] c.e.i.s.i.RequestAsyncProcessServiceImpl : 路由信息：key=1,商品 ID =1,队列 index=1\n2019-04-06 20:55:18.190  INFO 9420 --- [nio-6001-exec-2] c.m.c.e.i.w.ProductInventoryController   : 超时 200 毫秒退出尝试，商品 ID=1\n2019-04-06 20:55:18.190  INFO 9420 --- [nio-6001-exec-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 数据库获取商品，商品 ID=1\n// 等待超时，并从数据库获取，获取到了 100 的库存\n2019-04-06 20:55:18.234  INFO 9420 --- [nio-6001-exec-2] c.m.c.e.i.w.ProductInventoryController   : 缓存未命中，在数据库中查找，商品 ID=1，结果={\"inventoryCnt\":100,\"productId\":1}\n2019-04-06 20:55:18.234  INFO 9420 --- [nio-6001-exec-2] c.e.i.s.i.RequestAsyncProcessServiceImpl : 路由信息：key=1,商品 ID =1,队列 index=1\n2019-04-06 20:55:26.497  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 已更新数据库：商品 ID=1，库存=99\n// 写完成之后，开始读请求的处理\n2019-04-06 20:55:26.499  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 处理请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 20:55:26.499  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 读请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 20:55:26.499  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 1+1 达成，1 写 1 读：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 20:55:26.499  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 数据库获取商品，商品 ID=1\n2019-04-06 20:55:26.503  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 设置缓存：{\"inventoryCnt\":99,\"productId\":1}\n// 下面的是强制刷新缓存，由于前面耗时操作，导致直接读库并强制刷新缓存操作\n2019-04-06 20:55:26.515  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 处理请求：{\"forceRfresh\":true,\"productId\":1}\n2019-04-06 20:55:26.515  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 数据库获取商品，商品 ID=1\n2019-04-06 20:55:26.523  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 设置缓存：{\"inventoryCnt\":99,\"productId\":1}\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br')])]),_c('h2',{attrs:{"id":"基于缓存中有库存测试"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#基于缓存中有库存测试"}},[_vm._v("#")]),_vm._v(" 基于缓存中有库存测试")]),_vm._v(" "),_c('p',[_vm._v("与上面例子一样，只不过通过了一次测试，现在缓存中有数据了，再继续执行相同的测试操作，观察日志,\n库存由 99 变成 98")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("// 写请求\nhttp://localhost:6001/updateProductInventory?productId=1&inventoryCnt=98\n// 读请求\nhttp://localhost:6001/getProductInventory?productId=1\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])]),_c('p',[_vm._v("日志输出")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("2019-04-06 21:03:00.913  INFO 9420 --- [nio-6001-exec-6] c.m.c.e.i.w.ProductInventoryController   : 更新商品库存请求：商品id=1，库存=98\n2019-04-06 21:03:00.913  INFO 9420 --- [nio-6001-exec-6] c.e.i.s.i.RequestAsyncProcessServiceImpl : 路由信息：key=1,商品 ID =1,队列 index=1\n2019-04-06 21:03:00.913  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 处理请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:03:00.913  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 写请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:03:00.924  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 已删除缓存：商品 ID=1\n2019-04-06 21:03:00.924  INFO 9420 --- [pool-1-thread-2] .c.e.i.r.ProductInventoryDBUpdateRequest : 写请求：模拟写耗时操作，休眠 10 秒钟\n2019-04-06 21:03:02.925  INFO 9420 --- [nio-6001-exec-7] c.m.c.e.i.w.ProductInventoryController   : 读取商品库存请求：商品id=1\n2019-04-06 21:03:02.925  INFO 9420 --- [nio-6001-exec-7] c.e.i.s.i.RequestAsyncProcessServiceImpl : 路由信息：key=1,商品 ID =1,队列 index=1\n2019-04-06 21:03:03.147  INFO 9420 --- [nio-6001-exec-7] c.m.c.e.i.w.ProductInventoryController   : 超时 200 毫秒退出尝试，商品 ID=1\n2019-04-06 21:03:03.147  INFO 9420 --- [nio-6001-exec-7] .m.c.e.i.s.i.ProductInventoryServiceImpl : 数据库获取商品，商品 ID=1\n2019-04-06 21:03:03.159  INFO 9420 --- [nio-6001-exec-7] c.m.c.e.i.w.ProductInventoryController   : 缓存未命中，在数据库中查找，商品 ID=1，结果={\"inventoryCnt\":99,\"productId\":1}\n2019-04-06 21:03:03.159  INFO 9420 --- [nio-6001-exec-7] c.e.i.s.i.RequestAsyncProcessServiceImpl : 路由信息：key=1,商品 ID =1,队列 index=1\n2019-04-06 21:03:10.937  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 已更新数据库：商品 ID=1，库存=98\n2019-04-06 21:03:10.938  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 处理请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:03:10.938  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 读请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:03:10.938  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 1+1 达成，1 写 1 读：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:03:10.938  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 数据库获取商品，商品 ID=1\n2019-04-06 21:03:10.945  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 设置缓存：{\"inventoryCnt\":98,\"productId\":1}\n2019-04-06 21:03:10.957  INFO 9420 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 处理请求：{\"forceRfresh\":true,\"productId\":1}\n2019-04-06 21:03:10.957  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 数据库获取商品，商品 ID=1\n2019-04-06 21:03:10.962  INFO 9420 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 设置缓存：{\"inventoryCnt\":98,\"productId\":1}\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br')])]),_c('p',[_vm._v("对于在 200 毫秒内无法返回的数据，无论 redis 中是否存在初始库存数据，流程都一样")]),_vm._v(" "),_c('h2',{attrs:{"id":"基于-200-毫秒内返回写操作完成测试"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#基于-200-毫秒内返回写操作完成测试"}},[_vm._v("#")]),_vm._v(" 基于 200 毫秒内返回写操作完成测试")]),_vm._v(" "),_c('p',[_vm._v("修改休眠时间，让写操作在 200 毫秒内能正常完成")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("// 写请求\nhttp://localhost:6001/updateProductInventory?productId=1&inventoryCnt=97\n// 读请求\nhttp://localhost:6001/getProductInventory?productId=1\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])]),_c('p',[_vm._v("日志输出")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("2019-04-06 21:07:42.997  INFO 20676 --- [nio-6001-exec-1] c.m.c.e.i.w.ProductInventoryController   : 更新商品库存请求：商品id=1，库存=97\n2019-04-06 21:07:42.998  INFO 20676 --- [nio-6001-exec-1] c.e.i.s.i.RequestAsyncProcessServiceImpl : 路由信息：key=1,商品 ID =1,队列 index=1\n2019-04-06 21:07:43.209  INFO 20676 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 处理请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:07:43.209  INFO 20676 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 写请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:07:43.242  INFO 20676 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 已删除缓存：商品 ID=1\n2019-04-06 21:07:43.242  INFO 20676 --- [pool-1-thread-2] .c.e.i.r.ProductInventoryDBUpdateRequest : 写请求：模拟写耗时操作，休眠 100 毫秒\n2019-04-06 21:07:43.302  INFO 20676 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 已更新数据库：商品 ID=1，库存=97\n2019-04-06 21:07:43.622  INFO 20676 --- [nio-6001-exec-2] c.m.c.e.i.w.ProductInventoryController   : 读取商品库存请求：商品id=1\n2019-04-06 21:07:43.624  INFO 20676 --- [nio-6001-exec-2] c.e.i.s.i.RequestAsyncProcessServiceImpl : 路由信息：key=1,商品 ID =1,队列 index=1\n2019-04-06 21:07:43.629  INFO 20676 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 处理请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:07:43.630  INFO 20676 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 读请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:07:43.630  INFO 20676 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 1+1 达成，1 写 1 读：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:07:43.630  INFO 20676 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 数据库获取商品，商品 ID=1\n2019-04-06 21:07:43.658  INFO 20676 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 设置缓存：{\"inventoryCnt\":97,\"productId\":1}\n2019-04-06 21:07:43.687  INFO 20676 --- [nio-6001-exec-2] c.m.c.e.i.w.ProductInventoryController   : 在缓存中找到，商品 ID=1\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br')])]),_c('p',[_vm._v("由于上面是休眠 100 毫秒，200 毫秒超时，所以人工请求没法模拟出来。")]),_vm._v(" "),_c('p',[_vm._v("下面的日志输出是休眠 5 秒，10 秒超时")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("2019-04-06 21:12:22.725  INFO 21740 --- [nio-6001-exec-1] c.m.c.e.i.w.ProductInventoryController   : 更新商品库存请求：商品id=1，库存=97\n2019-04-06 21:12:22.726  INFO 21740 --- [nio-6001-exec-1] c.e.i.s.i.RequestAsyncProcessServiceImpl : 路由信息：key=1,商品 ID =1,队列 index=1\n2019-04-06 21:12:22.830  INFO 21740 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 处理请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:12:22.831  INFO 21740 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 写请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:12:23.006  INFO 21740 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 已删除缓存：商品 ID=1\n2019-04-06 21:12:23.006  INFO 21740 --- [pool-1-thread-2] .c.e.i.r.ProductInventoryDBUpdateRequest : 写请求：模拟写耗时操作，休眠 5 秒钟\n2019-04-06 21:12:23.939  INFO 21740 --- [nio-6001-exec-2] c.m.c.e.i.w.ProductInventoryController   : 读取商品库存请求：商品id=1\n2019-04-06 21:12:23.940  INFO 21740 --- [nio-6001-exec-2] c.e.i.s.i.RequestAsyncProcessServiceImpl : 路由信息：key=1,商品 ID =1,队列 index=1\n2019-04-06 21:12:28.047  INFO 21740 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 已更新数据库：商品 ID=1，库存=97\n2019-04-06 21:12:28.050  INFO 21740 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 处理请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:12:28.050  INFO 21740 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 读请求：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:12:28.050  INFO 21740 --- [pool-1-thread-2] c.m.c.e.i.r.RequestProcessorThread       : 1+1 达成，1 写 1 读：{\"forceRfresh\":false,\"productId\":1}\n2019-04-06 21:12:28.050  INFO 21740 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 数据库获取商品，商品 ID=1\n2019-04-06 21:12:28.070  INFO 21740 --- [pool-1-thread-2] .m.c.e.i.s.i.ProductInventoryServiceImpl : 设置缓存：{\"inventoryCnt\":97,\"productId\":1}\n2019-04-06 21:12:28.086  INFO 21740 --- [nio-6001-exec-2] c.m.c.e.i.w.ProductInventoryController   : 在缓存中找到，商品 ID=1\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br')])]),_c('p',[_vm._v("可以看到，在等待超时中，会不断获取缓存中的信息，找到则返回。")]),_vm._v(" "),_c('p',[_vm._v("此时查看数据库和缓存中的数据都是一致的。")]),_vm._v(" "),_c('h2',{attrs:{"id":"讲师旁白"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#讲师旁白"}},[_vm._v("#")]),_vm._v(" 讲师旁白")]),_vm._v(" "),_c('p',[_vm._v("后续方案，包括本次的方案都是针对我自己遇到过的特殊场景设计出来的，\n可能这个方案不一定 100% 适合其他场景，需要改造")]),_vm._v(" "),_c('p',[_vm._v("再者，可能方案比较复杂，及时之前实施过，可能有一部分细节没有讲解到，会导致一些漏洞，\n这个也是可以理解的")]),_vm._v(" "),_c('p',[_vm._v("本课程主题是缓存架构，主要是架构和设计思想，有些许漏洞希望理解")]),_vm._v(" "),_c('p',[_vm._v("课程真正最重要的，不是给你一套 100% 包打天下的代码，而是一种设计思想，\n多种设计思想组合起来就是某种架构")]),_vm._v(" "),_c('div',{staticClass:"custom-block tip"},[_c('p',{staticClass:"custom-block-title"},[_vm._v("TIP")]),_vm._v(" "),_c('p',[_vm._v("该方案目前并未关注分布式情况下的多服务实例场景，\n从这个来看，架构上和一定的代码落地，的确是比较明确和清晰，\n是不是说在面试中只要掌握了这种架构思想就能加分一点呢？")])])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=250.31c6def9.js.map