(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[252],{

/***/ "./docs/cache-pdp/048.md":
/*!*******************************!*\
  !*** ./docs/cache-pdp/048.md ***!
  \*******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _048_md_vue_type_template_id_8548e7a6___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./048.md?vue&type=template&id=8548e7a6& */ "./docs/cache-pdp/048.md?vue&type=template&id=8548e7a6&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _048_md_vue_type_template_id_8548e7a6___WEBPACK_IMPORTED_MODULE_0__["render"],
  _048_md_vue_type_template_id_8548e7a6___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/cache-pdp/048.md?vue&type=template&id=8548e7a6&":
/*!**************************************************************!*\
  !*** ./docs/cache-pdp/048.md?vue&type=template&id=8548e7a6& ***!
  \**************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_048_md_vue_type_template_id_8548e7a6___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib??ref--1-1!../../node_modules/@vuepress/markdown-loader??ref--1-2!./048.md?vue&type=template&id=8548e7a6& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/048.md?vue&type=template&id=8548e7a6&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_048_md_vue_type_template_id_8548e7a6___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_048_md_vue_type_template_id_8548e7a6___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/048.md?vue&type=template&id=8548e7a6&":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/cache-pdp/048.md?vue&type=template&id=8548e7a6& ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"_048-redis-的-lru-缓存清除算法讲解以及相关配置使用"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#_048-redis-的-lru-缓存清除算法讲解以及相关配置使用"}},[_vm._v("#")]),_vm._v(" 048. redis 的 LRU 缓存清除算法讲解以及相关配置使用")]),_vm._v(" "),_c('p',[_vm._v("多级缓存架构，缓存数据生产服务监听各个数据源服务的数据变更的消息，\n得到消息之后，然后调用接口拉去数据，将拉取到的数据，写入本地 ehcache 缓存一份，\n上一章节 spring boot 整合并演示过")]),_vm._v(" "),_c('p',[_vm._v("数据还会写入 redis 分布式缓存中一份，你不断的将数据写入 redis，然而 redis 的内存是有限的，\n每个 redis 实例最大一般也就是设置 10G，当数据写入的量超过了 redis 能承受的范围之后，\n该怎么玩儿呢？")]),_vm._v(" "),_c('p',[_vm._v("redis 是会在数据达到一定程度之后，超过了一个最大的限度之后，就会将数据进行一定的清理，\n从内存中清理掉一些数据，只有清理掉一些数据之后，才能将新的数据写入内存中")]),_vm._v(" "),_c('h2',{attrs:{"id":"lru-算法概述"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#lru-算法概述"}},[_vm._v("#")]),_vm._v(" LRU 算法概述")]),_vm._v(" "),_c('p',[_vm._v("LRU：Least Recently Used 最近最少使用算法")]),_vm._v(" "),_c('p',[_vm._v("redis 默认情况下就是使用 LRU 策略的，因为内存是有限的，但是如果你不断地往 redis 里面写入数据，\n那肯定是没法存放下所有的数据在内存的（这个默认貌似不太对，在配置文件中的默认配置不是 LRU）")]),_vm._v(" "),_c('p',[_vm._v("将最近一段时间内，最少使用的一些数据给干掉。比如说有一个 key，在最近 1 个小时内，\n只被访问了一次; 还有一个 key 在最近 1 个小时内，被访问了 1 万次，\n当内存满的时候，那么 1 小时内只被访问了 1 次的那条数据将会被清理掉")]),_vm._v(" "),_c('h2',{attrs:{"id":"缓存清理设置"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#缓存清理设置"}},[_vm._v("#")]),_vm._v(" 缓存清理设置")]),_vm._v(" "),_c('p',[_vm._v("配置文件：redis.conf")]),_vm._v(" "),_c('ul',[_c('li',[_c('p',[_vm._v("maxmemory：设置 redis 用来存放数据的最大的内存大小")]),_vm._v(" "),_c('p',[_vm._v("一旦超出这个内存大小之后，就会立即使用 LRU 算法清理掉部分数据")]),_vm._v(" "),_c('p',[_vm._v("如果用 LRU，那么就是将最近最少使用的数据从缓存中清除出去")]),_vm._v(" "),_c('p',[_vm._v("对于 64 bit 的机器，如果 maxmemory 设置为 0，那么就默认不限制内存的使用，直到耗尽机器中所有的内存为止;\n但是对于 32 bit 的机器，有一个隐式的限制就是 3GB")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("maxmemory-policy 可以设置内存达到最大限制后，采取什么策略来处理")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("noeviction: 如果内存使用达到了 maxmemory，client 还要继续写入数据，那么就直接报错给客户端")]),_vm._v(" "),_c('li',[_vm._v("allkeys-lru: 就是我们常说的 LRU 算法，移除掉最近最少使用的那些 keys 对应的数据")]),_vm._v(" "),_c('li',[_vm._v("volatile-lru: 也是采取 LRU 算法，但是仅仅针对那些设置了指定存活时间（TTL）的 key 才会清理掉")]),_vm._v(" "),_c('li',[_vm._v("allkeys-random: 随机选择一些 key 来删除掉")]),_vm._v(" "),_c('li',[_vm._v("volatile-random: 随机选择一些设置了 TTL 的 key 来删除掉")]),_vm._v(" "),_c('li',[_vm._v("volatile-ttl: 移除掉部分 keys，选择那些 TTL 时间比较短的 keys")])])])]),_vm._v(" "),_c('p',[_vm._v("对于以上的解释在配置文件中有英文的说明，和上面的基本上一致。")]),_vm._v(" "),_c('p',[_vm._v("TTL：也就是开发中常说的过期时间，redis 中支持给 key 配置 ttl")]),_vm._v(" "),_c('p',[_vm._v("这边拓展一下思路，对技术的研究，一旦将一些技术研究的比较透彻之后，就喜欢横向对比底层的一些原理，\n玩儿大数据的人知道实时计算领域中 storm 比较流行，storm 有很多的流分组的一些策略，\n按 shuffle 分组、global 全局分组、direct 直接分组、fields 按字段值 hash 后分组，\n分组策略也很多，但是真正公司里 99% 的场景下，使用的也就是 shuffle 和 fields 两种策略")]),_vm._v(" "),_c('p',[_vm._v("redis 也一样，给了这么多种乱七八糟的缓存清理的算法，其实真正常用的可能也就那么一两种，allkeys-lru 是最常用的")]),_vm._v(" "),_c('h2',{attrs:{"id":"缓存清理的流程"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#缓存清理的流程"}},[_vm._v("#")]),_vm._v(" 缓存清理的流程")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("客户端执行数据写入操作")]),_vm._v(" "),_c('li',[_vm._v("redis server 接收到写入操作之后，检查 maxmemory 的限制，如果超过了限制，那么就根据对应的 policy 清理掉部分数据")]),_vm._v(" "),_c('li',[_vm._v("写入操作完成执行")])]),_vm._v(" "),_c('h2',{attrs:{"id":"redis-的-lru-近似算法"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#redis-的-lru-近似算法"}},[_vm._v("#")]),_vm._v(" redis 的 LRU 近似算法")]),_vm._v(" "),_c('p',[_vm._v("科普一个相对来说稍微高级一丢丢的知识点")]),_vm._v(" "),_c('p',[_vm._v("redis 采取的是 LRU 近似算法，也就是对 keys 进行采样，然后在采样结果中进行数据清理")]),_vm._v(" "),_c('p',[_vm._v("redis 3.0 开始，在 LRU 近似算法中引入了 pool 机制，表现可以跟真正的 LRU 算法相当，\n但是还是有所差距的，不过这样可以减少内存的消耗")]),_vm._v(" "),_c('p',[_vm._v("redis LRU 算法，是采样之后再做 LRU 清理的，跟真正的、传统、全量的 LRU 算法是不太一样的")]),_vm._v(" "),_c('p',[_vm._v("maxmemory-samples：比如 5，可以设置采样的大小，如果设置为 10，那么效果会更好，不过也会耗费更多的 CPU 资源")]),_vm._v(" "),_c('p',[_vm._v("maxmemory-samples 在配置文件中也有一部分解释，根据机翻来看，设置 5 会检查 5 个键来进行对比检查，\n所以说是近似的，但是具体的思路没有提及到")])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=252.d2aff5b9.js.map