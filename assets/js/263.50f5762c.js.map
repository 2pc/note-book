{"version":3,"sources":["webpack:///./docs/cache-pdp/060.md","webpack:///./docs/cache-pdp/060.md?7ec2","webpack:///./docs/cache-pdp/060.md?4d8e"],"names":[],"mappings":"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","file":"assets/js/263.50f5762c.js","sourcesContent":["import { render, staticRenderFns } from \"./060.md?vue&type=template&id=70eeea37&\"\nvar script = {}\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/@vuepress/core/node_modules/.cache/vuepress\\\",\\\"cacheIdentifier\\\":\\\"2e9acca5-vue-loader-template\\\"}!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??ref--1-1!../../node_modules/@vuepress/markdown-loader/index.js??ref--1-2!./060.md?vue&type=template&id=70eeea37&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{\"slot-key\":_vm.$parent.slotKey}},[_c('h1',{attrs:{\"id\":\"_060-缓存数据生产服务中的-zk-分布式锁解决方案的代码实现-三\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#_060-缓存数据生产服务中的-zk-分布式锁解决方案的代码实现-三\"}},[_vm._v(\"#\")]),_vm._v(\" 060. 缓存数据生产服务中的 zk 分布式锁解决方案的代码实现（三）\")]),_vm._v(\" \"),_c('p',[_vm._v(\"启动项目来测试，会发现报错了。找到两个 StaticLoggerBinder，来自两个 jar 中；\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"SLF4J: Class path contains multiple SLF4J bindings.\\nSLF4J: Found binding in [jar:file:/E:/SoftwareDevelop/Repository/caches/modules-2/files-2.1/org.slf4j/slf4j-log4j12/1.7.25/110cefe2df103412849d72ef7a67e4e91e4266b4/slf4j-log4j12-1.7.25.jar!/org/slf4j/impl/StaticLoggerBinder.class]\\nSLF4J: Found binding in [jar:file:/E:/SoftwareDevelop/Repository/caches/modules-2/files-2.1/ch.qos.logback/logback-classic/1.2.3/7c4f3c474fb2c041d8028740440937705ebb473a/logback-classic-1.2.3.jar!/org/slf4j/impl/StaticLoggerBinder.class]\\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\\nSLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]\\nException in thread \\\"main\\\" java.lang.IllegalArgumentException: LoggerFactory is not a Logback LoggerContext but Logback is on the classpath. Either remove Logback or the competing implementation (class org.slf4j.impl.Log4jLoggerFactory loaded from file:/E:/SoftwareDevelop/Repository/caches/modules-2/files-2.1/org.slf4j/slf4j-log4j12/1.7.25/110cefe2df103412849d72ef7a67e4e91e4266b4/slf4j-log4j12-1.7.25.jar). If you are using WebLogic you will need to add 'org.slf4j' to prefer-application-packages in WEB-INF/weblogic.xml: org.slf4j.impl.Log4jLoggerFactory\\n\\tat org.springframework.util.Assert.instanceCheckFailed(Assert.java:655)\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br')])]),_c('p',[_vm._v(\"这里排除 zookper 中的\")]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"gradle-解决冲突-查找依赖树\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#gradle-解决冲突-查找依赖树\"}},[_vm._v(\"#\")]),_vm._v(\" gradle 解决冲突&查找依赖树\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"gradle dependencyInsight --dependency slf4j-log4j12\\n\\nH:\\\\dev\\\\project\\\\mrcode\\\\cache-pdp\\\\eshop-cache>gradle dependencyInsight --dependency slf4j-log4j12\\n\\n> Task :eshop-cache:dependencyInsight\\norg.slf4j:slf4j-log4j12:1.7.25 (selected by rule)\\n   variant \\\"runtime\\\" [\\n      org.gradle.status = release (not requested)\\n      Requested attributes not found in the selected variant:\\n         org.gradle.usage  = java-api\\n   ]\\n\\norg.slf4j:slf4j-log4j12:1.6.1 -> 1.7.25\\n   variant \\\"runtime\\\" [\\n      org.gradle.status = release (not requested)\\n      Requested attributes not found in the selected variant:\\n         org.gradle.usage  = java-api\\n   ]\\n\\\\--- org.apache.zookeeper:zookeeper:3.4.5\\n     +--- compileClasspath\\n     +--- org.apache.kafka:kafka_2.9.2:0.8.1.1\\n     |    \\\\--- compileClasspath\\n     \\\\--- com.101tec:zkclient:0.3\\n          \\\\--- org.apache.kafka:kafka_2.9.2:0.8.1.1 (*)\\n\\n(*) - dependencies omitted (listed previously)\\n\\nA web-based, searchable dependency report is available by adding the --scan option.\\n\\nBUILD SUCCESSFUL in 7s\\n1 actionable task: 1 executed\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"8\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"9\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"10\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"11\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"12\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"13\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"14\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"15\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"16\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"17\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"18\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"19\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"20\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"21\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"22\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"23\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"24\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"25\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"26\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"27\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"28\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"29\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"30\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"31\")]),_c('br')])]),_c('p',[_vm._v(\"可以看到 在 zk 里面有引用，然后 kafka 里面有引用 zookper。所以需要排除两个地方\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"compile ('org.apache.kafka:kafka_2.9.2:0.8.1.1'){\\n       exclude group: 'org.slf4j', module: 'slf4j-log4j12'\\n   }\\n compile ('org.apache.zookeeper:zookeeper:3.4.5'){\\n     exclude group: 'org.slf4j', module: 'slf4j-log4j12'\\n }\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br')])]),_c('h2',{attrs:{\"id\":\"测试缓存重建流程\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#测试缓存重建流程\"}},[_vm._v(\"#\")]),_vm._v(\" 测试缓存重建流程\")]),_vm._v(\" \"),_c('p',[_vm._v(\"首先先删除 redis 中的数据，通过之前的 redis 章节中的命令登录并删除\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"redis-cli -h eshop-cache02 -p 7003\\neshop-cache02:7003> del product_info_1\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br')])]),_c('p',[_vm._v(\"再启动 eshop-cache 服务；\")]),_vm._v(\" \"),_c('p',[_vm._v(\"访问：\"),_c('code',[_vm._v(\"http://localhost:6002/getProductInfo?productId=1\")]),_vm._v(\",查看打印日志\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"2019-05-14 22:22:38.618  INFO 11616 --- [nio-6002-exec-1] c.m.c.e.c.controller.CacheController     : 从 redis 中获取商品信息\\n2019-05-14 22:22:38.643  INFO 11616 --- [nio-6002-exec-1] c.m.c.e.c.controller.CacheController     : 从 ehcache 中获取商品信息\\n2019-05-14 22:22:45.276  INFO 11616 --- [p-cache03:2181)] org.apache.zookeeper.ClientCnxn          : Session establishment complete on server eshop-cache03/192.168.99.172:2181, sessionid = 0x26a8e8df54a0001, negotiated timeout = 5000\\nwatch event：SyncConnected\\nzookeeper 已连接\\nzookeeper 初始化成功\\n获取锁成功 product[id=1]\\n2019-05-14 22:22:45.295  INFO 11616 --- [      Thread-14] c.m.c.e.cache.controller.RebuildCache    : 缓存重建成功：cn.mrcode.cachepdp.eshop.cache.model.ProductInfo@1ce9e40a\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"8\")]),_c('br')])]),_c('p',[_vm._v(\"再次访问，只有一条日志了\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"2019-05-14 22:23:52.328  INFO 11616 --- [nio-6002-exec-4] c.m.c.e.c.controller.CacheController     : 从 redis 中获取商品信息\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br')])]),_c('h2',{attrs:{\"id\":\"测试商品信息变更缓存重建\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#测试商品信息变更缓存重建\"}},[_vm._v(\"#\")]),_vm._v(\" 测试商品信息变更缓存重建\")]),_vm._v(\" \"),_c('p',[_vm._v(\"也就是  KafkaMessageProcessor 中的逻辑\")]),_vm._v(\" \"),_c('p',[_vm._v(\"这个测试需要手动往 kafka 中植入一条数据，触发这个消费逻辑\")]),_vm._v(\" \"),_c('p',[_vm._v(\"手动植入数据参考 \"),_c('RouterLink',{attrs:{\"to\":\"/cache-pdp/050.html#测试业务逻辑\"}},[_vm._v(\"这里\")])],1),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"bin/kafka-console-producer.sh --broker-list 192.168.99.170:9092,192.168.99.171:9092,192.168.99.172:9092 --topic eshop-message\\n\\n{\\\"serviceId\\\":\\\"productInfoService\\\",\\\"productId\\\":\\\"1\\\"}\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br')])]),_c('p',[_vm._v(\"日志打印\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"watch event：SyncConnected\\nzookeeper 已连接\\nzookeeper 初始化成功\\n获取锁成功 product[id=1]\\n2019-05-14 22:37:32.884  INFO 6692 --- [      Thread-29] c.m.c.e.c.kafka.KafkaMessageProcessor    : 获取刚保存到本地缓存的商品信息：cn.mrcode.cachepdp.eshop.cache.model.ProductInfo@37582749\\n获取锁成功 product[id=1]\\n2019-05-14 22:37:38.648  INFO 6692 --- [      Thread-29] c.m.c.e.c.kafka.KafkaMessageProcessor    : 数据未变更过\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br')])]),_c('h2',{attrs:{\"id\":\"测试两个流程\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#测试两个流程\"}},[_vm._v(\"#\")]),_vm._v(\" 测试两个流程\")]),_vm._v(\" \"),_c('ol',[_c('li',[_vm._v(\"增加 kafka 获取锁后的休眠，模拟耗时操作\")]),_vm._v(\" \"),_c('li',[_vm._v(\"删除 redis 缓存，重启项目后\")]),_vm._v(\" \"),_c('li',[_vm._v(\"先触发 kafka\")]),_vm._v(\" \"),_c('li',[_vm._v(\"再访问 \"),_c('code',[_vm._v(\"http://localhost:6002/getProductInfo?productId=1\")])])]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"watch event：SyncConnected\\nzookeeper 已连接\\nzookeeper 初始化成功\\n获取锁成功 product[id=1]\\n2019-05-14 22:44:56.225  INFO 9376 --- [      Thread-30] c.m.c.e.c.kafka.KafkaMessageProcessor    : kafka 休眠 10 秒\\n2019-05-14 22:44:59.640 TRACE 9376 --- [nio-6002-exec-1] o.s.web.servlet.DispatcherServlet        : GET \\\"/getProductInfo?productId=1\\\", parameters={masked}, headers={masked} in DispatcherServlet 'dispatcherServlet'\\n2019-05-14 22:44:59.649 TRACE 9376 --- [nio-6002-exec-1] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to public cn.mrcode.cachepdp.eshop.cache.model.ProductInfo cn.mrcode.cachepdp.eshop.cache.controller.CacheController.getProductInfo(java.lang.Long)\\n2019-05-14 22:44:59.672 TRACE 9376 --- [nio-6002-exec-1] .w.s.m.m.a.ServletInvocableHandlerMethod : Arguments: [1]\\n2019-05-14 22:44:59.682  INFO 9376 --- [nio-6002-exec-1] c.m.c.e.c.controller.CacheController     : 从 redis 中获取商品信息\\n2019-05-14 22:44:59.705  INFO 9376 --- [nio-6002-exec-1] c.m.c.e.c.controller.CacheController     : 从 ehcache 中获取商品信息\\norg.apache.zookeeper.KeeperException$NodeExistsException: KeeperErrorCode = NodeExists for /product-lock-1\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:119)\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:51)\\n\\tat org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:783)\\n\\tat cn.mrcode.cachepdp.eshop.cache.ZooKeeperSession.acquireDistributedLock(ZooKeeperSession.java:58)\\n\\tat cn.mrcode.cachepdp.eshop.cache.controller.RebuildCache.lambda$start$0(RebuildCache.java:58)\\n\\tat cn.mrcode.cachepdp.eshop.cache.controller.RebuildCache$$Lambda$433/1623148876.run(Unknown Source)\\n\\tat java.lang.Thread.run(Thread.java:745)\\n\\n2019-05-14 22:45:06.243  INFO 9376 --- [      Thread-30] c.m.c.e.c.kafka.KafkaMessageProcessor    : 获取刚保存到本地缓存的商品信息：cn.mrcode.cachepdp.eshop.cache.model.ProductInfo@9fbc9fb\\n获取锁成功 product[id=1] 尝试了 180 次.\\n2019-05-14 22:45:06.293  INFO 9376 --- [      Thread-13] c.m.c.e.cache.controller.RebuildCache    : 此次数据版本落后，放弃重建\\n\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"8\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"9\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"10\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"11\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"12\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"13\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"14\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"15\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"16\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"17\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"18\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"19\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"20\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"21\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"22\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"23\")]),_c('br')])]),_c('p',[_vm._v(\"上面的日志可以看到：\")]),_vm._v(\" \"),_c('ol',[_c('li',[_vm._v(\"在休眠过程中，触发了缓存重建操作\")]),_vm._v(\" \"),_c('li',[_vm._v(\"缓存重建一直在等待锁的释放，最后尝试了 180 次，才获取到\")]),_vm._v(\" \"),_c('li',[_vm._v(\"获取到之后，发现 kafka 线程重建缓存后的数据比自己的新（其实是一样的时间，日志打印问题），所以放弃了往 redis 中放入数据的操作\")])]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"小结\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#小结\"}},[_vm._v(\"#\")]),_vm._v(\" 小结\")]),_vm._v(\" \"),_c('h3',{attrs:{\"id\":\"思想总结\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#思想总结\"}},[_vm._v(\"#\")]),_vm._v(\" 思想总结\")]),_vm._v(\" \"),_c('p',[_vm._v(\"缓存重建出现在两个地方：\")]),_vm._v(\" \"),_c('ol',[_c('li',[_vm._v(\"当基础服务信息变更之后（被动）\")]),_vm._v(\" \"),_c('li',[_vm._v(\"当所有缓存失效之后（主动）\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"一个主动一个被动，他们的执行逻辑都相同，其实可以使用一个队列逻辑来处理缓存重建\")]),_vm._v(\" \"),_c('p',[_vm._v(\"缓存重建重要依赖「zk 分布式锁」让多个实例/操作 串行化起来。避免脏数据覆盖新数据\")]),_vm._v(\" \"),_c('h3',{attrs:{\"id\":\"疑问\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#疑问\"}},[_vm._v(\"#\")]),_vm._v(\" 疑问\")]),_vm._v(\" \"),_c('p',[_vm._v(\"此处的 kafka 调试还是不能 debug。一 debug 线程就卡卡住；\")]),_vm._v(\" \"),_c('p',[_vm._v(\"另外这个逻辑细节有些地方是不严谨的，比如从数据库获取数据，再用分布式锁去，\\n那么会不会出现在分布式锁之前很多请求全部打到数据库中去了呢？\")]),_vm._v(\" \"),_c('p',[_vm._v(\"我这里只是提出来课程中的一点疑问，现在最主要的还是要跟着课程思路走\")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}