(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[270],{

/***/ "./docs/cache-pdp/074.md":
/*!*******************************!*\
  !*** ./docs/cache-pdp/074.md ***!
  \*******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _074_md_vue_type_template_id_2e4faa40___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./074.md?vue&type=template&id=2e4faa40& */ "./docs/cache-pdp/074.md?vue&type=template&id=2e4faa40&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _074_md_vue_type_template_id_2e4faa40___WEBPACK_IMPORTED_MODULE_0__["render"],
  _074_md_vue_type_template_id_2e4faa40___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/cache-pdp/074.md?vue&type=template&id=2e4faa40&":
/*!**************************************************************!*\
  !*** ./docs/cache-pdp/074.md?vue&type=template&id=2e4faa40& ***!
  \**************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_074_md_vue_type_template_id_2e4faa40___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib??ref--1-1!../../node_modules/@vuepress/markdown-loader??ref--1-2!./074.md?vue&type=template&id=2e4faa40& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/074.md?vue&type=template&id=2e4faa40&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_074_md_vue_type_template_id_2e4faa40___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_074_md_vue_type_template_id_2e4faa40___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/074.md?vue&type=template&id=2e4faa40&":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/cache-pdp/074.md?vue&type=template&id=2e4faa40& ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"_074-基于双重-zookeeper-分布式锁完成分布式并行缓存预热的代码开发"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#_074-基于双重-zookeeper-分布式锁完成分布式并行缓存预热的代码开发"}},[_vm._v("#")]),_vm._v(" 074. 基于双重 zookeeper 分布式锁完成分布式并行缓存预热的代码开发")]),_vm._v(" "),_c('h2',{attrs:{"id":"并行缓存预热思路"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#并行缓存预热思路"}},[_vm._v("#")]),_vm._v(" 并行缓存预热思路")]),_vm._v(" "),_c('ol',[_c('li',[_c('p',[_vm._v("服务启动的时候，进行缓存预热")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("从 zk 中读取 taskid 列表")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("依次遍历每个 taskid，尝试获取分布式锁，如果获取不到，快速报错，不要等待，因为说明已经有其他服务实例在预热了")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("直接尝试获取下一个 taskid 的分布式锁")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("即使获取到了分布式锁，也要检查一下这个 taskid 的预热状态，如果已经被预热过了，就不再预热了")]),_vm._v(" "),_c('p',[_vm._v("预热状态，也是一个 node path 来存储的，每个 task 一个状态节点")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("执行预热操作，遍历 productid 列表，查询数据，然后写 ehcache 和 redis")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("预热完成后，设置 taskid 对应的预热状态")])])]),_vm._v(" "),_c('h2',{attrs:{"id":"服务启动启动预热与-spring-实例工具类封装"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#服务启动启动预热与-spring-实例工具类封装"}},[_vm._v("#")]),_vm._v(" 服务启动启动预热与 spring 实例工具类封装")]),_vm._v(" "),_c('p',[_vm._v("由于需要在缓存预热的线程中使用缓存服务进行存储，这里需要封装一个 spring bean 获取工具类")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("package")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("cn"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("mrcode"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("cachepdp"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("eshop"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("cache")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("web"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("context"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("WebApplicationContext")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("org"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("springframework"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("web"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("context"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("support"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("WebApplicationContextUtils")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("javax"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("servlet"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ServletContext")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("javax"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("servlet"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ServletContextEvent")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("javax"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("servlet"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ServletContextListener")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("import")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("cn"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("mrcode"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("cachepdp"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("eshop"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("cache"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("prewarm"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CachePrewarmThread")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("/**\n * @author : zhuqiang\n * @date : 2019/5/25 15:58\n */")]),_vm._v("\n "),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@Component")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("class")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("InitListener")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("implements")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ServletContextListener")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@Override")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("void")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("contextInitialized")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ServletContextEvent")]),_vm._v(" sce"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ServletContext")]),_vm._v(" servletContext "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" sce"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getServletContext")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("WebApplicationContext")]),_vm._v(" webApplicationContext "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("WebApplicationContextUtils")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getWebApplicationContext")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("servletContext"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("SpringContextUtil")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("setWebApplicationContext")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("webApplicationContext"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CachePrewarmThread")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("start")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br')])]),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("class")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("SpringContextUtil")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("private")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("static")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("WebApplicationContext")]),_vm._v(" context"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("static")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("WebApplicationContext")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getWebApplicationContext")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" context"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("static")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("void")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("setWebApplicationContext")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("WebApplicationContext")]),_vm._v(" webApplicationContext"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        context "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" webApplicationContext"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br')])]),_c('h2',{attrs:{"id":"zk-工具类的改造"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#zk-工具类的改造"}},[_vm._v("#")]),_vm._v(" zk 工具类的改造")]),_vm._v(" "),_c('p',[_vm._v("在思路里面提到了，需要快速失败的一个加锁方式，还有写入/获取数据的方法。\n在缓存服务里面的 zk 工具类还没有这样的功能，对这个进行改造")]),_vm._v(" "),_c('p',[_vm._v("由于之前写过，这些代码都是体力活了，不想贴上来了")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("class")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooKeeperSession")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("private")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooKeeper")]),_vm._v(" zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("private")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CountDownLatch")]),_vm._v(" connectedSemaphore "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CountDownLatch")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("private")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooKeeperSession")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" connectString "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"192.168.99.170:2181,192.168.99.171:2181,192.168.99.172:2181\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("int")]),_vm._v(" sessionTimeout "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("5000")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("try")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 异步连接，所以需要一个  org.apache.zookeeper.Watcher 来通知")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 由于是异步，利用 CountDownLatch 来让构造函数等待")]),_vm._v("\n            zookeeper "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooKeeper")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("connectString"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" sessionTimeout"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" event "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("->")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Watcher"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Event"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("KeeperState")]),_vm._v(" state "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" event"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getState")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("System")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("println")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"watch event：\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" state"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("state "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("==")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Watcher"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Event"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("KeeperState"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("SyncConnected")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n                    "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("System")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("println")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"zookeeper 已连接\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                    connectedSemaphore"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("countDown")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("IOException")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("try")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            connectedSemaphore"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("await")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("InterruptedException")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("System")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("println")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"zookeeper 初始化成功\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("/**\n     * 获取分布式锁\n     */")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("void")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("acquireDistributedLock")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Long")]),_vm._v(" productId"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" path "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"/product-lock-\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" productId"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("byte")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v(" data "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getBytes")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("try")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 创建一个临时节点，后面两个参数一个安全策略，一个临时节点类型")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// EPHEMERAL：客户端被断开时，该节点自动被删除")]),_vm._v("\n            zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("create")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" data"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooDefs"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Ids")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("OPEN_ACL_UNSAFE"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CreateMode")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("EPHEMERAL"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("System")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("println")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"获取锁成功 product[id=\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" productId "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"]\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Exception")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 如果锁已经被创建，那么将异常")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 循环等待锁的释放")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("int")]),_vm._v(" count "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("while")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token boolean"}},[_vm._v("true")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("try")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n                    "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("TimeUnit")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("MILLISECONDS"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("sleep")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("20")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                    "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 休眠 20 毫秒后再次尝试创建")]),_vm._v("\n                    zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("create")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" data"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooDefs"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Ids")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("OPEN_ACL_UNSAFE"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CreateMode")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("EPHEMERAL"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Exception")]),_vm._v(" e1"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("//                    e1.printStackTrace();")]),_vm._v("\n                    count"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("++")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("continue")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("System")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("println")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"获取锁成功 product[id=\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" productId "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"] 尝试了 \"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" count "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\" 次.\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("break")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("/**\n     * 释放分布式锁\n     */")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("void")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("releaseDistributedLock")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Long")]),_vm._v(" productId"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("try")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" path "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"/product-lock-\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" productId"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("delete")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("-")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("InterruptedException")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("KeeperException")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("/**\n     * 获取分布式锁\n     */")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("void")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("acquireDistributedLock")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("byte")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v(" data "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getBytes")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("try")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 创建一个临时节点，后面两个参数一个安全策略，一个临时节点类型")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// EPHEMERAL：客户端被断开时，该节点自动被删除")]),_vm._v("\n            zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("create")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" data"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooDefs"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Ids")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("OPEN_ACL_UNSAFE"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CreateMode")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("EPHEMERAL"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("System")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("println")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"获取锁成功 [path=\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" path "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"]\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Exception")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 如果锁已经被创建，那么将异常")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 循环等待锁的释放")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("int")]),_vm._v(" count "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("while")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token boolean"}},[_vm._v("true")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("try")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n                    "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("TimeUnit")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("MILLISECONDS"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("sleep")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("20")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                    "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 休眠 20 毫秒后再次尝试创建")]),_vm._v("\n                    zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("create")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" data"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooDefs"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Ids")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("OPEN_ACL_UNSAFE"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CreateMode")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("EPHEMERAL"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Exception")]),_vm._v(" e1"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("//                    e1.printStackTrace();")]),_vm._v("\n                    count"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("++")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("continue")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("System")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("println")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"获取锁成功 [path=\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" path "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"] 尝试了 \"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" count "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\" 次.\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("break")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("/**\n     * 获取分布式锁；快速失败，不等待\n     */")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("boolean")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("acquireFastFailDistributedLock")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("byte")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v(" data "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getBytes")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("try")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 创建一个临时节点，后面两个参数一个安全策略，一个临时节点类型")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// EPHEMERAL：客户端被断开时，该节点自动被删除")]),_vm._v("\n            zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("create")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" data"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooDefs"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Ids")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("OPEN_ACL_UNSAFE"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CreateMode")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("EPHEMERAL"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("System")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("println")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"获取锁成功 [path=\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" path "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"]\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean"}},[_vm._v("true")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Exception")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("System")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("println")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"获取锁失败 [path=\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" path "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"]\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean"}},[_vm._v("false")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("/**\n     * 释放分布式锁\n     */")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("void")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("releaseDistributedLock")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("try")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("delete")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("-")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("InterruptedException")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("KeeperException")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("/**\n     * 写节点数据\n     */")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("void")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("setNodeData")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" data"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("try")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n           "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Stat")]),_vm._v(" exists "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("exists")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean"}},[_vm._v("false")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("exists "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("==")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("null")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 节点不存在，先创建 PERSISTENT 持久连接")]),_vm._v("\n                zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("create")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" data"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getBytes")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooDefs"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Ids")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("OPEN_ACL_UNSAFE"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CreateMode")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("PERSISTENT"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n            zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("setData")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" data"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getBytes")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("-")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("KeeperException")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("InterruptedException")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getNodeData")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("try")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("zookeeper"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getData")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("path"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean"}},[_vm._v("false")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Stat")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("KeeperException")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("catch")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("InterruptedException")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("printStackTrace")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("null")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("private")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("static")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooKeeperSession")]),_vm._v(" instance "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooKeeperSession")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("static")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooKeeperSession")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getInstance")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" instance"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("31")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("32")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("33")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("34")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("35")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("36")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("37")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("38")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("39")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("40")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("41")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("42")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("43")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("44")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("45")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("46")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("47")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("48")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("49")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("50")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("51")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("52")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("53")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("54")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("55")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("56")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("57")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("58")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("59")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("60")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("61")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("62")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("63")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("64")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("65")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("66")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("67")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("68")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("69")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("70")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("71")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("72")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("73")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("74")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("75")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("76")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("77")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("78")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("79")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("80")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("81")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("82")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("83")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("84")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("85")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("86")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("87")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("88")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("89")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("90")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("91")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("92")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("93")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("94")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("95")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("96")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("97")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("98")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("99")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("100")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("101")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("102")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("103")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("104")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("105")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("106")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("107")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("108")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("109")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("110")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("111")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("112")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("113")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("114")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("115")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("116")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("117")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("118")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("119")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("120")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("121")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("122")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("123")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("124")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("125")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("126")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("127")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("128")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("129")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("130")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("131")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("132")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("133")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("134")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("135")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("136")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("137")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("138")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("139")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("140")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("141")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("142")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("143")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("144")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("145")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("146")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("147")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("148")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("149")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("150")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("151")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("152")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("153")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("154")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("155")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("156")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("157")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("158")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("159")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("160")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("161")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("162")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("163")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("164")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("165")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("166")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("167")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("168")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("169")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("170")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("171")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("172")]),_c('br')])]),_c('h2',{attrs:{"id":"缓存预热逻辑编写"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#缓存预热逻辑编写"}},[_vm._v("#")]),_vm._v(" 缓存预热逻辑编写")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("class")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CachePrewarmThread")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("extends")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Thread")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@Override")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("void")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 1. 获取 task id 列表")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooKeeperSession")]),_vm._v(" zk "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ZooKeeperSession")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getInstance")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("final")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" taskListNode "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"/hot-product-task-list\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" taskListNdeData "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" zk"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getNodeData")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskListNode"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskListNode "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("==")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("null")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("||")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("equals")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskListNdeData"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("System")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("err"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("println")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"task list 为空\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CacheService")]),_vm._v(" cacheService "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("SpringContextUtil")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getWebApplicationContext")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getBean")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("CacheService")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("class")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v(" taskList "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" taskListNdeData"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("split")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\",\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("for")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" taskId "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" taskList"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("final")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" taskNodeLockPath "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"/hot-product-task-lock-\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" taskId"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 尝试获取该节点的锁，如果获取失败，说明被其他服务预热了")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v("zk"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("acquireFastFailDistributedLock")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskNodeLockPath"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("continue")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 疑问：视频中为什么需要在这里对 预热数据节点加锁？")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 获取 检查预热状态")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("final")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" taskNodePrewarmStatePath "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"/hot-product-task-prewarm-state\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" taskId"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" taskNodePrewarmState "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" zk"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getNodeData")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskNodePrewarmStatePath"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 已经被预热过了")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskNodePrewarmState "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("null")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&&")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("equals")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskNodePrewarmState"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n                zk"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("releaseDistributedLock")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskNodeLockPath"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("continue")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 还未被预热过，读取 topn 列表，并从数据库中获取商品信息，存入缓存中")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("final")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" taskNodePath "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"/hot-product-task-\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" taskId"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" nodeData "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" zk"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getNodeData")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskNodePath"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("nodeData "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("==")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("null")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&&")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("equals")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("nodeData"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 如果没有数据则不处理")]),_vm._v("\n                zk"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("releaseDistributedLock")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskNodeLockPath"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("continue")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n            "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("List")]),_c('span',{pre:true,attrs:{"class":"token generics"}},[_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("<")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Long")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(">")])]),_vm._v(" pids "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" JSON"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("parseArray")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("nodeData"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Long")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("class")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 假设这里是从数据库中获取的数据")]),_vm._v("\n            pids"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("forEach")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("pid "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("->")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ProductInfo")]),_vm._v(" productInfo "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getProduct")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("pid"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("System")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("out"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("println")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"预热缓存信息：\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" productInfo"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                cacheService"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("saveProductInfo2LocalCache")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("productInfo"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n                cacheService"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("saveProductInfo2ReidsCache")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("productInfo"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 修改预热状态")]),_vm._v("\n            zk"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("setNodeData")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskNodePrewarmStatePath"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"success\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n            "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 释放该 task 节点的锁")]),_vm._v("\n            zk"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("releaseDistributedLock")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("taskNodeLockPath"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("private")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ProductInfo")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("getProduct")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Long")]),_vm._v(" pid"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" productInfoJSON "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"{\\\"id\\\": \"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" pid "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\", \\\"name\\\": \\\"iphone7手机\\\", \\\"price\\\": 5599, \\\"pictureList\\\":\\\"a.jpg,b.jpg\\\", \\\"specification\\\": \\\"iphone7的规格\\\", \\\"service\\\": \\\"iphone7的售后服务\\\", \\\"color\\\": \\\"红色,白色,黑色\\\", \\\"size\\\": \\\"5.5\\\", \\\"shopId\\\": 1,\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"\\\"modifyTime\\\":\\\"2019-05-13 22:00:00\\\"}\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" JSON"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("parseObject")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("productInfoJSON"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("ProductInfo")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("class")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("31")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("32")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("33")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("34")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("35")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("36")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("37")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("38")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("39")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("40")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("41")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("42")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("43")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("44")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("45")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("46")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("47")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("48")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("49")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("50")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("51")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("52")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("53")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("54")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("55")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("56")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("57")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("58")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("59")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("60")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("61")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("62")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("63")]),_c('br')])]),_c('p',[_vm._v("针对这个逻辑，我有几个疑问：")]),_vm._v(" "),_c('ol',[_c('li',[_c('p',[_vm._v("疑问：视频中为什么需要在这里对 预热数据节点加锁？")]),_vm._v(" "),_c('p',[_vm._v("在代码逻辑上来看，对该 task 节点加锁之后，也就只能是加锁的机器才能访问本任务对应的预热节点数据，为什么还需要加锁？")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("疑问：这里缓存存入会存在数据竞争吗？")]),_vm._v(" "),_c('p',[_vm._v("换句话说，在 storm 中统计中，同一个商品 id 始终只会路由到一个 task 中吗？")]),_vm._v(" "),_c('p',[_vm._v("有一点没有搞明白，之前课程已经说过同一个商品 id 始终只会路由到一个 task 中，\n如果这个能保证，那么这里就不会存在数据竞争问题。")]),_vm._v(" "),_c('p',[_vm._v("相当于每个 task 中的 topn 的商品 id 都是独有的")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("疑问：缓存预热场景到现在也还没有明白")]),_vm._v(" "),_c('p',[_vm._v("缓存预热只适合在已有系统？不然预热的访问数据从何而来？")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("疑问：视频中把预热启动缓存的放在了 controller 中，不会与缓存重建产生冲突吗？")]),_vm._v(" "),_c('p',[_vm._v("这章节的思路，是项目重启的时候去异步预热缓存，如果这个时候对外开放了服务，\n那么触发了缓存重建相关的操作，就会出现数据入缓存冲突的问题；")]),_vm._v(" "),_c('p',[_vm._v("但是我记得之前说缓存预热的场景是，先预热，预热完成后，再对外开放服务。\n如果是这样的话，那么这里是没有问题的")])])])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=270.aa06cf1a.js.map