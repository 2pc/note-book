(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[279],{

/***/ "./docs/cache-pdp/114.md":
/*!*******************************!*\
  !*** ./docs/cache-pdp/114.md ***!
  \*******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _114_md_vue_type_template_id_7fc93a2e___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./114.md?vue&type=template&id=7fc93a2e& */ "./docs/cache-pdp/114.md?vue&type=template&id=7fc93a2e&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _114_md_vue_type_template_id_7fc93a2e___WEBPACK_IMPORTED_MODULE_0__["render"],
  _114_md_vue_type_template_id_7fc93a2e___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/cache-pdp/114.md?vue&type=template&id=7fc93a2e&":
/*!**************************************************************!*\
  !*** ./docs/cache-pdp/114.md?vue&type=template&id=7fc93a2e& ***!
  \**************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_114_md_vue_type_template_id_7fc93a2e___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib??ref--1-1!../../node_modules/@vuepress/markdown-loader??ref--1-2!./114.md?vue&type=template&id=7fc93a2e& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/114.md?vue&type=template&id=7fc93a2e&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_114_md_vue_type_template_id_7fc93a2e___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_114_md_vue_type_template_id_7fc93a2e___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/114.md?vue&type=template&id=7fc93a2e&":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/cache-pdp/114.md?vue&type=template&id=7fc93a2e& ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"_114-为-redis-集群崩溃时的场景部署定制化的熔断策略"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#_114-为-redis-集群崩溃时的场景部署定制化的熔断策略"}},[_vm._v("#")]),_vm._v(" 114. 为 redis 集群崩溃时的场景部署定制化的熔断策略")]),_vm._v(" "),_c('p',[_vm._v("缓存雪崩的解决方案的事中解决方案：发生缓存雪崩的时候")]),_vm._v(" "),_c('p',[_vm._v("当 redis 集群崩溃的时候，会怎样?")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("首先大量的超时、等待、报错")]),_vm._v(" "),_c('li',[_vm._v("如果是短时间内报错，会直接走 fallback 降级，直接返回 null")]),_vm._v(" "),_c('li',[_vm._v("如果是大面积超时报错，就会开启短路器")])]),_vm._v(" "),_c('p',[_vm._v("这里就涉及到这几个参数的调整，不推荐使用默认值，需要根据业务场景和一定实际测试得出来的")]),_vm._v(" "),_c('p'),_c('div',{staticClass:"table-of-contents"},[_c('ul',[_c('li',[_c('a',{attrs:{"href":"#timeout-超时"}},[_vm._v("timeout 超时")])]),_c('li',[_c('a',{attrs:{"href":"#熔断策略"}},[_vm._v("熔断策略")])]),_c('li',[_c('a',{attrs:{"href":"#有关配置代码"}},[_vm._v("有关配置代码")])]),_c('li',[_c('a',{attrs:{"href":"#hystrix-配置默认值"}},[_vm._v("hystrix 配置默认值")])])])]),_c('p'),_vm._v(" "),_c('h2',{attrs:{"id":"timeout-超时"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#timeout-超时"}},[_vm._v("#")]),_vm._v(" timeout 超时")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("HystrixCommandProperties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Setter")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n   "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("withExecutionTimeoutInMilliseconds")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("int")]),_vm._v(" value"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br')])]),_c('p',[_vm._v("实际超时参数推荐先使用 hystrix dashboard 统计下 Tp99/95/90 ，\n假设 TP99 在 100ms，设置为 100ms + 10ms 就可以了。\n（在讲 hystrix 的时候，对于这个超时的计算感觉有点复杂，没有太搞明白）")]),_vm._v(" "),_c('p',[_vm._v("配置超时的意义? 一旦 redis 出现了大面积故障，此时肯定访问耗时超过 100ms 以上，大量等待和超时，\n此时超时的意义就有了，保证了不会让大量请求阻塞过长时间。在 hystrix 中超时就走 fallback 降级了")]),_vm._v(" "),_c('h2',{attrs:{"id":"熔断策略"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#熔断策略"}},[_vm._v("#")]),_vm._v(" 熔断策略")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("HystrixCommandProperties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Setter")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("withCircuitBreakerRequestVolumeThreshold")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br')])]),_c('p',[_vm._v("在滑动窗口中（rolling window），最少有多少个请求（默认为 20），才出发短路")]),_vm._v(" "),_c('p',[_vm._v("如果设置为 20，那么在一个 10秒 的滑动窗口内，如果只有 19 个请求，就算这 19个 请求都是异常的，\n也不会出发短路器")]),_vm._v(" "),_c('p',[_vm._v("这个滑动请求数量，也应该根据业务访问量来设置；\n比如平时一般的时候，浏览也可以再每秒 QPS 100，10秒 的滑动窗口也就是 1000，\n一般来说，就可以设置为 1000 左右，该值过大或过小都不太合适")]),_vm._v(" "),_c('p',[_vm._v("举个例子：假如设置为 20 ，那么在晚上最低峰的时候，刚好是 30 ，而且刚好超时多了一些，\n结果就直接给短路了")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("HystrixCommandProperties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Setter")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("withCircuitBreakerErrorThresholdPercentage")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("50")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br')])]),_c('p',[_vm._v("这是异常请求量的百分比，当异常请求达到这个百分比时，就打开短路器，默认为 50 （也就是 50%）")]),_vm._v(" "),_c('p',[_vm._v("同样，该值也需要根据业务场景来配置，比如 redis 真正崩溃了，那么肯定是百分百都超时异常了，\n但是还有一种情况，可能是网络抖动导致短时间内超时，比如 10秒，1分钟 后就正常了")]),_vm._v(" "),_c('p',[_vm._v("还有一种业务情况，金融类支付接口：这类接口可能就会设置得很低，因为对异常必须敏感，\n可能就 10% 异常，就开启短路了，因为要求改接口必须稳定，不能容忍任何的延迟或是报错，\n一旦有 10% 异常的话，基本上就可以认为这个接口已经出问题了，再继续提供服务的话，\n有可能造成资金的错乱等问题，造成实际损失；")]),_vm._v(" "),_c('p',[_vm._v("针对我们的缓存来说，对异常不是特别的敏感，这里设置为 80%")]),_vm._v(" "),_c('div',{staticClass:"custom-block tip"},[_c('p',{staticClass:"custom-block-title"},[_vm._v("TIP")]),_vm._v(" "),_c('p',[_vm._v("RequestVolumeThreshold 与 ErrorThresholdPercentage 是一个组合参数啊，\n需要满足这两个条件才会触发，需要一起考虑")])]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("HystrixCommandProperties.Setter()\n  .withCircuitBreakerSleepWindowInMilliseconds()\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br')])]),_c('p',[_vm._v("在短路之后，需要在多长实际内直接 reject 请求？在这段时间之后，再重新 holf-open 状态，\n尝试允许请求通过以及自动回复。默认值是 5000ms")]),_vm._v(" "),_c('p',[_vm._v("同样，看场景。比如 redis 崩溃了，能在 5秒 内恢复吗？\n当然短路器开启与多方维度有关系，该值可以短一点，而且还有一个 holf-open 流程状态，\n也不能太短，太短的话，也是没有任何意义的。")]),_vm._v(" "),_c('p',[_vm._v("本列设置为 1 分钟")]),_vm._v(" "),_c('h2',{attrs:{"id":"有关配置代码"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#有关配置代码"}},[_vm._v("#")]),_vm._v(" 有关配置代码")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("andCommandPropertiesDefaults")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("HystrixCommandProperties"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("Setter")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n                "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("withExecutionTimeoutInMilliseconds")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("100")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("withCircuitBreakerRequestVolumeThreshold")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("20")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("withCircuitBreakerErrorThresholdPercentage")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("80")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("withCircuitBreakerSleepWindowInMilliseconds")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1000")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("*")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("60")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br')])]),_c('h2',{attrs:{"id":"hystrix-配置默认值"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#hystrix-配置默认值"}},[_vm._v("#")]),_vm._v(" hystrix 配置默认值")]),_vm._v(" "),_c('p',[_vm._v("在以下类中定义的")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token class-name"}},[_c('span',{pre:true,attrs:{"class":"token namespace"}},[_vm._v("com"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("netflix"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("hystrix"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")])]),_vm._v("HystrixCommandProperties")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br')])])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=279.269938d9.js.map