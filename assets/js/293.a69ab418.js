(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[293],{

/***/ "./docs/cache-pdp/dr/138.md":
/*!**********************************!*\
  !*** ./docs/cache-pdp/dr/138.md ***!
  \**********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _138_md_vue_type_template_id_6138d310___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./138.md?vue&type=template&id=6138d310& */ "./docs/cache-pdp/dr/138.md?vue&type=template&id=6138d310&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _138_md_vue_type_template_id_6138d310___WEBPACK_IMPORTED_MODULE_0__["render"],
  _138_md_vue_type_template_id_6138d310___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/cache-pdp/dr/138.md?vue&type=template&id=6138d310&":
/*!*****************************************************************!*\
  !*** ./docs/cache-pdp/dr/138.md?vue&type=template&id=6138d310& ***!
  \*****************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_138_md_vue_type_template_id_6138d310___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib??ref--1-1!../../../node_modules/@vuepress/markdown-loader??ref--1-2!./138.md?vue&type=template&id=6138d310& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/dr/138.md?vue&type=template&id=6138d310&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_138_md_vue_type_template_id_6138d310___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_138_md_vue_type_template_id_6138d310___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/dr/138.md?vue&type=template&id=6138d310&":
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/cache-pdp/dr/138.md?vue&type=template&id=6138d310& ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"_138-商品详情页动态渲染系统-redis-复习以及-twemproxy-基础知识讲解"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#_138-商品详情页动态渲染系统-redis-复习以及-twemproxy-基础知识讲解"}},[_vm._v("#")]),_vm._v(" 138. 商品详情页动态渲染系统：redis 复习以及 twemproxy 基础知识讲解")]),_vm._v(" "),_c('h2',{attrs:{"id":"部署-redis"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#部署-redis"}},[_vm._v("#")]),_vm._v(" 部署 redis")]),_vm._v(" "),_c('p',[_vm._v("本次使用 redis-2.8.19.tar.gz，关于该版本过旧问题：实际在做类似这种 nginx+lua 生产环境的部署的时候，不一定用最新的版本就是最好，老版本一般比较稳定，nginx+lua 整合用老点的版本，会比较保险一些")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" /usr/local/redis-test\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("tar")]),_vm._v(" -zxvf redis-2.8.19.tar.gz\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" redis-2.8.19\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("make")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("nohup")]),_vm._v(" /usr/local/redis-test/redis-2.8.19/src/redis-server /usr/local/redis-test/redis-2.8.19/redis.conf "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 查看 redis 进程")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ps")]),_vm._v(" -aux "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("grep")]),_vm._v(" redis\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 连接该实例")]),_vm._v("\n/usr/local/redis-test/redis-2.8.19/src/redis-cli -p "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("6379")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 简单测试是否正常存取值")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("set")]),_vm._v(" k1 v1\nget k1\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br')])]),_c('h1',{attrs:{"id":"twemproxy-部署"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#twemproxy-部署"}},[_vm._v("#")]),_vm._v(" twemproxy 部署")]),_vm._v(" "),_c('p',[_vm._v("不要使用自动安装，因为对版本有要求，自动安装的版本过低")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("yum "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("install")]),_vm._v(" -y autoconf automake libtool\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 由于对版本有要求，所以这里还是需要自己手动安装")]),_vm._v("\nyum remove -y autoconf --直接将 autoconf 和 automake、libtool 都删除掉了\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br')])]),_c('p',[_vm._v("安装到 /usr/local/twemproxy-test 目录下")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" /usr/local/twemproxy-test\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 依赖安装")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("wget")]),_vm._v(" ftp://ftp.gnu.org/gnu/autoconf/autoconf-2.69.tar.gz\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("tar")]),_vm._v(" -zxvf autoconf-2.69.tar.gz\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" autoconf-2.69\n./configure --prefix"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("/usr\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("make")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&&")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("make")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("install")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("wget")]),_vm._v(" http://ftp.gnu.org/gnu/automake/automake-1.14.tar.gz\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("tar")]),_vm._v(" -zxvf automake-1.14.tar.gz\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" automake-1.14\n./bootstrap.sh\n./configure --prefix"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("/usr\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("make")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&&")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("make")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("install")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("wget")]),_vm._v(" http://ftpmirror.gnu.org/libtool/libtool-2.4.2.tar.gz\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("tar")]),_vm._v(" -zxvf libtool-2.4.2.tar.gz\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" libtool-2.4.2\n./configure --prefix"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("/usr\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("make")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&&")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("make")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("install")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# twemproxy 安装")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("tar")]),_vm._v(" -zxvf twemproxy-0.4.0.tar.gz\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" twemproxy-0.4.0\nautoreconf -fvi\n./configure "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&&")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("make")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 修改配置文件")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" /usr/local/twemproxy-test/twemproxy-0.4.0/conf/\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 先备份一下原始配置文件")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("mv")]),_vm._v(" nutcracker.yml nutcracker.back.yml\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("vi")]),_vm._v(" nutcracker.yml\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 将一下内容写入新建的 nutcracker.yml 文件中，配置什么意思先不要管，后续会讲解")]),_vm._v("\nserver1:  \n  listen: "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("127.0")]),_vm._v(".0.1:1111  \n  hash: fnv1a_64  \n  distribution: ketama  \n  redis: "),_c('span',{pre:true,attrs:{"class":"token boolean"}},[_vm._v("true")]),_vm._v("  \n  servers:  \n   - "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("127.0")]),_vm._v(".0.1:6379:1\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 启动：-d 后台启动 -c 指定配置文件")]),_vm._v("\n/usr/local/twemproxy-test/twemproxy-0.4.0/src/nutcracker -d -c /usr/local/twemproxy-test/twemproxy-0.4.0/conf/nutcracker.yml\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 查看启动进程")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ps")]),_vm._v(" -aux "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("grep")]),_vm._v(" nutcracker\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 使用 redis-cli 连接到 tewmproxy 中间件")]),_vm._v("\n/usr/local/redis-test/redis-2.8.19/src/redis-cli -p "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1111")]),_vm._v("  \n\nget k1\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("set")]),_vm._v(" k1 v2\nget k1\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("31")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("32")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("33")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("34")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("35")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("36")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("37")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("38")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("39")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("40")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("41")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("42")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("43")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("44")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("45")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("46")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("47")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("48")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("49")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("50")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("51")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("52")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("53")]),_c('br')])]),_c('h2',{attrs:{"id":"redis-复习"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#redis-复习"}},[_vm._v("#")]),_vm._v(" redis 复习")]),_vm._v(" "),_c('p',[_vm._v("这里的复习，本人未练习，之前讲过的")]),_vm._v(" "),_c('h3',{attrs:{"id":"redis-部分配置"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#redis-部分配置"}},[_vm._v("#")]),_vm._v(" redis 部分配置")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("redis.conf\n\nport 6379\nlogfile \"\"\nmaxmemory 100mb\nmaxmemory-policy volatile-lru\nmaxmemory-samples 10\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br')])]),_c('h3',{attrs:{"id":"redis-主从"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#redis-主从"}},[_vm._v("#")]),_vm._v(" redis 主从")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 两份文件分别将端口设置为 6379 和 6380")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("cp")]),_vm._v(" redis.conf redis_6379.conf\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("cp")]),_vm._v(" redis.conf redis_6380.conf\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 分别启动两个 redis 实例")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("nohup")]),_vm._v(" /usr/local/redis-2.8.19/src/redis-server  /usr/local/redis-2.8.19/redis_6379.conf "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&")]),_vm._v("  \n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("nohup")]),_vm._v(" /usr/local/redis-2.8.19/src/redis-server  /usr/local/redis-2.8.19/redis_6380.conf "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ps")]),_vm._v(" -aux "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("grep")]),_vm._v(" redis\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 通过从实例客户端挂载主从")]),_vm._v("\n/usr/local/redis-2.8.19/src/redis-cli  -p "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("6380")]),_vm._v("\nslaveof "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("127.0")]),_vm._v(".0.1 "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("6379")]),_vm._v("\ninfo replication\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 测试注册是否正常")]),_vm._v("\n/usr/local/redis-2.8.19/src/redis-cli -p "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("6379")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("set")]),_vm._v(" k2 v2\n\n/usr/local/redis-2.8.19/src/redis-cli -p "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("6380")]),_vm._v("\nget k2\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br')])]),_c('h1',{attrs:{"id":"twemproxy-讲解"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#twemproxy-讲解"}},[_vm._v("#")]),_vm._v(" twemproxy 讲解")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("eshop-detail-test")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("  \n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("listen")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" 127.0.0.1"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1111")]),_vm._v("  \n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("hash")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" fnv1a_64  \n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("distribution")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" ketama  \n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("timeout")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1000")]),_vm._v("  \n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("redis")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean important"}},[_vm._v("true")]),_vm._v("  \n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("servers")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("  \n   "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v(" 127.0.0.1"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("6379"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("1 test"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("redis"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("01")]),_vm._v("\n   "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v(" 127.0.0.1"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("6380"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("1 test"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("redis"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("02")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br')])]),_c('ul',[_c('li',[_c('p',[_vm._v("eshop-detail-test：redis 集群的逻辑名称")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("listen：twemproxy 监听的端口号")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("hash：hash 散列算法")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("distribution：分片算法：有一致性 hash、取模等")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("timeout：与 redis 连接的超时时长")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("redis：true 为 redis，否则是 memcached")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("servers：redis 实例列表")]),_vm._v(" "),_c('p',[_vm._v("一定要加别名，否则默认使用 ip:port:weight 来计算分片，如果宕机后更换机器，那么分片就不一样了，因此加了别名后，可以确保分片一定是准确的")])])]),_vm._v(" "),_c('p',[_vm._v("你的客户端，java/nginx+lua，连接 twemproxy 写数据的时候，twemproxy 负责将数据分片，写入不同的 redis 实例")]),_vm._v(" "),_c('p',[_vm._v("如果某个 redis 机器宕机，需要自动从一致性 hash 环上摘掉，等恢复后自动上线，可以使用以下配置")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("auto_eject_hosts")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean important"}},[_vm._v("true")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("server_retry_timeout")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("30000")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("server_failure_limit")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br')])]),_c('ul',[_c('li',[_vm._v("auto_eject_hosts：自动摘除故障节点")]),_vm._v(" "),_c('li',[_vm._v("server_retry_timeout：每隔 30 秒判断故障节点是否正常，如果正常则放回一致性 hash 环")]),_vm._v(" "),_c('li',[_vm._v("server_failure_limit：多少次无响应，就从一致性 hash 环中摘除")])]),_vm._v(" "),_c('p',[_vm._v("关于"),_c('RouterLink',{attrs:{"to":"/cache-pdp/redis/027.html#一致性-hash-算法（自动缓存迁移）-虚拟节点（自动负载均衡）"}},[_vm._v("一致性 hash")]),_vm._v(" 前面也讲解过了")],1)])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=293.a69ab418.js.map