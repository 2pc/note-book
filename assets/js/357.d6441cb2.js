(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[357],{

/***/ "./docs/cache-pdp/redis/018.md":
/*!*************************************!*\
  !*** ./docs/cache-pdp/redis/018.md ***!
  \*************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _018_md_vue_type_template_id_56d37b52___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./018.md?vue&type=template&id=56d37b52& */ "./docs/cache-pdp/redis/018.md?vue&type=template&id=56d37b52&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _018_md_vue_type_template_id_56d37b52___WEBPACK_IMPORTED_MODULE_0__["render"],
  _018_md_vue_type_template_id_56d37b52___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/cache-pdp/redis/018.md?vue&type=template&id=56d37b52&":
/*!********************************************************************!*\
  !*** ./docs/cache-pdp/redis/018.md?vue&type=template&id=56d37b52& ***!
  \********************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_018_md_vue_type_template_id_56d37b52___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib??ref--1-1!../../../node_modules/@vuepress/markdown-loader??ref--1-2!./018.md?vue&type=template&id=56d37b52& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/redis/018.md?vue&type=template&id=56d37b52&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_018_md_vue_type_template_id_56d37b52___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_018_md_vue_type_template_id_56d37b52___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/redis/018.md?vue&type=template&id=56d37b52&":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/cache-pdp/redis/018.md?vue&type=template&id=56d37b52& ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"_018-在项目中部署-redis-的读写分离架构-包含节点间认证口令"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#_018-在项目中部署-redis-的读写分离架构-包含节点间认证口令"}},[_vm._v("#")]),_vm._v(" 018. 在项目中部署 redis 的读写分离架构（包含节点间认证口令）")]),_vm._v(" "),_c('p'),_c('div',{staticClass:"table-of-contents"},[_c('ul',[_c('li',[_c('a',{attrs:{"href":"#启用复制-部署-slave-node"}},[_vm._v("启用复制，部署 slave node")])]),_c('li',[_c('a',{attrs:{"href":"#强制读写分离"}},[_vm._v("强制读写分离")])]),_c('li',[_c('a',{attrs:{"href":"#集群安全认证"}},[_vm._v("集群安全认证")])]),_c('li',[_c('a',{attrs:{"href":"#读写分离架构的测试"}},[_vm._v("读写分离架构的测试")]),_c('ul',[_c('li',[_c('a',{attrs:{"href":"#在-master-上写数据"}},[_vm._v("在 master 上写数据")])]),_c('li',[_c('a',{attrs:{"href":"#在-slave-上获取数据"}},[_vm._v("在 slave 上获取数据")])])])])])]),_c('p'),_vm._v(" "),_c('p',[_vm._v("之前几讲都是在铺垫各种 redis replication 的原理和知识，那么关键是怎么搭建呢？")]),_vm._v(" "),_c('p',[_vm._v("本章讲解 一主一从，往主节点去写，在从节点去读，可以读到，主从架构就搭建成功了")]),_vm._v(" "),_c('h2',{attrs:{"id":"启用复制-部署-slave-node"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#启用复制-部署-slave-node"}},[_vm._v("#")]),_vm._v(" 启用复制，部署 slave node")]),_vm._v(" "),_c('p',[_vm._v("在 eshop-cache02 上安装 redis，"),_c('RouterLink',{attrs:{"to":"/cache-pdp/redis/007.html"}},[_vm._v("可参考之前的章节")]),_vm._v(" 中的「安装单机版 redis」与\n「redis 的生产环境启动方案」")],1),_vm._v(" "),_c('p',[_vm._v("安装好之后，开启 "),_c('code',[_vm._v("slaveof <masterip> <masterport>")]),_vm._v(" 属性，把该机器变成 slave node")]),_vm._v(" "),_c('p',[_vm._v("/etc/redis/6379.conf")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("slaveof eshop-cache01 "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("6379")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br')])]),_c('h2',{attrs:{"id":"强制读写分离"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#强制读写分离"}},[_vm._v("#")]),_vm._v(" 强制读写分离")]),_vm._v(" "),_c('p',[_vm._v("基于主从复制架构，实现读写分离")]),_vm._v(" "),_c('p',[_vm._v("/etc/redis/6379.conf")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 该属性已经默认开启，")]),_vm._v("\nslave-read-only "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("yes")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br')])]),_c('p',[_vm._v("开启了只读的 redis slave node，会拒绝所有的写操作，这样可以强制搭建成读写分离的架构")]),_vm._v(" "),_c('h2',{attrs:{"id":"集群安全认证"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#集群安全认证"}},[_vm._v("#")]),_vm._v(" 集群安全认证")]),_vm._v(" "),_c('p',[_vm._v("master 上启用安全认证：requirepass")]),_vm._v(" "),_c('p',[_vm._v("eshop-cache01/etc/redis/6379.conf")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("requirepass redis-pass\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br')])]),_c('p',[_vm._v("slave 上使用连接口令：masterauth")]),_vm._v(" "),_c('p',[_vm._v("eshop-cache02/etc/redis/6379.conf")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("masterauth redis-pass\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br')])]),_c('p',[_vm._v("也就是 master 启用密码，slave 要持有相同的密码才能连接上")]),_vm._v(" "),_c('p',[_vm._v("配置完成后，记得重启")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("cd")]),_vm._v(" /etc/init.d/\nredis-cli "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("shutdown")]),_vm._v("\n./redis_6379 start\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br')])]),_c('div',{staticClass:"custom-block warning"},[_c('p',{staticClass:"custom-block-title"},[_vm._v("WARNING")]),_vm._v(" "),_c('p',[_vm._v("由于配置名称都一样，不要上传错了。")])]),_vm._v(" "),_c('h2',{attrs:{"id":"读写分离架构的测试"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#读写分离架构的测试"}},[_vm._v("#")]),_vm._v(" 读写分离架构的测试")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("先启动主节点，eshop-cache01 上的 redis实例")]),_vm._v(" "),_c('li',[_vm._v("再启动从节点，eshop-cache02 上的 redis实例")])]),_vm._v(" "),_c('p',[_vm._v("在 eshop-cache01 上尝试获取数据")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_vm._v("root@eshop-cache01 init.d"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# redis-cli")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("127.0")]),_vm._v(".0.1:637"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_c('span',{pre:true,attrs:{"class":"token file-descriptor important"}},[_vm._v("9")]),_vm._v(">")]),_vm._v(" get k1\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("error"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" NOAUTH Authentication required.\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br')])]),_c('p',[_vm._v("会发现报错了，原因是之前我们开启了密码，这个时候要怎么连接 redis-cli 呢？")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_vm._v("root@eshop-cache01 init.d"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# redis-cli -h")]),_vm._v("\nredis-cli "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("3.2")]),_vm._v(".8\n\nUsage: redis-cli "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_vm._v("OPTIONS"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_vm._v("cmd "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_vm._v("arg "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_vm._v("arg "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v("."),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v("\n  -h "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("hostname"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("      Server "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("hostname")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("default: "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("127.0")]),_vm._v(".0.1"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(".\n  -p "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("port"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("          Server port "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("default: "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("6379")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(".\n  -s "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("socket"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("        Server socket "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("overrides "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("hostname")]),_vm._v(" and port"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(".\n  -a "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("password"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("      Password to use when connecting to the server.\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br')])]),_c('p',[_vm._v("可以看到帮助命令需要使用 -a 来指定密码")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_vm._v("root@eshop-cache01 init.d"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# redis-cli -a redis-pass")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("127.0")]),_vm._v(".0.1:637"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_c('span',{pre:true,attrs:{"class":"token file-descriptor important"}},[_vm._v("9")]),_vm._v(">")]),_vm._v(" get k1\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("nil"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 注意，在关闭 redis 的时候同样也需要使用密码")]),_vm._v("\n\nredis-cli -a redis-pass "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("shutdown")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br')])]),_c('h3',{attrs:{"id":"在-master-上写数据"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#在-master-上写数据"}},[_vm._v("#")]),_vm._v(" 在 master 上写数据")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("[root@eshop-cache01 init.d]# redis-cli -a redis-pass\n127.0.0.1:6379> set k1 123456\nOK\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br')])]),_c('h3',{attrs:{"id":"在-slave-上获取数据"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#在-slave-上获取数据"}},[_vm._v("#")]),_vm._v(" 在 slave 上获取数据")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("[root@eshop-cache02 init.d]# redis-cli\n127.0.0.1:6379> get k1\n(nil)\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br')])]),_c('p',[_vm._v("发现没有获取到数据，这是怎么回事呢？那么一般说明我们的 slave 可能配置有问题。")]),_vm._v(" "),_c('p',[_vm._v("这个时候要是能看到日志就好了，在 "),_c('code',[_vm._v("eshop-cache02/etc/redis/6379.conf")]),_vm._v("中，\n配置上 "),_c('code',[_vm._v("logfile /etc/redis/log.log")]),_vm._v(" 重启后可以看到日志中出现不能连接到 master")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("[root@eshop-cache02 redis]# ll\ntotal 52\n-rw-r--r-- 1 root root 46774 Mar 23  2019 6379.conf\n-rw-r--r-- 1 root root  2719 Mar 19 05:14 log.log\n[root@eshop-cache02 redis]# tail -f log.log\n24489:S 19 Mar 05:14:28.768 # Error condition on socket for SYNC: Connection refused\n24489:S 19 Mar 05:14:29.789 * Connecting to MASTER eshop-cache01:6379\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br')])]),_c('p',[_vm._v("原因是：/etc/redis/6379.conf 中的 bind 属性配置没有放开")]),_vm._v(" "),_c('p',[_vm._v("默认是绑定的 127.0.0.1，只能本机访问 redis。改成本机的内外 ip 地址就可以对外提供服务了，这里由于之前配置了 hosts 映射，使用 hostname")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("# bind 127.0.0.1   \nbind 127.0.0.1 eshop-cache01\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br')])]),_c('div',{staticClass:"custom-block tip"},[_c('p',{staticClass:"custom-block-title"},[_vm._v("TIP")]),_vm._v(" "),_c('p',[_vm._v("bind 可以写多条，如果没有 127 的ip，使用 redis-cli 会默认连接 127 的 ip，这样你自己也不能使用这个本机简便的登录方式了")]),_vm._v(" "),_c('p',[_vm._v("如果已经使用 redis-cli 连接不上怎么办？需要自己带上 ip 地址访问，如下：\nredis-cli -h eshop-cache02 shutdown")])]),_vm._v(" "),_c('p',[_vm._v("记得是每个 redis 节点上都要修改成绑定自己机器的 hontname")]),_vm._v(" "),_c('p',[_vm._v("对外开放访问后（bind 127.0.0.1 eshop-cache01） 终于连接上了")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("[root@eshop-cache02 init.d]# ./redis_6379 start\nStarting Redis server...\n[root@eshop-cache02 init.d]# redis-cli\n127.0.0.1:6379> get k1   # 能获取到 master 上的数据\n\"123456\"\n127.0.0.1:6379> info replication   # 查看信息\n# Replication\nrole:slave\nmaster_host:eshop-cache01     # 可以看到 master 的信息\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:1\nmaster_sync_in_progress:0\nslave_repl_offset:253\nslave_priority:100\nslave_read_only:1\nconnected_slaves:0\nmaster_repl_offset:0\nrepl_backlog_active:0\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:0\nrepl_backlog_histlen:0\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br')])])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=357.d6441cb2.js.map