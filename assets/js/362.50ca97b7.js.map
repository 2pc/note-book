{"version":3,"sources":["webpack:///./docs/cache-pdp/redis/025.md","webpack:///./docs/cache-pdp/redis/025.md?275f","webpack:///./docs/cache-pdp/redis/025.md?18b2"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAiF;AACjF;;;AAGA;AAC6F;AAC7F,gBAAgB,2GAAU;AAC1B;AACA,EAAE,6EAAM;AACR,EAAE,sFAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEe,gF;;;;;;;;;;;;ACjBf;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA,0BAA0B,aAAa,0BAA0B,wBAAwB,qCAAqC,OAAO,gCAAgC,WAAW,OAAO,8CAA8C,UAAU,mCAAmC,iDAAiD,iGAAiG,gCAAgC,4BAA4B,OAAO,6BAA6B,mDAAmD,OAAO,iCAAiC,uDAAuD,OAAO,0BAA0B,gDAAgD,OAAO,gBAAgB,sCAAsC,OAAO,qBAAqB,2DAA2D,OAAO,mBAAmB,UAAU,mCAAmC,sBAAsB,6RAA6R,0CAA0C,YAAY,gBAAgB,yBAAyB,kHAAkH,mCAAmC,aAAa,0BAA0B,iHAAiH,0CAA0C,YAAY,gBAAgB,yBAAyB,gLAAgL,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,qqBAAqqB,OAAO,0BAA0B,UAAU,mCAAmC,6BAA6B,iNAAiN,OAAO,8BAA8B,UAAU,mCAAmC,iCAAiC,oJAAoJ,OAAO,uBAAuB,UAAU,mCAAmC,0BAA0B,yVAAyV,OAAO,aAAa,UAAU,mCAAmC,gBAAgB,2PAA2P,0CAA0C,YAAY,gBAAgB,yBAAyB,6XAA6X,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,yQAAyQ,0CAA0C,YAAY,gBAAgB,yBAAyB,qxEAAqxE,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,seAAse,oBAAoB,iTAAiT,0CAA0C,YAAY,gBAAgB,yBAAyB,oIAAoI,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,4FAA4F,0CAA0C,YAAY,gBAAgB,yBAAyB,mwBAAmwB,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,wFAAwF,0CAA0C,YAAY,gBAAgB,yBAAyB,kUAAkU,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,sYAAsY,OAAO,kBAAkB,UAAU,mCAAmC,qBAAqB,+HAA+H,0CAA0C,YAAY,gBAAgB,yBAAyB,oIAAoI,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,iFAAiF,0CAA0C,YAAY,gBAAgB,yBAAyB,mFAAmF,mCAAmC,aAAa,0BAA0B;AAC7hd","file":"assets/js/362.50ca97b7.js","sourcesContent":["import { render, staticRenderFns } from \"./025.md?vue&type=template&id=86e0dfc0&\"\nvar script = {}\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/@vuepress/core/node_modules/.cache/vuepress\\\",\\\"cacheIdentifier\\\":\\\"2e9acca5-vue-loader-template\\\"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??ref--1-1!../../../node_modules/@vuepress/markdown-loader/index.js??ref--1-2!./025.md?vue&type=template&id=86e0dfc0&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{\"slot-key\":_vm.$parent.slotKey}},[_c('h1',{attrs:{\"id\":\"_025-对项目中的哨兵节点进行管理以及高可用-redis-集群的容灾演练\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#_025-对项目中的哨兵节点进行管理以及高可用-redis-集群的容灾演练\"}},[_vm._v(\"#\")]),_vm._v(\" 025. 对项目中的哨兵节点进行管理以及高可用 redis 集群的容灾演练\")]),_vm._v(\" \"),_c('p'),_c('div',{staticClass:\"table-of-contents\"},[_c('ul',[_c('li',[_c('a',{attrs:{\"href\":\"#redis-slave-的永久下线\"}},[_vm._v(\"redis slave 的永久下线\")])]),_c('li',[_c('a',{attrs:{\"href\":\"#slave-切换为-master-的优先级\"}},[_vm._v(\"slave 切换为 Master 的优先级\")])]),_c('li',[_c('a',{attrs:{\"href\":\"#基于哨兵集群架构下的安全认证\"}},[_vm._v(\"基于哨兵集群架构下的安全认证\")])]),_c('li',[_c('a',{attrs:{\"href\":\"#容灾演练\"}},[_vm._v(\"容灾演练\")])]),_c('li',[_c('a',{attrs:{\"href\":\"#哨兵的生产环境部署\"}},[_vm._v(\"哨兵的生产环境部署\")])])])]),_c('p'),_vm._v(\" \"),_c('h1',{attrs:{\"id\":\"哨兵节点的增加和删除\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#哨兵节点的增加和删除\"}},[_vm._v(\"#\")]),_vm._v(\" 哨兵节点的增加和删除\")]),_vm._v(\" \"),_c('p',[_vm._v(\"首先增加 sentinal 有自动发现功能，发现之后就把该哨兵信息添加到自己信息中了，这个可以通过一个实验来证明：\")]),_vm._v(\" \"),_c('ol',[_c('li',[_c('p',[_vm._v(\"上一章启动了 3 台 sentinal，\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"在机器重启之后，只启动其中的一台机器\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"[root@eshop-cache03 ~]# redis-sentinel /etc/sentinal/5000.conf\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br')])])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"连接上查看 sentinals 信息\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"redis-cli -p 5000 -h eshop-cache03\\n\\neshop-cache03:5000> sentinel sentinels mymaster\\n会发现出现了 01 和 02 的信息，但是此时 01 和 02 并没有启动\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br')])])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"执行 \"),_c('code',[_vm._v(\"SENTINEL RESET *\")]),_vm._v(\" 命令\")]),_vm._v(\" \"),_c('p',[_vm._v(\"执行之后，再次查看 sentinel sentinels mymaster 信息，会发现变成空的了，消失了\")])])]),_vm._v(\" \"),_c('p',[_vm._v(\"删除 sentinal 的步骤\")]),_vm._v(\" \"),_c('ol',[_c('li',[_c('p',[_vm._v(\"停止 sentinal 进程\")])]),_vm._v(\" \"),_c('li',[_c('p',[_c('code',[_vm._v(\"SENTINEL RESET *\")]),_vm._v(\" （重要）\")]),_vm._v(\" \"),_c('p',[_vm._v(\"在所有存活的 sentinal 上执行，清理所有的 master 状态\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"SENTINEL MASTER mastername\")]),_vm._v(\" \"),_c('p',[_vm._v(\"在所有存活的 sentinal 上执行，查看自己对 mastername 的集群信息是否与其他 sentinal 一致\")])])]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"redis-slave-的永久下线\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#redis-slave-的永久下线\"}},[_vm._v(\"#\")]),_vm._v(\" redis slave 的永久下线\")]),_vm._v(\" \"),_c('p',[_vm._v(\"让 master 摘除某个已经下线的 slave：SENTINEL RESET mastername，在所有的哨兵上面执行\")]),_vm._v(\" \"),_c('p',[_vm._v(\"其实还是重置检查一下的有意思\")]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"slave-切换为-master-的优先级\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#slave-切换为-master-的优先级\"}},[_vm._v(\"#\")]),_vm._v(\" slave 切换为 Master 的优先级\")]),_vm._v(\" \"),_c('p',[_vm._v(\"slave->master 选举优先级：slave-priority，值越小优先级越高\")]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"基于哨兵集群架构下的安全认证\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#基于哨兵集群架构下的安全认证\"}},[_vm._v(\"#\")]),_vm._v(\" 基于哨兵集群架构下的安全认证\")]),_vm._v(\" \"),_c('p',[_vm._v(\"每个 slave 都有可能切换成 master，所以每个实例都要配置两个指令\")]),_vm._v(\" \"),_c('p',[_vm._v(\"master 上启用安全认证，requirepass\\nmaster 连接口令，masterauth\")]),_vm._v(\" \"),_c('p',[_vm._v(\"在 sentinal 的配置文件里面配置密码： \"),_c('code',[_vm._v(\"sentinel auth-pass <master-group-name> <pass>\")])]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"容灾演练\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#容灾演练\"}},[_vm._v(\"#\")]),_vm._v(\" 容灾演练\")]),_vm._v(\" \"),_c('p',[_vm._v(\"通过哨兵看一下当前的 master：\"),_c('code',[_vm._v(\"SENTINEL get-master-addr-by-name mymaster\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"这里的 master 在 02 上面，直接 kill 掉 master；查看 哨兵的日志变化\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"[root@eshop-cache02 ~]# ps -ef | grep redis\\nroot       960     1  2 01:00 ?        00:00:42 /usr/local/bin/redis-server 127.0.0.1:6379      \\nroot      1049  1009  3 01:21 pts/0    00:00:26 redis-sentinel eshop-cache02:5000 [sentinel]\\nroot      1068  1054  0 01:33 pts/1    00:00:00 grep redis\\n[root@eshop-cache02 ~]# kill 960\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br')])]),_c('p',[_vm._v(\"等待一会，该配置时间 \"),_c('code',[_vm._v(\"sentinel down-after-milliseconds mymaster 30000\")]),_vm._v(\" 30 秒后，\\n可以看到哨兵日志发生了变化\")]),_vm._v(\" \"),_c('p',[_vm._v(\"注意：下面的日志是在切换 master 的哨兵上看到的。非切换的哨兵日志上不会有这么多信息\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"1037:X 24 Mar 01:55:05.525 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\\n1037:X 24 Mar 01:55:05.525 # Sentinel ID is 507b3bc6e379011b990bda44b73221b8f7b305c1\\n1037:X 24 Mar 01:55:05.525 # +monitor master mymaster 192.168.99.171 6379 quorum 2\\n1037:X 24 Mar 01:55:15.551 * +convert-to-slave slave 192.168.99.170:6379 192.168.99.170 6379 @ mymaster 192.168.99.171 6379\\n1037:X 24 Mar 01:57:07.924 # +sdown master mymaster 192.168.99.171 6379\\n1037:X 24 Mar 01:57:08.013 # +odown master mymaster 192.168.99.171 6379 #quorum 2/2\\n1037:X 24 Mar 01:57:08.013 # +new-epoch 3\\n1037:X 24 Mar 01:57:08.013 # +try-failover master mymaster 192.168.99.171 6379\\n1037:X 24 Mar 01:57:08.027 # +vote-for-leader 507b3bc6e379011b990bda44b73221b8f7b305c1 3\\n1037:X 24 Mar 01:57:08.138 # a1cd62295346683bcd8f8b388ac64e83897a13dd voted for a1cd62295346683bcd8f8b388ac64e83897a13dd 3\\n1037:X 24 Mar 01:57:08.152 # d7a9812a3f905d07df46986f1b21388a16df39b4 voted for 507b3bc6e379011b990bda44b73221b8f7b305c1 3\\n1037:X 24 Mar 01:57:08.207 # +elected-leader master mymaster 192.168.99.171 6379\\n1037:X 24 Mar 01:57:08.207 # +failover-state-select-slave master mymaster 192.168.99.171 6379\\n1037:X 24 Mar 01:57:08.291 # +selected-slave slave 192.168.99.170:6379 192.168.99.170 6379 @ mymaster 192.168.99.171 6379\\n1037:X 24 Mar 01:57:08.291 * +failover-state-send-slaveof-noone slave 192.168.99.170:6379 192.168.99.170 6379 @ mymaster 192.168.99.171 6379\\n1037:X 24 Mar 01:57:08.351 * +failover-state-wait-promotion slave 192.168.99.170:6379 192.168.99.170 6379 @ mymaster 192.168.99.171 6379\\n1037:X 24 Mar 01:57:08.947 # +promoted-slave slave 192.168.99.170:6379 192.168.99.170 6379 @ mymaster 192.168.99.171 6379\\n1037:X 24 Mar 01:57:08.947 # +failover-state-reconf-slaves master mymaster 192.168.99.171 6379\\n1037:X 24 Mar 01:57:08.979 # +failover-end master mymaster 192.168.99.171 6379\\n1037:X 24 Mar 01:57:08.982 # +switch-master mymaster 192.168.99.171 6379 192.168.99.170 6379\\n1037:X 24 Mar 01:57:08.983 * +slave slave 192.168.99.171:6379 192.168.99.171 6379 @ mymaster 192.168.99.170 6379\\n1037:X 24 Mar 01:57:39.038 # +sdown slave 192.168.99.171:6379 192.168.99.171 6379 @ mymaster 192.168.99.170 6379\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"8\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"9\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"10\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"11\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"12\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"13\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"14\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"15\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"16\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"17\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"18\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"19\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"20\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"21\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"22\")]),_c('br')])]),_c('ol',[_c('li',[_vm._v(\"三个哨兵进程都认为 master 是 sdown 了\")]),_vm._v(\" \"),_c('li',[_vm._v(\"超过 quorum 指定的哨兵进程都认为 sdown 之后，就变为 odown\")]),_vm._v(\" \"),_c('li',[_vm._v(\"哨兵 1 是被选举为要执行后续的主备切换的那个哨兵\")]),_vm._v(\" \"),_c('li',[_vm._v(\"哨兵 1 去新的 master（slave）获取了一个新的 config version\")]),_vm._v(\" \"),_c('li',[_vm._v(\"尝试执行 failover\")]),_vm._v(\" \"),_c('li',[_vm._v(\"投票选举出一个 slave 区切换成 master，每个哨兵都会执行一次投票\")]),_vm._v(\" \"),_c('li',[_vm._v(\"让 salve，slaveof noone，不让它去做任何节点的 slave 了; 把 slave 提拔成 master; 旧的 master 认为不再是 master 了\")]),_vm._v(\" \"),_c('li',[_vm._v(\"哨兵就自动认为之前的 171:6379 变成了 slave 了，190:6379 变成了 master 了\")]),_vm._v(\" \"),_c('li',[_vm._v(\"哨兵去探查了一下 171:6379 这个 salve 的状态，认为它 sdown 了\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"此时再查看 /etc/sentinal/5000.conf 中的配置文件的时候，会发现一些配置跟着改变了，比如\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"# 最开始我们配置的是 hostname，这里被更新成了 ip\\nsentinel monitor mymaster 192.168.99.170 6379 2\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br')])]),_c('p',[_vm._v(\"将旧的 master 重新启动，查看变化\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"[root@eshop-cache02 ~]# /etc/init.d/redis_6379 start\\n/var/run/redis_6379.pid exists, process is already running or crashed\\n[root@eshop-cache02 ~]# rm -rf /var/run/redis_6379.pid\\n[root@eshop-cache02 ~]# /etc/init.d/redis_6379 start\\nStarting Redis server...\\n[root@eshop-cache02 ~]# redis-cli\\n127.0.0.1:6379> info replication\\n# Replication\\nrole:slave      // 这里，重启之后变成了 slave\\nmaster_host:192.168.99.170\\nmaster_port:6379\\nmaster_link_status:up\\nmaster_last_io_seconds_ago:0\\nmaster_sync_in_progress:0\\nslave_repl_offset:1160\\nslave_priority:100\\nslave_read_only:1\\nconnected_slaves:0\\nmaster_repl_offset:0\\nrepl_backlog_active:0\\nrepl_backlog_size:1048576\\nrepl_backlog_first_byte_offset:0\\nrepl_backlog_histlen:0\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"8\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"9\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"10\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"11\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"12\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"13\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"14\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"15\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"16\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"17\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"18\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"19\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"20\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"21\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"22\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"23\")]),_c('br')])]),_c('p',[_vm._v(\"看看之前执行故障转移的哨兵日志\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"# sdown 状态变成了减号\\n1037:X 24 Mar 02:09:43.363 # -sdown slave 192.168.99.171:6379 192.168.99.171 6379 @ mymaster 192.168.99.170 6379\\n# 并且转换成了 slave\\n1037:X 24 Mar 02:09:53.373 * +convert-to-slave slave 192.168.99.171:6379 192.168.99.171 6379 @ mymaster 192.168.99.170 6379\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br')])]),_c('p',[_vm._v(\"小结：\")]),_vm._v(\" \"),_c('ol',[_c('li',[_vm._v(\"手动杀掉master\")]),_vm._v(\" \"),_c('li',[_vm._v(\"哨兵能否执行主备切换，将 slave 切换为 master\")]),_vm._v(\" \"),_c('li',[_vm._v(\"哨兵完成主备切换后，新的 master 能否使用\")]),_vm._v(\" \"),_c('li',[_vm._v(\"故障恢复，将旧的 master 重新启动\")]),_vm._v(\" \"),_c('li',[_vm._v(\"哨兵能否自动将旧的 master 变为 slave，挂接到新的 master 上面去，而且也是可以使用的\")])]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"哨兵的生产环境部署\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#哨兵的生产环境部署\"}},[_vm._v(\"#\")]),_vm._v(\" 哨兵的生产环境部署\")]),_vm._v(\" \"),_c('p',[_vm._v(\"在 /etc/sentinal/5000.conf 中增加两个配置\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"# 后台启动\\ndaemonize yes\\n# 把日志打印到指定位置\\nlogfile /var/log/sentinal/5000/sentinal.log\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br')])]),_c('p',[_vm._v(\"记得要把目录创建好\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"mkdir -p /var/log/sentinal/5000\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br')])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}