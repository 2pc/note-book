{"version":3,"sources":["webpack:///./docs/elasticsearch-senior/aggs/53-doc-value.md","webpack:///./docs/elasticsearch-senior/aggs/53-doc-value.md?ad3b","webpack:///./docs/elasticsearch-senior/aggs/53-doc-value.md?9e94"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAA0F;AAC1F;;;AAGA;AAC6F;AAC7F,gBAAgB,2GAAU;AAC1B;AACA,EAAE,sFAAM;AACR,EAAE,+FAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEe,gF;;;;;;;;;;;;ACjBf;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA,0BAA0B,aAAa,0BAA0B,wBAAwB,qCAAqC,OAAO,gCAAgC,WAAW,OAAO,8BAA8B,UAAU,mCAAmC,iCAAiC,4KAA4K,OAAO,oBAAoB,UAAU,mCAAmC,uBAAuB,urBAAurB,OAAO,kBAAkB,UAAU,mCAAmC,qBAAqB,oGAAoG,0CAA0C,YAAY,gBAAgB,yBAAyB,mFAAmF,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,6lBAA6lB,OAAO,0BAA0B,UAAU,mCAAmC,6BAA6B,kJAAkJ,8CAA8C,YAAY,gBAAgB,yBAAyB,iDAAiD,gBAAgB,6BAA6B,WAAW,+BAA+B,gBAAgB,0BAA0B,sCAAsC,gBAAgB,0BAA0B,uCAAuC,gBAAgB,6BAA6B,WAAW,iCAAiC,gBAAgB,0BAA0B,qCAAqC,gBAAgB,0BAA0B,uCAAuC,gBAAgB,6BAA6B,WAAW,mCAAmC,gBAAgB,0BAA0B,wCAAwC,gBAAgB,0BAA0B,uCAAuC,gBAAgB,6BAA6B,WAAW,qCAAqC,gBAAgB,0BAA0B,sCAAsC,gBAAgB,0BAA0B,uCAAuC,gBAAgB,6BAA6B,WAAW,uCAAuC,gBAAgB,0BAA0B,kCAAkC,gBAAgB,0BAA0B,uCAAuC,gBAAgB,wBAAwB,qCAAqC,gBAAgB,6BAA6B,kDAAkD,gBAAgB,0BAA0B,wCAAwC,gBAAgB,0BAA0B,uCAAuC,gBAAgB,yBAAyB,oDAAoD,gBAAgB,6BAA6B,WAAW,mCAAmC,gBAAgB,6BAA6B,WAAW,iCAAiC,gBAAgB,6BAA6B,WAAW,+BAA+B,gBAAgB,6BAA6B,WAAW,6BAA6B,gBAAgB,6BAA6B,WAAW,4CAA4C,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B,qCAAqC,0BAA0B;AACxpL","file":"assets/js/436.a4d3729b.js","sourcesContent":["import { render, staticRenderFns } from \"./53-doc-value.md?vue&type=template&id=61a74abe&\"\nvar script = {}\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/@vuepress/core/node_modules/.cache/vuepress\\\",\\\"cacheIdentifier\\\":\\\"2e9acca5-vue-loader-template\\\"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??ref--1-1!../../../node_modules/@vuepress/markdown-loader/index.js??ref--1-2!./53-doc-value.md?vue&type=template&id=61a74abe&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{\"slot-key\":_vm.$parent.slotKey}},[_c('h1',{attrs:{\"id\":\"doc-value-机制内核级原理深入探秘\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#doc-value-机制内核级原理深入探秘\"}},[_vm._v(\"#\")]),_vm._v(\" doc value 机制内核级原理深入探秘\")]),_vm._v(\" \"),_c('p',[_vm._v(\"对于 doc value，我一直以为就类似于 mysql 表数据一样，基于 id 获取的，\\n但是看这章节并不是，所以看完还是懵逼状态\")]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"doc-value原理\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#doc-value原理\"}},[_vm._v(\"#\")]),_vm._v(\" doc value原理\")]),_vm._v(\" \"),_c('ul',[_c('li',[_c('p',[_vm._v(\"index-time生成\")]),_vm._v(\" \"),_c('p',[_vm._v(\"PUT/POST的时候，就会生成doc value数据，也就是正排索引\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"核心原理与倒排索引类似\")]),_vm._v(\" \"),_c('p',[_vm._v(\"正排索引也会写入磁盘文件中，os cache 先进行缓存以提升访问 doc value 正排索引的性能\\n如果 os cache 内存大小不足够放得下整个正排索引，就会将 doc value 的数据写入磁盘文件中\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"性能问题：给 jvm 更少内存，64g 服务器给 jvm 最多 16g\")]),_vm._v(\" \"),_c('p',[_vm._v(\"es 官方是建议 es 大量是基于 os cache 来进行缓存和提升性能的，不建议用 jvm 内存来进行缓存，\\n那样会导致一定的 gc 开销和 oom 问题，所以给 jvm 更少的内存，给 os cache 更大的内存\\n以 64g 服务器为例，给 jvm 最多 16g，其他的内存给 os cache\\nos cache 可以提升 doc value 和倒排索引的缓存和查询效率\")])])]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"column-压缩\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#column-压缩\"}},[_vm._v(\"#\")]),_vm._v(\" column 压缩\")]),_vm._v(\" \"),_c('p',[_vm._v(\"比如以下数据\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"doc1: 550\\ndoc2: 550\\ndoc3: 500\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br')])]),_c('p',[_vm._v(\"合并相同值 550，doc1 和 doc2 都保留一个 550 的标识即可\")]),_vm._v(\" \"),_c('ul',[_c('li',[_c('p',[_vm._v(\"所有值相同，直接保留单值\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"少于 256 个值，使用 table encoding 模式（一种压缩方式）\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"大于 256 个值，看有没有最大公约数，有就除以最大公约数，然后保留这个最大公约数\")]),_vm._v(\" \"),_c('p',[_vm._v(\"doc1: 36\\ndoc2: 24\\n6 --> doc1: 6, doc2: 4 --> 保留一个最大公约数 6 的标识，6 也保存起来\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"如果没有最大公约数，采取 offset 结合压缩的方式：\")])])]),_vm._v(\" \"),_c('p',[_vm._v(\"以上内容，只要明白 doc value 的一个压缩存储，使用层层压缩的方式进行存储的，其他的都太底层了，讲不清\")]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"disable-doc-value\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#disable-doc-value\"}},[_vm._v(\"#\")]),_vm._v(\" disable doc value\")]),_vm._v(\" \"),_c('p',[_vm._v(\"如果的确不需要 doc value，比如不需要聚合等操作，那么可以禁用，减少磁盘空间占用\")]),_vm._v(\" \"),_c('div',{staticClass:\"language-json line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-json\"}},[_c('code',[_vm._v(\"PUT my_index\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n  \"),_c('span',{pre:true,attrs:{\"class\":\"token property\"}},[_vm._v(\"\\\"mappings\\\"\")]),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\":\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n    \"),_c('span',{pre:true,attrs:{\"class\":\"token property\"}},[_vm._v(\"\\\"my_type\\\"\")]),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\":\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n      \"),_c('span',{pre:true,attrs:{\"class\":\"token property\"}},[_vm._v(\"\\\"properties\\\"\")]),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\":\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n        \"),_c('span',{pre:true,attrs:{\"class\":\"token property\"}},[_vm._v(\"\\\"my_field\\\"\")]),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\":\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n          \"),_c('span',{pre:true,attrs:{\"class\":\"token property\"}},[_vm._v(\"\\\"type\\\"\")]),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\":\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token string\"}},[_vm._v(\"\\\"keyword\\\"\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\",\")]),_vm._v(\"\\n          \"),_c('span',{pre:true,attrs:{\"class\":\"token property\"}},[_vm._v(\"\\\"doc_values\\\"\")]),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\":\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token boolean\"}},[_vm._v(\"false\")]),_vm._v(\"\\n        \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n      \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n    \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n  \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"8\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"9\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"10\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"11\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"12\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"13\")]),_c('br')])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}