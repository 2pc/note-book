{"version":3,"sources":["webpack:///./docs/elasticsearch-senior/aggs/55-fielddata.md","webpack:///./docs/elasticsearch-senior/aggs/55-fielddata.md?715a","webpack:///./docs/elasticsearch-senior/aggs/55-fielddata.md?ceac"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAA0F;AAC1F;;;AAGA;AAC6F;AAC7F,gBAAgB,2GAAU;AAC1B;AACA,EAAE,sFAAM;AACR,EAAE,+FAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEe,gF;;;;;;;;;;;;ACjBf;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA,0BAA0B,aAAa,0BAA0B,wBAAwB,qCAAqC,OAAO,gCAAgC,WAAW,OAAO,6CAA6C,UAAU,mCAAmC,gDAAgD,gGAAgG,gCAAgC,4BAA4B,OAAO,0BAA0B,gDAAgD,OAAO,0BAA0B,gDAAgD,OAAO,6BAA6B,mDAAmD,OAAO,2BAA2B,iEAAiE,OAAO,uBAAuB,UAAU,mCAAmC,0BAA0B,oRAAoR,OAAO,uBAAuB,UAAU,mCAAmC,0BAA0B,ieAAie,+BAA+B,UAAU,iCAAiC,yGAAyG,OAAO,0BAA0B,UAAU,mCAAmC,6BAA6B,qEAAqE,8CAA8C,YAAY,gBAAgB,yBAAyB,wBAAwB,gBAAgB,yBAAyB,qFAAqF,gBAAgB,yBAAyB,yGAAyG,gBAAgB,yBAAyB,wIAAwI,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B,sCAAsC,OAAO,wBAAwB,UAAU,mCAAmC,2BAA2B,mPAAmP,0CAA0C,YAAY,gBAAgB,yBAAyB,yMAAyM,mCAAmC,aAAa,0BAA0B,oCAAoC,0BAA0B,oCAAoC,0BAA0B;AACjgI","file":"assets/js/438.954e8e5f.js","sourcesContent":["import { render, staticRenderFns } from \"./55-fielddata.md?vue&type=template&id=476b2d24&\"\nvar script = {}\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/@vuepress/core/node_modules/.cache/vuepress\\\",\\\"cacheIdentifier\\\":\\\"2e9acca5-vue-loader-template\\\"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??ref--1-1!../../../node_modules/@vuepress/markdown-loader/index.js??ref--1-2!./55-fielddata.md?vue&type=template&id=476b2d24&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{\"slot-key\":_vm.$parent.slotKey}},[_c('h1',{attrs:{\"id\":\"fielddata-内存控制以及-circuit-breaker-短路器\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#fielddata-内存控制以及-circuit-breaker-短路器\"}},[_vm._v(\"#\")]),_vm._v(\" fielddata 内存控制以及 circuit breaker 短路器\")]),_vm._v(\" \"),_c('p'),_c('div',{staticClass:\"table-of-contents\"},[_c('ul',[_c('li',[_c('a',{attrs:{\"href\":\"#fielddata-核心原理\"}},[_vm._v(\"fielddata 核心原理\")])]),_c('li',[_c('a',{attrs:{\"href\":\"#fielddata-内存限制\"}},[_vm._v(\"fielddata 内存限制\")])]),_c('li',[_c('a',{attrs:{\"href\":\"#监控-fielddata-内存使用\"}},[_vm._v(\"监控 fielddata 内存使用\")])]),_c('li',[_c('a',{attrs:{\"href\":\"#circuit-breaker\"}},[_vm._v(\"circuit breaker\")])])])]),_c('p'),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"fielddata-核心原理\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#fielddata-核心原理\"}},[_vm._v(\"#\")]),_vm._v(\" fielddata 核心原理\")]),_vm._v(\" \"),_c('p',[_vm._v(\"fielddata 加载到内存的过程是 lazy 加载的，对一个 analzyed field 执行聚合时，\\n才会加载，而且是 field-level（字段级别而不是该 doc 的所有字段） 加载的，\\n一个 index 的一个 field，所有 doc 都会被加载而不是少数 doc，\\n不是 index-time 创建，是 query-time 创建\")]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"fielddata-内存限制\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#fielddata-内存限制\"}},[_vm._v(\"#\")]),_vm._v(\" fielddata 内存限制\")]),_vm._v(\" \"),_c('p',[_vm._v(\"有一个配置字段可以配置 \"),_c('code',[_vm._v(\"indices.fielddata.cache.size\")]),_vm._v(\": 20%，\")]),_vm._v(\" \"),_c('p',[_vm._v(\"作用是占用的内存超出了这个比例的限制，清除内存已有 fielddata 数据，\\n默认无限制。\")]),_vm._v(\" \"),_c('p',[_vm._v(\"虽然可以限制内存使用，但是会导致频繁 evict 和 reload，大量 IO 性能损耗，以及内存碎片和 gc\")]),_vm._v(\" \"),_c('p',[_vm._v(\"配置方式：在配置文件 \"),_c('code',[_vm._v(\"elasticsearch-5.2.0/config/elasticsearch.yml\")]),_vm._v(\" 新增该配置参数即可\")]),_vm._v(\" \"),_c('div',{staticClass:\"custom-block tip\"},[_c('p',{staticClass:\"custom-block-title\"},[_vm._v(\"TIP\")]),_vm._v(\" \"),_c('p',[_vm._v(\"该配置文件中默认是没有改参数配置的，所以搜不到该配置的关键信息\")])]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"监控-fielddata-内存使用\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#监控-fielddata-内存使用\"}},[_vm._v(\"#\")]),_vm._v(\" 监控 fielddata 内存使用\")]),_vm._v(\" \"),_c('div',{staticClass:\"language-json line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-json\"}},[_c('code',[_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 所有分片的统计信息\")]),_vm._v(\"\\nGET /_stats/fielddata?fields=*\\n\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 获取每个 node 的占用信息\")]),_vm._v(\"\\nGET /_nodes/stats/indices/fielddata?fields=*\\n\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 获取每个 node 的每个索引占用信息\")]),_vm._v(\"\\nGET /_nodes/stats/indices/fielddata?level=indices&fields=*\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"8\")]),_c('br')])]),_c('h2',{attrs:{\"id\":\"circuit-breaker\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#circuit-breaker\"}},[_vm._v(\"#\")]),_vm._v(\" circuit breaker\")]),_vm._v(\" \"),_c('p',[_vm._v(\"如果一次 query load 的 feilddata 超过总内存，就会 oom 内存溢出\")]),_vm._v(\" \"),_c('p',[_vm._v(\"circuit breaker 会估算 query 要加载的 fielddata 大小，如果超出总内存就短路，query 直接失败\")]),_vm._v(\" \"),_c('div',{staticClass:\"language- line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-text\"}},[_c('code',[_vm._v(\"indices.breaker.fielddata.limit：fielddata 的内存限制，默认 60%\\nindices.breaker.request.limit：执行聚合的内存限制，默认 40%\\nindices.breaker.total.limit：综合上面两个，限制在 70% 以内\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br')])]),_c('p',[_vm._v(\"这些属性也是在 elasticsearch.yml 中配置的\")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}