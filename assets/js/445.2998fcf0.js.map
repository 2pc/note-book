{"version":3,"sources":["webpack:///./docs/elasticsearch-senior/depth-search/10-shard-relevance-score.md","webpack:///./docs/elasticsearch-senior/depth-search/10-shard-relevance-score.md?7b94","webpack:///./docs/elasticsearch-senior/depth-search/10-shard-relevance-score.md?33f9"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAsG;AACtG;;;AAGA;AAC6F;AAC7F,gBAAgB,2GAAU;AAC1B;AACA,EAAE,kGAAM;AACR,EAAE,2GAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEe,gF;;;;;;;;;;;;ACjBf;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA,0BAA0B,aAAa,0BAA0B,wBAAwB,qCAAqC,OAAO,gCAAgC,WAAW,OAAO,0BAA0B,UAAU,mCAAmC,6BAA6B,oEAAoE,OAAO,gBAAgB,UAAU,mCAAmC,mBAAmB,8PAA8P,OAAO,yDAAyD,4hBAA4hB,OAAO,aAAa,UAAU,mCAAmC,gBAAgB;AACj2C","file":"assets/js/445.2998fcf0.js","sourcesContent":["import { render, staticRenderFns } from \"./10-shard-relevance-score.md?vue&type=template&id=20d5e77e&\"\nvar script = {}\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/@vuepress/core/node_modules/.cache/vuepress\\\",\\\"cacheIdentifier\\\":\\\"2e9acca5-vue-loader-template\\\"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??ref--1-1!../../../node_modules/@vuepress/markdown-loader/index.js??ref--1-2!./10-shard-relevance-score.md?vue&type=template&id=20d5e77e&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{\"slot-key\":_vm.$parent.slotKey}},[_c('h1',{attrs:{\"id\":\"多-shard-下评分不准确大揭秘\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#多-shard-下评分不准确大揭秘\"}},[_vm._v(\"#\")]),_vm._v(\" 多 shard 下评分不准确大揭秘\")]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"得分不准的产生\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#得分不准的产生\"}},[_vm._v(\"#\")]),_vm._v(\" 得分不准的产生\")]),_vm._v(\" \"),_c('p',[_vm._v(\"1 个 index 有多个 shard（副本）的情况下，有时会导致 relevance score 不准确的情况；\")]),_vm._v(\" \"),_c('p',[_vm._v(\"那么这个情况是怎么产生的呢？es 官网自己说该得分计算是有一点问题的（不知道哪里写的），\")]),_vm._v(\" \"),_c('p',[_vm._v(\"在 \"),_c('RouterLink',{attrs:{\"to\":\"/elasticsearch-core/search-engine/55-tf-idf.html\"}},[_vm._v(\"相关度评分 TF&IDF 算法独家解密\")]),_vm._v(\"\\n中有讲到过得分的计算规则。\")],1),_vm._v(\" \"),_c('p',[_vm._v(\"比如在 title 中查询 java\")]),_vm._v(\" \"),_c('ol',[_c('li',[_vm._v(\"在一个 document 中 java 出现了几次\")]),_vm._v(\" \"),_c('li',[_vm._v(\"在所有的 document 中 java 出现了几次\")]),_vm._v(\" \"),_c('li',[_vm._v(\"这个 document 的长度\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"这里只有第二条会涉及到多 shard 的情况，在计算得分的时候默认只是在本地计算，而不是全局计算；\")]),_vm._v(\" \"),_c('p',[_vm._v(\"比如 10 条数据，分散在 3 个 shard 中，在第一个中有 5 条数据参与计算，在第二个中只有 1 条数据参与计算，\\n那么这个时候第二个中的那一条数据得分就会很高。这个时候就可能会出现原本得分很高的会被排在后面去\")]),_vm._v(\" \"),_c('h2',{attrs:{\"id\":\"怎么解决\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#怎么解决\"}},[_vm._v(\"#\")]),_vm._v(\" 怎么解决？\")]),_vm._v(\" \"),_c('blockquote',[_c('p',[_vm._v(\"生产环境下，数据量大，尽可能实现均匀分配\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"数据量很大的话，其实一般情况下，在概率学的背景下，es 都是在多个 shard 中均匀路由数据的，\\n路由的时候根据 \"),_c('code',[_vm._v(\"_id\")]),_vm._v(\"，负载均衡\")]),_vm._v(\" \"),_c('p',[_vm._v(\"比如说有 10 个 document，title 都包含 java，一共有 5 个 shard，那么在概率学的背景下，\\n如果负载均衡的话，其实每个 shard 都应该有 2 个 doc，title 包含 java，如果说数据分布均匀的话，\\n其实就没有刚才说的那个问题了\")]),_vm._v(\" \"),_c('blockquote',[_c('p',[_vm._v(\"测试环境下，将索引的 primary shard 设置为 1 个，number_of_shards=1，index settings\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"如果说只有一个 shard，那么当然，所有的 document 都在这个 shard 里面，就没有这个问题了\")]),_vm._v(\" \"),_c('blockquote',[_c('p',[_vm._v(\"测试环境下，搜索附带 search_type=dfs_query_then_fetch 参数，会将 local IDF 取出来计算 global IDF\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"计算一个 doc 的相关度分数的时候，就会将所有 shard 的 local IDF 计算一下，获取出来，\\n在本地进行 global IDF 分数的计算，会将所有 shard 的 doc 作为上下文来进行计算，也能确保准确性。\\n但是 production 生产环境下，不推荐这个参数，因为性能很差。\")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}