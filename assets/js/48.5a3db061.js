(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[48],{

/***/ "./docs/back-end-storage/01/06.md":
/*!****************************************!*\
  !*** ./docs/back-end-storage/01/06.md ***!
  \****************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _06_md_vue_type_template_id_958471f2___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./06.md?vue&type=template&id=958471f2& */ "./docs/back-end-storage/01/06.md?vue&type=template&id=958471f2&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _06_md_vue_type_template_id_958471f2___WEBPACK_IMPORTED_MODULE_0__["render"],
  _06_md_vue_type_template_id_958471f2___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/back-end-storage/01/06.md?vue&type=template&id=958471f2&":
/*!***********************************************************************!*\
  !*** ./docs/back-end-storage/01/06.md?vue&type=template&id=958471f2& ***!
  \***********************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_06_md_vue_type_template_id_958471f2___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib??ref--1-1!../../../node_modules/@vuepress/markdown-loader??ref--1-2!./06.md?vue&type=template&id=958471f2& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/back-end-storage/01/06.md?vue&type=template&id=958471f2&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_06_md_vue_type_template_id_958471f2___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_06_md_vue_type_template_id_958471f2___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./docs/back-end-storage/01/assets/28a9b198c9b10a3b4d50a77d8fea6c0a.jpg":
/*!******************************************************************************!*\
  !*** ./docs/back-end-storage/01/assets/28a9b198c9b10a3b4d50a77d8fea6c0a.jpg ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/28a9b198c9b10a3b4d50a77d8fea6c0a.28a9b198.jpg";

/***/ }),

/***/ "./docs/back-end-storage/01/assets/6fcdd7e10c3e72b2abe635c8a5a6ff1c.jpg":
/*!******************************************************************************!*\
  !*** ./docs/back-end-storage/01/assets/6fcdd7e10c3e72b2abe635c8a5a6ff1c.jpg ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/6fcdd7e10c3e72b2abe635c8a5a6ff1c.6fcdd7e1.jpg";

/***/ }),

/***/ "./docs/back-end-storage/01/assets/7191b2ba0e28d8b7db9871213664a6c2.jpg":
/*!******************************************************************************!*\
  !*** ./docs/back-end-storage/01/assets/7191b2ba0e28d8b7db9871213664a6c2.jpg ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/7191b2ba0e28d8b7db9871213664a6c2.7191b2ba.jpg";

/***/ }),

/***/ "./docs/back-end-storage/01/assets/cdbfcc01166ad3a1fd2a12791d0079df.jpg":
/*!******************************************************************************!*\
  !*** ./docs/back-end-storage/01/assets/cdbfcc01166ad3a1fd2a12791d0079df.jpg ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/cdbfcc01166ad3a1fd2a12791d0079df.cdbfcc01.jpg";

/***/ }),

/***/ "./docs/back-end-storage/01/assets/e6cadb1ad8311de9772e673161f94999.jpg":
/*!******************************************************************************!*\
  !*** ./docs/back-end-storage/01/assets/e6cadb1ad8311de9772e673161f94999.jpg ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/e6cadb1ad8311de9772e673161f94999.e6cadb1a.jpg";

/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/back-end-storage/01/06.md?vue&type=template&id=958471f2&":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/back-end-storage/01/06.md?vue&type=template&id=958471f2& ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"如何用-elasticsearch-构建商品搜索系统"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#如何用-elasticsearch-构建商品搜索系统"}},[_vm._v("#")]),_vm._v(" 如何用 Elasticsearch 构建商品搜索系统？")]),_vm._v(" "),_c('p',[_vm._v("搜索这个特性可以说是无处不在，现在很少有网站或者系统不提供搜索功能了，所以，即使你不是一个专业做搜索的程序员，也难免会遇到一些搜索相关的需求。搜索这个东西，表面上看功能很简单，就是一个搜索框，输入关键字，然后搜出来想要的内容就好了。")]),_vm._v(" "),_c('p',[_vm._v("搜索背后的实现，可以非常简单，简单到什么程度呢？我们就用一个 SQL，LIKE 一下就能实现；也可以很复杂，复杂到什么程度呢？不说百度谷歌这种专业做搜索的公司，其他非专业做搜索的互联网大厂，搜索团队大多是千人规模，这里面不仅有程序员，还有算法工程师、业务专家等等。二者的区别也仅仅是，搜索速度的快慢以及搜出来的内容好坏而已。")]),_vm._v(" "),_c('p',[_vm._v("今天这节课，我们就以电商中的商品搜索作为例子，来讲一下，如何用 ES(Elasticsearch) 来快速、低成本地构建一个体验还不错的搜索系统。")]),_vm._v(" "),_c('h2',{attrs:{"id":"理解倒排索引机制"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#理解倒排索引机制"}},[_vm._v("#")]),_vm._v(" 理解倒排索引机制")]),_vm._v(" "),_c('p',[_vm._v("刚刚我们说了，既然我们的数据大多都是存在数据库里，用 SQL 的 LIKE 也能实现匹配，也能搜出结果，为什么还要专门做一套搜索系统呢？我先来和你分析一下，为什么数据库不适合做搜索。")]),_vm._v(" "),_c('p',[_c('strong',[_vm._v("搜索的核心需求是全文匹配")]),_vm._v("，对于全文匹配，数据库的索引是根本派不上用场的，那只能全表扫描。全表扫描已经非常慢了，这还不算，还需要在每条记录上做全文匹配，也就是一个字一个字的比对，这个速度就更慢了。所以，使用数据来做搜索，性能上完全没法满足要求。")]),_vm._v(" "),_c('p',[_vm._v("那 ES 是怎么来解决搜索问题的呢？我们来举个例子说明一下，假设我们有这样两个商品，一个是烟台红富士苹果，一个是苹果手机 iPhone XS Max。")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/28a9b198c9b10a3b4d50a77d8fea6c0a.jpg */ "./docs/back-end-storage/01/assets/28a9b198c9b10a3b4d50a77d8fea6c0a.jpg"),"alt":"img"}})]),_vm._v(" "),_c('p',[_vm._v("这个表里面的 DOCID 就是唯一标识一条记录的 ID，和数据库里面的主键是类似的。")]),_vm._v(" "),_c('p',[_vm._v("为了能够支持快速地全文搜索，ES 中对于文本采用了一种特殊的索引："),_c('strong',[_vm._v("倒排索引（Inverted Index）")]),_vm._v("。那我们看一下在 ES 中，这两条商品数据倒排索引长什么样？请看下面这个表。")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/6fcdd7e10c3e72b2abe635c8a5a6ff1c.jpg */ "./docs/back-end-storage/01/assets/6fcdd7e10c3e72b2abe635c8a5a6ff1c.jpg"),"alt":"img"}})]),_vm._v(" "),_c('p',[_vm._v("可以看到，这个倒排索引的表，它是以单词作为索引的 Key，然后每个单词的倒排索引的值是一个列表，这个列表的元素就是含有这个单词的商品记录的 DOCID。")]),_vm._v(" "),_c('p',[_vm._v("这个倒排索引怎么构建的呢？当我们往 ES 写入商品记录的时候，ES 会先对需要搜索的字段，也就是商品标题进行"),_c('strong',[_vm._v("分词")]),_vm._v("。分词就是把一段连续的文本按照语义拆分成多个单词。然后 ES 按照单词来给商品记录做索引，就形成了上面那个表一样的倒排索引。")]),_vm._v(" "),_c('p',[_vm._v("当我们搜索关键字 「苹果手机」的时候，ES 会对关键字也进行分词，比如说，「苹果手机」被分为「苹果」和「手机」。然后，ES 会在倒排索引中去搜索我们输入的每个关键字分词，搜索结果应该是：")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/7191b2ba0e28d8b7db9871213664a6c2.jpg */ "./docs/back-end-storage/01/assets/7191b2ba0e28d8b7db9871213664a6c2.jpg"),"alt":"img"}})]),_vm._v(" "),_c('p',[_vm._v("666 和 888 这两条记录都能匹配上搜索的关键词，但是 888 这个商品比 666 这个商品匹配度更高，因为它两个单词都能匹配上，所以按照匹配度把结果做一个排序，最终返回的搜索结果就是：")]),_vm._v(" "),_c('ul',[_c('li',[_c('strong',[_vm._v("苹果")]),_vm._v("Apple iPhone XS Max (A2104) 256GB 金色 移动联通电信 4G"),_c('strong',[_vm._v("手机")]),_vm._v("双卡双待")]),_vm._v(" "),_c('li',[_vm._v("烟台红富士"),_c('strong',[_vm._v("苹果")]),_vm._v("5kg 一级铂金大果 单果 230g 以上 新鲜水果")])]),_vm._v(" "),_c('p',[_vm._v("看起来搜索的效果还是不错的。")]),_vm._v(" "),_c('p',[_vm._v("为什么倒排索引可以做到快速搜索？我和你一起来分析一下上面这个例子的查找性能。")]),_vm._v(" "),_c('p',[_vm._v("这个搜索过程，其实就是对上面的倒排索引做了二次查找，一次找「苹果」，一次找「手机」。"),_c('strong',[_vm._v("注意，整个搜索过程中，我们没有做过任何文本的模糊匹配")]),_vm._v("。ES 的存储引擎存储倒排索引时，肯定不是像我们上面表格中展示那样存成一个二维表，实际上它的物理存储结构和 MySQL 的 InnoDB 的索引是差不多的，都是一颗查找树。")]),_vm._v(" "),_c('p',[_vm._v("对倒排索引做两次查找，也就是对树进行二次查找，它的时间复杂度，类似于 MySQL 中的二次命中索引的查找。显然，这个查找速度，比用 MySQL 全表扫描加上模糊匹配的方式，要快好几个数量级。")]),_vm._v(" "),_c('h2',{attrs:{"id":"如何在-es-中构建商品的索引"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#如何在-es-中构建商品的索引"}},[_vm._v("#")]),_vm._v(" 如何在 ES 中构建商品的索引?")]),_vm._v(" "),_c('p',[_vm._v("理解了倒排索引的原理之后，我们一起用 ES 构建一个商品索引，简单实现一个商品搜索系统。虽然 ES 是为搜索而生的，但本质上，它仍然是一个存储系统。ES 里面的一些概念，基本上都可以在关系数据库中找到对应的名词，为了便于你快速理解这些概念，我把这些概念的对应关系列出来，你可以对照理解。")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/cdbfcc01166ad3a1fd2a12791d0079df.jpg */ "./docs/back-end-storage/01/assets/cdbfcc01166ad3a1fd2a12791d0079df.jpg"),"alt":"img"}})]),_vm._v(" "),_c('p',[_vm._v("在 ES 里面，数据的逻辑结构类似于 MongoDB，每条数据称为一个 "),_c('strong',[_vm._v("DOCUMENT")]),_vm._v("，简称 DOC。DOC 就是一个 JSON 对象，DOC 中的每个 JSON 字段，在 ES 中称为 "),_c('strong',[_vm._v("FIELD")]),_vm._v("，把一组具有相同字段的 DOC 存放在一起，存放它们的逻辑容器叫 "),_c('strong',[_vm._v("INDEX")]),_vm._v("，这些 DOC 的 JSON 结构称为 "),_c('strong',[_vm._v("MAPPING")]),_vm._v("。这里面最不好理解的就是这个 INDEX，它实际上类似于 MySQL 中表的概念，而不是我们通常理解的用于查找数据的索引。")]),_vm._v(" "),_c('p',[_vm._v("ES 是一个用 Java 开发的服务端程序，除了 Java 以外就没有什么外部依赖了，安装部署都非常简单，具体你可以参照它的官方文档先把 ES 安装好。我们这个示例中，使用的 ES 版本是目前的最新版本 7.6。")]),_vm._v(" "),_c('p',[_vm._v("另外，为了能让 ES 支持中文分词，需要给 ES 安装一个中文的分词插件 "),_c('code',[_vm._v("IK Analysis for Elasticsearch")]),_vm._v("，这个插件的作用就是告诉 ES 怎么对中文文本进行分词。")]),_vm._v(" "),_c('p',[_vm._v("你可以直接执行下面的命令自动下载并安装：")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$elasticsearch")]),_vm._v("-plugin "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("install")]),_vm._v(" https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.0/elasticsearch-analysis-ik-7.6.0.zip\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br')])]),_c('p',[_vm._v("安装完成后，需要重启 ES，验证一下是否安装成功：")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" -X POST "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"localhost:9200/_analyze?pretty\"")]),_vm._v(" -H "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'Content-Type: application/json'")]),_vm._v(" -d "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'{ \"analyzer\": \"ik_smart\", \"text\": \"极客时间\" }'")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"tokens\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"token\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"极\"")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"start_offset\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"end_offset\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"type\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"CN_CHAR\"")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"position\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(",\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"token\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"客\"")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"start_offset\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"end_offset\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"type\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"CN_CHAR\"")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"position\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(",\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"token\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"时间\"")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"start_offset\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"end_offset\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"type\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"CN_WORD\"")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"position\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br')])]),_c('p',[_vm._v("可以看到，这个分词器把「极客时间」分成了极」、「客」和「时间」，没认出来「极客」这个词，还是有改进空间的。")]),_vm._v(" "),_c('p',[_vm._v("为了能实现商品搜索，我们需要先把商品信息存放到 ES 中，首先我们先定义存放在 ES 中商品的数据结构，也就是 MAPPING。")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/e6cadb1ad8311de9772e673161f94999.jpg */ "./docs/back-end-storage/01/assets/e6cadb1ad8311de9772e673161f94999.jpg"),"alt":"img"}})]),_vm._v(" "),_c('p',[_vm._v("我们这个 MAPPING 只要两个字段就够了，sku_id 就是商品 ID，title 保存商品的标题，当用户在搜索商品的时候，我们在 ES 中来匹配商品标题，返回符合条件商品的 sku_id 列表。ES 默认提供了标准的 RESTful 接口，不需要客户端，直接使用 HTTP 协议就可以访问，这里我们使用 curl 通过命令行来操作 ES。")]),_vm._v(" "),_c('p',[_vm._v("接下来我们使用上面这个 MAPPING 创建 INDEX，类似于 MySQL 中创建一个表")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" -X PUT "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"localhost:9200/sku\"")]),_vm._v(" -H "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'Content-Type: application/json'")]),_vm._v(" -d "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'{\n        \"mappings\": {\n                \"properties\": {\n                        \"sku_id\": {\n                                \"type\": \"long\"\n                        },\n                        \"title\": {\n                                \"type\": \"text\",\n                                \"analyzer\": \"ik_max_word\",\n                                \"search_analyzer\": \"ik_max_word\"\n                        }\n                }\n        }\n}'")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"acknowledged\"")]),_vm._v(":true,"),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"shards_acknowledged\"")]),_vm._v(":true,"),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"index\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"sku\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br')])]),_c('p',[_vm._v("这里面，使用 PUT 方法创建一个 INDEX，INDEX 的名称是「sku」，直接写在请求的 URL 中。请求的 BODY 是一个 JSON 对象，内容就是我们上面定义的 MAPPING，也就是数据结构。这里面需要注意一下，由于我们要在 title 这个字段上进行全文搜索，所以我们把数据类型定义为 text，并指定使用我们刚刚安装的中文分词插件 IK 作为这个字段的分词器。")]),_vm._v(" "),_c('p',[_vm._v("创建好 INDEX 之后，就可以往 INDEX 中写入商品数据，插入数据需要使用 HTTP POST 方法：")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" -X POST "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"localhost:9200/sku/_doc/\"")]),_vm._v(" -H "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'Content-Type: application/json'")]),_vm._v(" -d "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'{\n        \"sku_id\": 100002860826,\n        \"title\": \"烟台红富士苹果 5kg 一级铂金大果 单果230g以上 新鲜水果\"\n}'")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_index\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"sku\"")]),_vm._v(","),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_type\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_doc\"")]),_vm._v(","),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_id\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"yxQVSHABiy2kuAJG8ilW\"")]),_vm._v(","),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_version\"")]),_vm._v(":1,"),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"result\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"created\"")]),_vm._v(","),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_shards\"")]),_vm._v(":"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"total\"")]),_vm._v(":2,"),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"successful\"")]),_vm._v(":1,"),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"failed\"")]),_vm._v(":0"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(","),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_seq_no\"")]),_vm._v(":0,"),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_primary_term\"")]),_vm._v(":1"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" -X POST "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"localhost:9200/sku/_doc/\"")]),_vm._v(" -H "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'Content-Type: application/json'")]),_vm._v(" -d "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'{\n        \"sku_id\": 100000177760,\n        \"title\": \"苹果 Apple iPhone XS Max (A2104) 256GB 金色 移动联通电信4G手机 双卡双待\"\n}'")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_index\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"sku\"")]),_vm._v(","),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_type\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_doc\"")]),_vm._v(","),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_id\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"zBQWSHABiy2kuAJGgim1\"")]),_vm._v(","),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_version\"")]),_vm._v(":1,"),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"result\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"created\"")]),_vm._v(","),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_shards\"")]),_vm._v(":"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"total\"")]),_vm._v(":2,"),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"successful\"")]),_vm._v(":1,"),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"failed\"")]),_vm._v(":0"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(","),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_seq_no\"")]),_vm._v(":1,"),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_primary_term\"")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br')])]),_c('p',[_vm._v("这里面我们插入了两条商品数据，一个烟台红富士，一个 iPhone 手机。然后就可以直接进行商品搜索了，搜索使用 HTTP GET 方法。")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" -X GET "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'localhost:9200/sku/_search?pretty'")]),_vm._v(" -H "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'Content-Type: application/json'")]),_vm._v(" -d "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'{\n  \"query\" : { \"match\" : { \"title\" : \"苹果手机\" }}\n}'")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"took\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("23")]),_vm._v(",\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"timed_out\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" false,\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_shards\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"total\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v(",\n    "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"successful\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v(",\n    "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"skipped\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v(",\n    "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"failed\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(",\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"hits\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"total\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"value\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"relation\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"eq\"")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(",\n    "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"max_score\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0.8594865")]),_vm._v(",\n    "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"hits\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_index\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"sku\"")]),_vm._v(",\n        "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_type\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_doc\"")]),_vm._v(",\n        "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_id\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"zBQWSHABiy2kuAJGgim1\"")]),_vm._v(",\n        "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_score\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0.8594865")]),_vm._v(",\n        "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_source\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n          "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"sku_id\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("100000177760")]),_vm._v(",\n          "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"title\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"苹果 Apple iPhone XS Max (A2104) 256GB 金色 移动联通电信4G手机 双卡双待\"")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v(",\n      "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_index\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"sku\"")]),_vm._v(",\n        "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_type\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_doc\"")]),_vm._v(",\n        "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_id\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"yxQVSHABiy2kuAJG8ilW\"")]),_vm._v(",\n        "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_score\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0.18577608")]),_vm._v(",\n        "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"_source\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n          "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"sku_id\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("100002860826")]),_vm._v(",\n          "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"title\"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"烟台红富士苹果 5kg 一级铂金大果 单果230g以上 新鲜水果\"")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("31")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("32")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("33")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("34")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("35")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("36")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("37")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("38")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("39")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("40")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("41")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("42")]),_c('br')])]),_c('p',[_vm._v("我们先看一下请求中的 URL，其中的：")]),_vm._v(" "),_c('ul',[_c('li',[_c('p',[_vm._v("「sku」代表要在 sku 这个 INDEX 内进行查找，")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("「_search」是一个关键字，表示要进行搜索，")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("参数 pretty 表示格式化返回的 JSON，这样方便阅读。")])])]),_vm._v(" "),_c('p',[_vm._v("再看一下请求 BODY 的 JSON，query 中的 match 表示要进行全文匹配，匹配的字段就是 title，关键字是「苹果手机」。")]),_vm._v(" "),_c('p',[_vm._v("可以看到，在返回结果中，匹配到了 2 条商品记录，和我们在前面讲解倒排索引时，预期返回的结果是一致的。")]),_vm._v(" "),_c('p',[_vm._v("我们来回顾一下使用 ES 构建商品搜索服务的这个过程：首先安装 ES 并启动服务，然后创建一个 INDEX，定义 MAPPING，写入数据后，执行查询并返回查询结果，其实，这个过程和我们使用数据库时，先建表、插入数据然后查询的过程，就是一样的。所以，你就把 ES 当做一个支持全文搜索的数据库来使用就行了。")]),_vm._v(" "),_c('h2',{attrs:{"id":"小结"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#小结"}},[_vm._v("#")]),_vm._v(" 小结")]),_vm._v(" "),_c('p',[_vm._v("ES 本质上是一个支持全文搜索的分布式内存数据库，特别适合用于构建搜索系统。ES 之所以能有非常好的全文搜索性能，最重要的原因就是采用了倒排索引。倒排索引是一种特别为搜索而设计的索引结构，倒排索引先对需要索引的字段进行分词，然后以分词为索引组成一个查找树，这样就把一个全文匹配的查找转换成了对树的查找，这是倒排索引能够快速进行搜索的根本原因。")]),_vm._v(" "),_c('p',[_vm._v("但是，倒排索引相比于一般数据库采用的 B 树索引，它的写入和更新性能都比较差，因此倒排索引也只是适合全文搜索，不适合更新频繁的交易类数据。")]),_vm._v(" "),_c('p',[_vm._v("笔者：此文介绍了 倒排索引 为什么这么快，简单的介绍了 es 的存储查询相关知识点，非常简单，这里笔记将不跟着去实践了。")]),_vm._v(" "),_c('h2',{attrs:{"id":"思考题"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#思考题"}},[_vm._v("#")]),_vm._v(" 思考题")]),_vm._v(" "),_c('p',[_vm._v("我们在电商的搜索框中搜索商品时，它都有一个搜索提示的功能，比如我输入「苹果」还没有点击搜索按钮的时候，搜索框下面会提示「苹果手机」、「苹果 11」、「苹果电脑」这些建议的搜索关键字，请你课后看一下 ES 的文档，想一下，如何用 ES 快速地实现这个搜索提示功能？")]),_vm._v(" "),_c('p',[_vm._v("可以使用 ES 的 "),_c('RouterLink',{attrs:{"to":"/elasticsearch-senior/es-high/76-completion-suggest.html"}},[_vm._v("基于 completion suggest 实现搜索提示")]),_vm._v("，它使用的是 "),_c('strong',[_vm._v("前缀索引")]),_vm._v(" 的方式来完成的匹配。")],1),_vm._v(" "),_c('p',[_vm._v("下面是一个较完整的答案：")]),_vm._v(" "),_c('p',[_vm._v("因为用户每输入一个字都可能会发请求查询搜索框中的搜索推荐。所以搜索推荐的请求量远高于搜索框中的搜索。es 针对这种情况提供了 "),_c('code',[_vm._v("suggestion api")]),_vm._v("，并提供的专门的数据结构应对搜索推荐，性能高于 match，但它应用起来也有局限性，就是只能做 "),_c('strong',[_vm._v("前缀匹配")]),_vm._v("。再结合 pinyin 分词器可以做到输入拼音字母就提示中文。如果想做非前缀匹配，可以考虑 Ngram。不过 Ngram 有些复杂，需要开发者自定义分析器。比如有个网址"),_c('code',[_vm._v("www.geekbang.com")]),_vm._v("，用户可能记不清具体网址了，只记得网址中有 2 个 e，此时用户输入 ee 两个字母也是可以在搜索框提示出这个网址的。以上是我在工作中针对 "),_c('strong',[_vm._v("前缀搜索推荐")]),_vm._v(" 和 "),_c('strong',[_vm._v("非前缀搜索推荐")]),_vm._v(" 的实现方案。")])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=48.5a3db061.js.map