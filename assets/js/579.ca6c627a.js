(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[579],{

/***/ "./docs/posts/k8s/kubernetes-basics.md":
/*!*********************************************!*\
  !*** ./docs/posts/k8s/kubernetes-basics.md ***!
  \*********************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _kubernetes_basics_md_vue_type_template_id_8cd79270___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./kubernetes-basics.md?vue&type=template&id=8cd79270& */ "./docs/posts/k8s/kubernetes-basics.md?vue&type=template&id=8cd79270&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _kubernetes_basics_md_vue_type_template_id_8cd79270___WEBPACK_IMPORTED_MODULE_0__["render"],
  _kubernetes_basics_md_vue_type_template_id_8cd79270___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/posts/k8s/kubernetes-basics.md?vue&type=template&id=8cd79270&":
/*!****************************************************************************!*\
  !*** ./docs/posts/k8s/kubernetes-basics.md?vue&type=template&id=8cd79270& ***!
  \****************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_kubernetes_basics_md_vue_type_template_id_8cd79270___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib??ref--1-1!../../../node_modules/@vuepress/markdown-loader??ref--1-2!./kubernetes-basics.md?vue&type=template&id=8cd79270& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/posts/k8s/kubernetes-basics.md?vue&type=template&id=8cd79270&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_kubernetes_basics_md_vue_type_template_id_8cd79270___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_kubernetes_basics_md_vue_type_template_id_8cd79270___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/posts/k8s/kubernetes-basics.md?vue&type=template&id=8cd79270&":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/posts/k8s/kubernetes-basics.md?vue&type=template&id=8cd79270& ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"学习-k8s-的基础知识"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#学习-k8s-的基础知识"}},[_vm._v("#")]),_vm._v(" 学习 k8s 的基础知识")]),_vm._v(" "),_c('p',[_vm._v("此笔记详细参考：https://kubernetes.io/zh/docs/tutorials/kubernetes-basics/")]),_vm._v(" "),_c('h2',{attrs:{"id":"部署应用"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#部署应用"}},[_vm._v("#")]),_vm._v(" 部署应用")]),_vm._v(" "),_c('h3',{attrs:{"id":"k8s-部署"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#k8s-部署"}},[_vm._v("#")]),_vm._v(" k8s 部署")]),_vm._v(" "),_c('p',[_vm._v("一旦运行了 Kubernetes 集群，就可以在其上部署容器化应用程序。 为此，您需要创建 Kubernetes "),_c('strong',[_vm._v("Deployment")]),_vm._v(" 配置。Deployment 指挥 Kubernetes 如何创建和更新应用程序的实例。创建 Deployment 后，Kubernetes master 将应用程序实例调度到集群中的各个节点上。")]),_vm._v(" "),_c('h3',{attrs:{"id":"使用-kubectl-创建-deployment"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#使用-kubectl-创建-deployment"}},[_vm._v("#")]),_vm._v(" 使用 kubectl 创建 Deployment")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 查看 client 和 server 版本")]),_vm._v("\nkubectl version\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 查看集群中的节点")]),_vm._v("\n$ kubectl get nodes\nNAME       STATUS   ROLES    AGE   VERSION\nminikube   Ready    master   85s   v1.17.3\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 创建应用")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 需要应用名称 和完整的 image 地址")]),_vm._v("\n$ kubectl create deployment kubernetes-bootcamp --image"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("gcr.io/google-samples/kubernetes-bootcamp:v1\ndeployment.apps/kubernetes-bootcamp created\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 获取你的应用，可以看到有一个应用，运行在一个节点上")]),_vm._v("\n$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("            "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("           114s\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 此时该应用运行在内部的一个 pods：一个私有的、隔离的网络上，默认情况下，他们可以同同一个 k8s 集群中的其他 pods 和 services看到，不能在外网上看到")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 可以通过 kubectl 通过 API 与应用程序进行交互")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 可以新开一个终端，然后启动一个代理")]),_vm._v("\n$ kubectl proxy\nStarting to serve on "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("127.0")]),_vm._v(".0.1:8001\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 现在终端和 k8s 集群之间有了链接，可以通过代理之间访问 API")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 比如可以通过代理访问 version 信息")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" http://localhost:8001/version\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"major\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"1\"")]),_vm._v(",\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"minor\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"17\"")]),_vm._v(",\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"gitVersion\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"v1.17.3\"")]),_vm._v(",\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"gitCommit\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"06ad960bfd03b39c8310aaf92d1e7c12ce618213\"")]),_vm._v(",\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"gitTreeState\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"clean\"")]),_vm._v(",\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"buildDate\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"2020-02-11T18:07:13Z\"")]),_vm._v(",\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"goVersion\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"go1.13.6\"")]),_vm._v(",\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"compiler\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"gc\"")]),_vm._v(",\n  "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"platform\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"linux/amd64\"")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# API 服务器将根据 pod 名称为每个 pod 自动创建一个断点，该端点也可以通过代理访问，首先要获得断点的名称")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 下面把获得的断点名称放到 POD_NAME 的环境变量中")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 注意：通过 kubectl get pods 能看到所有的 pod 的端点名称；后面这个看效果是直接获取到了一个 name")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("export")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("POD_NAME")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("kubectl get pods -o go-template --template "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'{{range .items}}{{.metadata.name}}{{\""),_c('span',{pre:true,attrs:{"class":"token entity","title":"\\n"}},[_vm._v("\\n")]),_vm._v("\"}}{{end}}'")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("echo")]),_vm._v(" Name of the Pod: "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$POD_NAME")]),_vm._v("\nName of the Pod: kubernetes-bootcamp-69fbc6f4cf-ppc9j\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 后续会用到该知识点")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("31")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("32")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("33")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("34")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("35")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("36")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("37")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("38")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("39")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("40")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("41")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("42")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("43")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("44")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("45")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("46")]),_c('br')])]),_c('h2',{attrs:{"id":"了解你的应用"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#了解你的应用"}},[_vm._v("#")]),_vm._v(" 了解你的应用")]),_vm._v(" "),_c('h3',{attrs:{"id":"目标"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#目标"}},[_vm._v("#")]),_vm._v(" 目标")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("了解 Kubernetes Pod。")]),_vm._v(" "),_c('li',[_vm._v("了解 Kubernetes 工作节点。")]),_vm._v(" "),_c('li',[_vm._v("对已部署的应用故障排除。")])]),_vm._v(" "),_c('h3',{attrs:{"id":"查看-pod-和工作节点"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#查看-pod-和工作节点"}},[_vm._v("#")]),_vm._v(" 查看 pod 和工作节点")]),_vm._v(" "),_c('h4',{attrs:{"id":"kubernetes-pods"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#kubernetes-pods"}},[_vm._v("#")]),_vm._v(" Kubernetes Pods")]),_vm._v(" "),_c('p',[_c('strong',[_vm._v("Pod")]),_vm._v(" 托管你的应用实例。Pod 是 Kubernetes 抽象出来的，表示一组一个或多个应用程序容器（如 Docker 或 rkt ），以及这些容器的一些共享资源。这些资源包括:")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("共享存储，当作卷")]),_vm._v(" "),_c('li',[_vm._v("网络，作为唯一的集群 IP 地址")]),_vm._v(" "),_c('li',[_vm._v("有关每个容器如何运行的信息，例如容器映像版本或要使用的特定端口。")])]),_vm._v(" "),_c('h4',{attrs:{"id":"工作节点"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#工作节点"}},[_vm._v("#")]),_vm._v(" 工作节点")]),_vm._v(" "),_c('p',[_vm._v("一个 pod 总是运行在 "),_c('strong',[_vm._v("工作节点")]),_vm._v("。工作节点是 Kubernetes 中的参与计算的机器，可以是虚拟机或物理计算机，具体取决于集群。每个工作节点由主节点管理。工作节点可以有多个 pod ，Kubernetes 主节点会自动处理在群集中的工作节点上调度 pod 。 主节点的自动调度考量了每个工作节点上的可用资源。")]),_vm._v(" "),_c('p',[_vm._v("每个 Kubernetes 工作节点至少运行:")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("Kubelet，负责 Kubernetes 主节点和工作节点之间通信的过程; 它管理 Pod 和机器上运行的容器。")]),_vm._v(" "),_c('li',[_vm._v("容器运行时（如 Docker ，rkt ）负责从仓库中提取容器镜像，解压缩容器以及运行应用程序。")])]),_vm._v(" "),_c('p',[_c('em',[_vm._v("如果它们紧耦合并且需要共享磁盘等资源，这些容器应在一个 Pod 中编排。")])]),_vm._v(" "),_c('h3',{attrs:{"id":"使用-kubectl-进行故障排除"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#使用-kubectl-进行故障排除"}},[_vm._v("#")]),_vm._v(" 使用 kubectl 进行故障排除")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("kubectl get - 列出资源")]),_vm._v(" "),_c('li',[_vm._v("kubectl describe - 显示有关资源的详细信息")]),_vm._v(" "),_c('li',[_vm._v("kubectl logs - 打印 pod 和其中容器的日志")]),_vm._v(" "),_c('li',[_vm._v("kubectl exec - 在 pod 中的容器上执行命令")])]),_vm._v(" "),_c('h4',{attrs:{"id":"检查应用程序配置"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#检查应用程序配置"}},[_vm._v("#")]),_vm._v(" 检查应用程序配置")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 检查现有的 pod")]),_vm._v("\n$ kubectl get pods\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-nw2d8   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          35s\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 可以查看该 pod 内的 容器和镜像 等信息")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 可以看到返回的信息数据很多")]),_vm._v("\n$ kubectl describe pods\nName:         kubernetes-bootcamp-765bf4c7b4-nw2d8\nNamespace:    default\nPriority:     "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("\nNode:         minikube/172.17.0.13\nStart Time:   Wed, 08 Apr "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2020")]),_vm._v(" 03:16:46 +0000\nLabels:       pod-template-hash"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("765bf4c7b4\n              "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\nAnnotations:  "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\nStatus:       Running\nIP:           "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.18")]),_vm._v(".0.6\nIPs:\n  IP:           "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.18")]),_vm._v(".0.6\nControlled By:  ReplicaSet/kubernetes-bootcamp-765bf4c7b4\nContainers:\n  kubernetes-bootcamp:\n    Container ID:   docker://3854a4a1e21d6c8e192e8121d9c07b7e03fe8fb90e3f3dfaa66b4185ba395735\n    Image:          gcr.io/google-samples/kubernetes-bootcamp:v1\n    Image ID:       docker-pullable://jocatalin/kubernetes-bootcamp@sha256:0d6b8ee63bb57c5f5b6156f446b3bc3b3c143d233037f3a2f00e279c8fcc64af\n    Port:           "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("8080")]),_vm._v("/TCP\n    Host Port:      "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("/TCP\n    State:          Running\n      Started:      Wed, 08 Apr "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2020")]),_vm._v(" 03:16:52 +0000\n    Ready:          True\n    Restart Count:  "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("\n    Environment:    "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-h8pmg "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("ro"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\nConditions:\n  Type              Status\n  Initialized       True\n  Ready             True\n  ContainersReady   True\n  PodScheduled      True\nVolumes:\n  default-token-h8pmg:\n    Type:        Secret "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("a volume populated by a Secret"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n    SecretName:  default-token-h8pmg\n    Optional:    "),_c('span',{pre:true,attrs:{"class":"token boolean"}},[_vm._v("false")]),_vm._v("\nQoS Class:       BestEffort\nNode-Selectors:  "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\nTolerations:     node.kubernetes.io/not-ready:NoExecute "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("for")]),_vm._v(" 300s\n                 node.kubernetes.io/unreachable:NoExecute "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("for")]),_vm._v(" 300s\nEvents:\n  Type     Reason            Age                  From               Message\n  ----     ------            ----                 ----               -------\n  Warning  FailedScheduling  105s "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("x3 over 110s"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("  default-scheduler  "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("/1 nodes are available: "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v(" node"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("s"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" had taints that the pod didnt tolerate.\n  Normal   Scheduled         102s                 default-scheduler  Successfully assigned default/kubernetes-bootcamp-765bf4c7b4-nw2d8 to minikube\n  Normal   Pulled            97s                  kubelet, minikube  Container image "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"gcr.io/google-samples/kubernetes-bootcamp:v1\"")]),_vm._v(" already present on machine\n  Normal   Created           97s                  kubelet, minikube  Created container kubernetes-bootcamp\n  Normal   Started           96s                  kubelet, minikube  Started container kubernetes-bootcamp\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 该命令输出的信息是人类可读的，并非是脚本化的原始文件  ")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("31")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("32")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("33")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("34")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("35")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("36")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("37")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("38")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("39")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("40")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("41")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("42")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("43")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("44")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("45")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("46")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("47")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("48")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("49")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("50")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("51")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("52")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("53")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("54")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("55")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("56")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("57")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("58")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("59")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("60")]),_c('br')])]),_c('h4',{attrs:{"id":"在终端中显示应用"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#在终端中显示应用"}},[_vm._v("#")]),_vm._v(" 在终端中显示应用")]),_vm._v(" "),_c('p',[_vm._v("pods 是在私有网络中运行的，因此先创建一个代理")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl proxy\nStarting to serve on "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("127.0")]),_vm._v(".0.1:8001\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 获取 pod 名称，并存储在变量中")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("export")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("POD_NAME")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("kubectl get pods -o go-template --template "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'{{range .items}}{{.metadata.name}}{{\""),_c('span',{pre:true,attrs:{"class":"token entity","title":"\\n"}},[_vm._v("\\n")]),_vm._v("\"}}{{end}}'")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("echo")]),_vm._v(" Name of the Pod: "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$POD_NAME")]),_vm._v("\nName of the Pod: kubernetes-bootcamp-765bf4c7b4-nw2d8\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 通过 API 获取该 POD 的信息")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" http://localhost:8001/api/v1/namespaces/default/pods/"),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$POD_NAME")]),_vm._v("/proxy/\nHello Kubernetes bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" Running on: kubernetes-bootcamp-765bf4c7b4-nw2d8 "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("v")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br')])]),_c('h4',{attrs:{"id":"显示容器日志"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#显示容器日志"}},[_vm._v("#")]),_vm._v(" 显示容器日志")]),_vm._v(" "),_c('p',[_vm._v("应用程序发送到 STDOUT 的任何内容都会成为 pod 中容器的日志。")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 查看该 POD 的容器日志")]),_vm._v("\n$ kubectl logs "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$POD_NAME")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br')])]),_c('h4',{attrs:{"id":"在容器上执行命令"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#在容器上执行命令"}},[_vm._v("#")]),_vm._v(" 在容器上执行命令")]),_vm._v(" "),_c('p',[_vm._v("一旦 Pod 启动并运行，我们就可以直接在容器上执行命令。为此，我们使用 exec 命令并使用 Pod 的名称作为参数。让我们列出环境变量:")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("exec")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$POD_NAME")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("env")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_c('span',{pre:true,attrs:{"class":"token environment constant"}},[_vm._v("PATH")])]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n"),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_c('span',{pre:true,attrs:{"class":"token environment constant"}},[_vm._v("HOSTNAME")])]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp-765bf4c7b4-nw2d8\n"),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("KUBERNETES_PORT_443_TCP_ADDR")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("10.96")]),_vm._v(".0.1\n"),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("KUBERNETES_SERVICE_HOST")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("10.96")]),_vm._v(".0.1\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(".\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br')])]),_c('p',[_vm._v("在 Pod 的容器中启动一个 bash 程序。注意的是：由于当前 pod 只有一个容器，容器名称是可以省略的")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("exec")]),_vm._v(" -ti "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$POD_NAME")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("bash")]),_vm._v("\nroot@kubernetes-bootcamp-765bf4c7b4-nw2d8:/"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("#")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 这就进入了一个 pod 内的容器")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 在该 bash 环境下，可以执行 bash 指令，比如 ls 等")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 看看这个 js 中的内容。里面就是我们部署容器的时候运行的一个 node js 程序，他监听了 8080 端口，并输出一些信息")]),_vm._v("\nroot@kubernetes-bootcamp-765bf4c7b4-nw2d8:/"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# cat server.js")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 由于在容器内部，所以可以直接访问 localhost")]),_vm._v("\nroot@kubernetes-bootcamp-765bf4c7b4-nw2d8:/"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# curl localhost:8080")]),_vm._v("\nHello Kubernetes bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" Running on: kubernetes-bootcamp-765bf4c7b4-nw2d8 "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("v")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 退出与该容器的联机")]),_vm._v("\nroot@kubernetes-bootcamp-765bf4c7b4-nw2d8:/"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# exit")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br')])]),_c('h2',{attrs:{"id":"公开的暴露你的应用"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#公开的暴露你的应用"}},[_vm._v("#")]),_vm._v(" 公开的暴露你的应用")]),_vm._v(" "),_c('h3',{attrs:{"id":"目标-2"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#目标-2"}},[_vm._v("#")]),_vm._v(" 目标")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("了解 Kubernetes 中的服务")]),_vm._v(" "),_c('li',[_vm._v("了解标签和 LabelSelector 对象如何与服务相关")]),_vm._v(" "),_c('li',[_vm._v("使用服务在 Kubernetes 集群外公开应用程序")])]),_vm._v(" "),_c('h3',{attrs:{"id":"服务概述"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#服务概述"}},[_vm._v("#")]),_vm._v(" 服务概述")]),_vm._v(" "),_c('p',[_vm._v("Pod 是有生命周期的，当工作节点死亡，在该节点上运行的 Pod 也会丢失，然后可能会通过 ReplicaSet 来创建新的 Pod 来恢复成原来的状态。")]),_vm._v(" "),_c('p',[_vm._v("集群中的每个 Pod 都有一个唯一的 IP 地址，因此需要一种自动协调 Pod 之间的方法")]),_vm._v(" "),_c('p',[_vm._v("Kubernetes 中的服务是一种抽象，定义了 Pod 的逻辑集合和访问 Pod 的策略，可以通过 YML（首选）或 JSON 定义服务。如果没有服务，尽管每个 Pod 有 一个唯一的地址，但是也不会暴露在集群外部。服务允许你的应用程序接受流量。")]),_vm._v(" "),_c('p',[_vm._v("在 ServiceSpec 中通过 type 可以指定以何种方式公开服务：")]),_vm._v(" "),_c('ul',[_c('li',[_c('em',[_vm._v("ClusterIP")]),_vm._v("（默认）：在群集的内部 IP上公开服务。这种类型使得只能从群集内部访问服务。")]),_vm._v(" "),_c('li',[_c('em',[_vm._v("NodePort")]),_vm._v("：使用 NAT 在群集中每个选定节点的相同端口上公开服务。使用可以从群集外部访问服务"),_c('code',[_vm._v(":")]),_vm._v("。"),_c('code',[_vm._v("<NodeIP>:<NodePort>")]),_vm._v("  ClusterIP 的超集。")]),_vm._v(" "),_c('li',[_c('em',[_vm._v("LoadBalancer")]),_vm._v(" ：在当前云中创建一个外部负载平衡器（如果支持），并为该服务分配一个固定的外部 IP。NodePort 的超集。")]),_vm._v(" "),_c('li',[_c('em',[_vm._v("ExternalName")]),_vm._v("："),_c('code',[_vm._v("externalName")]),_vm._v("通过返回带有该名称的 CNAME 记录，使用任意名称（在规范中指定）公开服务。不使用代理。此类型需要 v1.7 或更高版本 "),_c('code',[_vm._v("kube-dns")]),_vm._v("。")])]),_vm._v(" "),_c('p',[_vm._v("服务在一组 Pod 之间路由流量。服务是允许 Pod 在 Kubernetes 中死亡和复制而又不影响您的应用程序的抽象。")]),_vm._v(" "),_c('p',[_vm._v("简单说：服务类似一个 nginx，可以决定路由到哪些 pod 上去")]),_vm._v(" "),_c('h3',{attrs:{"id":"使用-expose-暴露你的程序"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#使用-expose-暴露你的程序"}},[_vm._v("#")]),_vm._v(" 使用 expose 暴露你的程序")]),_vm._v(" "),_c('h4',{attrs:{"id":"创建新服务-services"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#创建新服务-services"}},[_vm._v("#")]),_vm._v(" 创建新服务 services")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 先找到一个 pod ，确定你的应用还在运行")]),_vm._v("\n$ kubectl get pods\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-bsmcs   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          2m19s\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 列出集群中的服务")]),_vm._v("\n$ kubectl get services\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("S"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("   AGE\nkubernetes   ClusterIP   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("10.96")]),_vm._v(".0.1    "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("        "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("443")]),_vm._v("/TCP   2m57s\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br')])]),_c('p',[_vm._v("上述有一个 kubernetes 的服务，这个是 minikube 启动集群时默认创建的。")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 关于这个 deployment/kubernetes-bootcamp 前面的 deployment 是我们不熟应用时的指令")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 如果这里使用 services/xxx 一样的概念")]),_vm._v("\n$ kubectl expose deployment/kubernetes-bootcamp --type"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"NodePort\"")]),_vm._v(" --port "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("8080")]),_vm._v("\nservice/kubernetes-bootcamp exposed\n\n$ kubectl get services\nNAME                  TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("S"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("          AGE\nkubernetes            ClusterIP   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("10.96")]),_vm._v(".0.1        "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("        "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("443")]),_vm._v("/TCP          9m17s\nkubernetes-bootcamp   NodePort    "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("10.104")]),_vm._v(".184.115   "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("        "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("8080")]),_vm._v(":31880/TCP   57s\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br')])]),_c('p',[_vm._v("xx")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl describe services/kubernetes-bootcamp\nName:                     kubernetes-bootcamp\nNamespace:                default\nLabels:                   "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\nAnnotations:              "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\nSelector:                 "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\nType:                     NodePort\nIP:                       "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("10.104")]),_vm._v(".184.115\nPort:                     "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("unset"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("  "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("8080")]),_vm._v("/TCP\nTargetPort:               "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("8080")]),_vm._v("/TCP\nNodePort:                 "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("unset"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("  "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("31880")]),_vm._v("/TCP\nEndpoints:                "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.18")]),_vm._v(".0.3:8080\nSession Affinity:         None\nExternal Traffic Policy:  Cluster\nEvents:                   "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 这个是暴露的端口，")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("export")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("NODE_PORT")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("kubectl get services/kubernetes-bootcamp -o go-template"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'{{(index .spec.ports 0).nodePort}}'")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("echo")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("NODE_PORT")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("NODE_PORT")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("31880")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 但是这个 ip 结果居然是 172.17.0.49 也就是 kubernetes 暴露的 IP")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("minikube "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ip")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\nHello Kubernetes bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" Running on: kubernetes-bootcamp-765bf4c7b4-bsmcs "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("v")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br')])]),_c('h4',{attrs:{"id":"使用标签-labels"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#使用标签-labels"}},[_vm._v("#")]),_vm._v(" 使用标签 labels")]),_vm._v(" "),_c('p',[_vm._v("deployment 为 pod 自动创建了一个标签")]),_vm._v(" "),_c('div',{staticClass:"language-baSH line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 通过描述来获取标签信息")]),_vm._v("\n$ kubectl describe deployment\nName:                   kubernetes-bootcamp\nNamespace:              default\nCreationTimestamp:      Wed, 08 Apr "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2020")]),_vm._v(" 05:23:49 +0000\nLabels:                 "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br')])]),_c('p',[_vm._v("可以通过这个标签来获取 pod 列表，通过 "),_c('code',[_vm._v("-l")]),_vm._v(" 参数")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl get pods -l "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-bsmcs   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          24m\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br')])]),_c('p',[_vm._v("还可以用标签来获取服务")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl get services -l "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\nNAME                  TYPE       CLUSTER-IP       EXTERNAL-IP   PORT"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("S"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("          AGE\nkubernetes-bootcamp   NodePort   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("10.104")]),_vm._v(".184.115   "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("        "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("8080")]),_vm._v(":31880/TCP   16m\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br')])]),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 获取 pod name")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("export")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("POD_NAME")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("kubectl get pods -o go-template --template "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'{{range .items}}{{.metadata.name}}{{\""),_c('span',{pre:true,attrs:{"class":"token entity","title":"\\n"}},[_vm._v("\\n")]),_vm._v("\"}}{{end}}'")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("echo")]),_vm._v(" Name of the Pod: "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$POD_NAME")]),_vm._v("\nName of the Pod: kubernetes-bootcamp-765bf4c7b4-bsmcs\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])]),_c('p',[_vm._v("给应用添加新标签，使用 label 参数，后面跟 象类型、对象名称和新标签")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl label pod "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$POD_NAME")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("app")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("v1\npod/kubernetes-bootcamp-765bf4c7b4-bsmcs labeled\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br')])]),_c('p',[_vm._v("查看这个 pod 的标签列表")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl describe pods "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$POD_NAME")]),_vm._v("\nName:         kubernetes-bootcamp-765bf4c7b4-bsmcs\nNamespace:    default\nPriority:     "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("\nNode:         minikube/172.17.0.49\nStart Time:   Wed, 08 Apr "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2020")]),_vm._v(" 05:24:06 +0000\nLabels:       "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("app")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("v1\n              pod-template-hash"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("765bf4c7b4\n              "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(".\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 可以看到多了 app=v1")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 那么就可以通过标签来获取 pod 列表了")]),_vm._v("\n$ kubectl get pods -l "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("app")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("v1\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-bsmcs   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          28m\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br')])]),_c('h4',{attrs:{"id":"删除服务"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#删除服务"}},[_vm._v("#")]),_vm._v(" 删除服务")]),_vm._v(" "),_c('p',[_vm._v("可以使用 "),_c('code',[_vm._v("delete service")]),_vm._v(" 命令，标签也可以在这里使用")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl delete "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("service")]),_vm._v(" -l "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\n"),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("service")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"kubernetes-bootcamp\"")]),_vm._v(" deleted\n\n$ kubectl get services\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("S"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("   AGE\nkubernetes   ClusterIP   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("10.96")]),_vm._v(".0.1    "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("        "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("443")]),_vm._v("/TCP   30m\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 会发现服务没有了")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 使用之前的访问地址，发现不能访问了，表示该应用不被暴露在集群之外了")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("minikube "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ip")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\ncurl: "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("7")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" Failed to connect to "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.17")]),_vm._v(".0.49 port "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("31880")]),_vm._v(": Connection refused\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 可以通过命令执行，来确认该应用程序还存活")]),_vm._v("\n$ kubectl "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("exec")]),_vm._v(" -ti "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$POD_NAME")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" localhost:8080\nHello Kubernetes bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" Running on: kubernetes-bootcamp-765bf4c7b4-bsmcs "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("v")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br')])]),_c('p',[_vm._v("这里已经看到应用程序确实还活跃，要关闭应用程序的话，需要删除部署，因为部署正在管理应用程序")]),_vm._v(" "),_c('h2',{attrs:{"id":"伸缩应用"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#伸缩应用"}},[_vm._v("#")]),_vm._v(" 伸缩应用")]),_vm._v(" "),_c('p',[_vm._v("在之前的模块中，我们创建了一个 "),_c('a',{attrs:{"href":"https://kubernetes.io/docs/user-guide/deployments/","target":"_blank","rel":"noopener noreferrer"}},[_vm._v("Deployment"),_c('OutboundLink')],1),_vm._v("，然后通过 "),_c('a',{attrs:{"href":"https://kubernetes.io/docs/user-guide/services/","target":"_blank","rel":"noopener noreferrer"}},[_vm._v("Service"),_c('OutboundLink')],1),_vm._v("让其可以开放访问。Deployment 仅为跑这个应用程序创建了一个 Pod。 当流量增加时，我们需要扩容应用程序满足用户需求。")]),_vm._v(" "),_c('p',[_c('strong',[_vm._v("扩缩")]),_vm._v(" 是通过改变 Deployment 中的副本数量来实现的。")]),_vm._v(" "),_c('h3',{attrs:{"id":"扩展"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#扩展"}},[_vm._v("#")]),_vm._v(" 扩展")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 找到我们的部署")]),_vm._v("\n$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("            "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("           3m31s\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])]),_c('p',[_vm._v("列表字段含义：")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("NAME：集群中 deployment 的名称")]),_vm._v(" "),_c('li',[_vm._v("READY：当前所需副本的比率")]),_vm._v(" "),_c('li',[_vm._v("UP-TO-DATE：已更新到所需状态的数量")]),_vm._v(" "),_c('li',[_vm._v("AVAILABLE：有多少应用程序副本供用户使用")]),_vm._v(" "),_c('li',[_vm._v("AGE：应用程序运行的时间")])]),_vm._v(" "),_c('p',[_vm._v("查看 deployment 运行的副本")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl get rs\nNAME                             DESIRED   CURRENT   READY   AGE\nkubernetes-bootcamp-765bf4c7b4   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("         "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("         "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("       38m\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# DESIRED：部署程序时期望的副本数量")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# CURRENT：当前正在运行的副本数量")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br')])]),_c('p',[_vm._v("注意：副本集的名称总是格式化为 "),_c('code',[_vm._v("[DEPLOYMENT-NAME]-[RANDOM-STRING]")]),_vm._v("，随机字符串是随机生成的，使用 "),_c('code',[_vm._v("pod-template-hash")]),_vm._v(" 作为随机数种子")]),_vm._v(" "),_c('p',[_vm._v("接下来，我们将部署扩展到 4 个副本。使用 "),_c('code',[_vm._v("kubectl scale")]),_vm._v(" 命令")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 部署类型/应用名称 所需要的数量")]),_vm._v("\n$ kubectl scale deployments/kubernetes-bootcamp --replicas"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v("\ndeployment.apps/kubernetes-bootcamp scaled\n\n$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v("/4     "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v("            "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v("           45m\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 查看 pod 的数量")]),_vm._v("\n$ kubectl get pods -o wide\nNAME                                   READY   STATUS    RESTARTS   AGE   IP           NODE       NOMINATED NODE   READINESS GATES\nkubernetes-bootcamp-765bf4c7b4-kvzml   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          45m   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.18")]),_vm._v(".0.2   minikube   "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("           "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\nkubernetes-bootcamp-765bf4c7b4-mc5sl   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          67s   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.18")]),_vm._v(".0.8   minikube   "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("           "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\nkubernetes-bootcamp-765bf4c7b4-rcfbm   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          67s   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.18")]),_vm._v(".0.9   minikube   "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("           "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\nkubernetes-bootcamp-765bf4c7b4-tphzj   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          67s   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.18")]),_vm._v(".0.7   minikube   "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("           "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br')])]),_c('p',[_vm._v("现在有 4 个 pod，有不同的 IP 地址。这个更改已经注册到 Deployment events log 中，可以通过以下命令验证")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl describe deployments/kubernetes-bootcamp\nName:                   kubernetes-bootcamp\nNamespace:              default\nCreationTimestamp:      Wed, 08 Apr "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2020")]),_vm._v(" 06:14:57 +0000\nLabels:                 "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\nAnnotations:            deployment.kubernetes.io/revision: "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\nSelector:               "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\nReplicas:               "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v(" desired "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v(" updated "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v(" total "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v(" available "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v(" unavailable\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(" 看到有 "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v(" 个副本\nEvents:\n  Type    Reason             Age    From                   Message\n  ----    ------             ----   ----                   -------\n  Normal  ScalingReplicaSet  47m    deployment-controller  Scaled up replica "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("set")]),_vm._v(" kubernetes-bootcamp-765bf4c7b4 to "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n  Normal  ScalingReplicaSet  3m15s  deployment-controller  Scaled up replica "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("set")]),_vm._v(" kubernetes-bootcamp-765bf4c7b4 to "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 另外，在 events 中，有一条日志是变成了 4 个  ")]),_vm._v("\n\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br')])]),_c('h3',{attrs:{"id":"负载均衡-load-balancing"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#负载均衡-load-balancing"}},[_vm._v("#")]),_vm._v(" 负载均衡 Load Balancing")]),_vm._v(" "),_c('p',[_vm._v("让我们检查服务是否在负载平衡流量。为了找出暴露的 IP 和端口，我们可以使用前面模块中学习到的 describe 服务:")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl describe services/kubernetes-bootcamp\nName:                     kubernetes-bootcamp\nNamespace:                default\nLabels:                   "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\nAnnotations:              "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\nSelector:                 "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\nType:                     NodePort\nIP:                       "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("10.96")]),_vm._v(".156.129\nPort:                     "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("unset"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("  "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("8080")]),_vm._v("/TCP\nTargetPort:               "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("8080")]),_vm._v("/TCP\nNodePort:                 "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("unset"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("  "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("31244")]),_vm._v("/TCP\nEndpoints:                "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.18")]),_vm._v(".0.2:8080,172.18.0.7:8080,172.18.0.8:8080 + "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v(" more"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(".\nSession Affinity:         None\nExternal Traffic Policy:  Cluster\nEvents:                   "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 拿到这个服务暴露的端口")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("export")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("NODE_PORT")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("kubectl get services/kubernetes-bootcamp -o go-template"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'{{(index .spec.ports 0).nodePort}}'")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("echo")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("NODE_PORT")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("NODE_PORT")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("31244")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 访问这个服务，会发现被自动均衡负载了")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("minikube "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ip")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\nHello Kubernetes bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" Running on: kubernetes-bootcamp-765bf4c7b4-tphzj "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("v")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("minikube "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ip")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\nHello Kubernetes bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" Running on: kubernetes-bootcamp-765bf4c7b4-mc5sl "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("v")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("minikube "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ip")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\nHello Kubernetes bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" Running on: kubernetes-bootcamp-765bf4c7b4-kvzml "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("v")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 这里笔者还是不清楚，这里的 minikube ip 是怎么访问到这个服务的")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br')])]),_c('h3',{attrs:{"id":"缩减"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#缩减"}},[_vm._v("#")]),_vm._v(" 缩减")]),_vm._v(" "),_c('p',[_vm._v("和扩展的时候使用的命令一致")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl scale deployments/kubernetes-bootcamp --replicas"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v("\ndeployment.apps/kubernetes-bootcamp scaled\n\n$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v("/2     "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v("            "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v("           7m56s\n\n$ kubectl get pods -o wide\nNAME                                   READY   STATUS    RESTARTS   AGE     IP           NODE       NOMINATED NODE   READINESS GATES\nkubernetes-bootcamp-765bf4c7b4-f66cb   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          7m25s   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.18")]),_vm._v(".0.8   minikube   "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("           "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\nkubernetes-bootcamp-765bf4c7b4-p27l7   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          7m59s   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.18")]),_vm._v(".0.4   minikube   "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("           "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br')])]),_c('h2',{attrs:{"id":"更新你的应用"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#更新你的应用"}},[_vm._v("#")]),_vm._v(" 更新你的应用")]),_vm._v(" "),_c('p',[_c('strong',[_vm._v("滚动更新")]),_vm._v(" 允许通过使用新的实例逐步更新 Pod 实例，零停机进行 Deployment 更新。新的 Pod 将在具有可用资源的节点上进行调度。")]),_vm._v(" "),_c('p',[_vm._v("滚动更新允许以下操作：")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("将应用程序从一个环境提升到另一个环境（通过容器镜像更新）")]),_vm._v(" "),_c('li',[_vm._v("回滚到以前的版本")]),_vm._v(" "),_c('li',[_vm._v("持续集成和持续交付应用程序，无需停机")])]),_vm._v(" "),_c('h3',{attrs:{"id":"更新应用程序的版本"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#更新应用程序的版本"}},[_vm._v("#")]),_vm._v(" 更新应用程序的版本")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("/4     "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("4")]),_vm._v("            "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("           9s\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 列出正在运行的 pod")]),_vm._v("\n$ kubectl get pods\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-5dnsj   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          21s\nkubernetes-bootcamp-765bf4c7b4-fhpjw   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          21s\nkubernetes-bootcamp-765bf4c7b4-l2xck   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          21s\nkubernetes-bootcamp-765bf4c7b4-t7f7v   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          21s\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 查看当前 pod 的image 版本")]),_vm._v("\n$ kubectl describe pods\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(".\nContainers:\n  kubernetes-bootcamp:\n    Container ID:   docker://27adad6a06a62863b135e6aa1563cb214fa8c5503c746a17c37805566ed31aa2\n    Image:          gcr.io/google-samples/kubernetes-bootcamp:v1   "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 主要看这个镜像版本")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(".\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br')])]),_c('p',[_vm._v("开始滚动更新")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("set")]),_vm._v(" image deployments/kubernetes-bootcamp kubernetes-bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("jocatalin/kubernetes-bootcamp:v2\ndeployment.apps/kubernetes-bootcamp image updated\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 查看 pod 状态")]),_vm._v("\n$ kubectl get pods\nNAME                                   READY   STATUS        RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-5dnsj   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("/1     Terminating   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          4m5s\nkubernetes-bootcamp-765bf4c7b4-fhpjw   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("/1     Terminating   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          4m5s\nkubernetes-bootcamp-765bf4c7b4-l2xck   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("/1     Terminating   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          4m5s\nkubernetes-bootcamp-765bf4c7b4-t7f7v   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("/1     Terminating   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          4m5s\nkubernetes-bootcamp-7d6f8694b6-9t5pd   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running       "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          38s\nkubernetes-bootcamp-7d6f8694b6-cgljl   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running       "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          38s\nkubernetes-bootcamp-7d6f8694b6-h2gtl   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running       "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          40s\nkubernetes-bootcamp-7d6f8694b6-k7hkm   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running       "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          40s\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 可以看到有终止状态，等一会，就变成新的 pod 了")]),_vm._v("\n$ kubectl get pods\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-7d6f8694b6-9t5pd   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          41s\nkubernetes-bootcamp-7d6f8694b6-cgljl   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          41s\nkubernetes-bootcamp-7d6f8694b6-h2gtl   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          43s\nkubernetes-bootcamp-7d6f8694b6-k7hkm   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          43s\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br')])]),_c('h3',{attrs:{"id":"验证一个更新"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#验证一个更新"}},[_vm._v("#")]),_vm._v(" 验证一个更新")]),_vm._v(" "),_c('p',[_vm._v("首先，让我们检查应用程序是否正在运行。为了找出暴露的 IP 和端口，我们可以使用描述服务:")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl describe services/kubernetes-bootcamp\nName:                     kubernetes-bootcamp\nNamespace:                default\nLabels:                   "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\nAnnotations:              "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\nSelector:                 "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("run")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("kubernetes-bootcamp\nType:                     NodePort\nIP:                       "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("10.109")]),_vm._v(".203.10\nPort:                     "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("unset"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("  "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("8080")]),_vm._v("/TCP\nTargetPort:               "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("8080")]),_vm._v("/TCP\nNodePort:                 "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("unset"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("  "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("30410")]),_vm._v("/TCP\nEndpoints:                "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("172.18")]),_vm._v(".0.10:8080,172.18.0.11:8080,172.18.0.12:8080 + "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v(" more"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(".\nSession Affinity:         None\nExternal Traffic Policy:  Cluster\nEvents:                   "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("<")]),_vm._v("none"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(">")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 拿到暴露的端口")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("export")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("NODE_PORT")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("kubectl get services/kubernetes-bootcamp -o go-template"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'{{(index .spec.ports 0).nodePort}}'")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("echo")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("NODE_PORT")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("NODE_PORT")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("30410")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 验证是否更新")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("minikube "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ip")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\nHello Kubernetes bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" Running on: kubernetes-bootcamp-7d6f8694b6-9t5pd "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("v")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("minikube "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ip")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\nHello Kubernetes bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" Running on: kubernetes-bootcamp-7d6f8694b6-9t5pd "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("v")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("minikube "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ip")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\nHello Kubernetes bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" Running on: kubernetes-bootcamp-7d6f8694b6-h2gtl "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("v")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v("\n$ "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("curl")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token variable"}},[_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$(")]),_vm._v("minikube "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("ip")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v(")")])]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_c('span',{pre:true,attrs:{"class":"token variable"}},[_vm._v("$NODE_PORT")]),_vm._v("\nHello Kubernetes bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" Running on: kubernetes-bootcamp-7d6f8694b6-k7hkm "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("|")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token assign-left variable"}},[_vm._v("v")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br')])]),_c('p',[_vm._v("更新也可以通过运行 rollout 状态命令来确认:")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_vm._v("$ kubectl rollout status deployments/kubernetes-bootcamp\ndeployment "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"kubernetes-bootcamp\"")]),_vm._v(" successfully rolled out\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 查看当前的镜像版本。使用 describe 命令")]),_vm._v("\n$ kubectl describe pods\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br')])]),_c('h3',{attrs:{"id":"回滚更新"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#回滚更新"}},[_vm._v("#")]),_vm._v(" 回滚更新")]),_vm._v(" "),_c('div',{staticClass:"language-bash line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-bash"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 先升级部署使用 v10 的镜像")]),_vm._v("\n$ kubectl "),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v("set")]),_vm._v(" image deployments/kubernetes-bootcamp kubernetes-bootcamp"),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v("gcr.io/google-samples/kubernetes-bootcamp:v10\ndeployment.apps/kubernetes-bootcamp image updated\n\n$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("3")]),_vm._v("/4     "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("2")]),_vm._v("            "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("3")]),_vm._v("           11m\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 但是没有达到我们预期的 pod 数量")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 查看当前的 pods")]),_vm._v("\n$ kubectl get pods\nNAME                                   READY   STATUS             RESTARTS   AGE\nkubernetes-bootcamp-7d6f8694b6-9t5pd   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running            "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          8m41s\nkubernetes-bootcamp-7d6f8694b6-h2gtl   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running            "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          8m43s\nkubernetes-bootcamp-7d6f8694b6-k7hkm   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running            "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          8m43s\nkubernetes-bootcamp-886577c5d-5kdnv    "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("/1     ImagePullBackOff   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          93s\nkubernetes-bootcamp-886577c5d-qpb4g    "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("/1     ImagePullBackOff   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          93s\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 在描述命令上，能看到更多的 pod 信息")]),_vm._v("\n$ kubectl describe pods\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("..")]),_vm._v(". \nWarning  Failed     73s "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("x4 over 2m43s"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("  kubelet, minikube  Failed to pull image "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"gcr.io/google-samples/kubernetes-bootcamp:v10\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(":")]),_vm._v(" rpc error: code "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" Unknown desc "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" Error response from daemon: manifest "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("for")]),_vm._v(" gcr.io/google-samples/kubernetes-bootcamp:v10 not found: manifest unknown: Failed to fetch "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"v10\"")]),_vm._v(" from request "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"/v2/google-samples/kubernetes-bootcamp/manifests/v10\"")]),_c('span',{pre:true,attrs:{"class":"token builtin class-name"}},[_vm._v(".")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 通观察，可以发现根本就没有 v10 这个镜像。 上述的 pods 表示有 3 个可用，有 2 个更新失败了")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 这意味着，在滚动更新过程中，新的版本启动失败了，老的丢掉了一个")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 这个时候使用回滚更新")]),_vm._v("\n$ kubectl rollout undo deployments/kubernetes-bootcamp\ndeployment.apps/kubernetes-bootcamp rolled back\n\n$ kubectl get pods\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-7d6f8694b6-9b9jb   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          17s\nkubernetes-bootcamp-7d6f8694b6-9t5pd   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          13m\nkubernetes-bootcamp-7d6f8694b6-h2gtl   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          13m\nkubernetes-bootcamp-7d6f8694b6-k7hkm   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("/1     Running   "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("0")]),_vm._v("          13m\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 就会发现，死掉的哪一个又活过来了")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("28")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("29")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("30")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("31")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("32")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("33")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("34")]),_c('br')])])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=579.ca6c627a.js.map