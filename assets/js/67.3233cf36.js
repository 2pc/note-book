(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[67],{

/***/ "./docs/cache-pdp/125.md":
/*!*******************************!*\
  !*** ./docs/cache-pdp/125.md ***!
  \*******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _125_md_vue_type_template_id_714a205a___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./125.md?vue&type=template&id=714a205a& */ "./docs/cache-pdp/125.md?vue&type=template&id=714a205a&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _125_md_vue_type_template_id_714a205a___WEBPACK_IMPORTED_MODULE_0__["render"],
  _125_md_vue_type_template_id_714a205a___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/cache-pdp/125.md?vue&type=template&id=714a205a&":
/*!**************************************************************!*\
  !*** ./docs/cache-pdp/125.md?vue&type=template&id=714a205a& ***!
  \**************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_125_md_vue_type_template_id_714a205a___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib??ref--1-1!../../node_modules/@vuepress/markdown-loader??ref--1-2!./125.md?vue&type=template&id=714a205a& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/125.md?vue&type=template&id=714a205a&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_125_md_vue_type_template_id_714a205a___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_125_md_vue_type_template_id_714a205a___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./docs/cache-pdp/assets/markdown-img-paste-20190630143117821.png":
/*!************************************************************************!*\
  !*** ./docs/cache-pdp/assets/markdown-img-paste-20190630143117821.png ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-20190630143117821.c8705b2c.png";

/***/ }),

/***/ "./docs/cache-pdp/assets/markdown-img-paste-20190630143618691.png":
/*!************************************************************************!*\
  !*** ./docs/cache-pdp/assets/markdown-img-paste-20190630143618691.png ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-20190630143618691.1540fb13.png";

/***/ }),

/***/ "./docs/cache-pdp/assets/markdown-img-paste-20190630144024977.png":
/*!************************************************************************!*\
  !*** ./docs/cache-pdp/assets/markdown-img-paste-20190630144024977.png ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-20190630144024977.30afc326.png";

/***/ }),

/***/ "./docs/cache-pdp/assets/markdown-img-paste-2019063014442552.png":
/*!***********************************************************************!*\
  !*** ./docs/cache-pdp/assets/markdown-img-paste-2019063014442552.png ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-2019063014442552.e4f0d2d1.png";

/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/125.md?vue&type=template&id=714a205a&":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/cache-pdp/125.md?vue&type=template&id=714a205a& ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"_125-大型电商网站的商品详情页系统架构是如何一步一步演进的"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#_125-大型电商网站的商品详情页系统架构是如何一步一步演进的"}},[_vm._v("#")]),_vm._v(" 125. 大型电商网站的商品详情页系统架构是如何一步一步演进的")]),_vm._v(" "),_c('p',[_vm._v("商品详情页系统架构演进历程，这里分三个版本来讲解")]),_vm._v(" "),_c('p',[_vm._v("为什么要演进？这个只有经历过才会深刻明白，只要想到成本和时间就明白了，\n在一定的时间和成本下，一般都是从第一个版本开始的，后续根据业务发展，\n用户越来越多，业务越来越复杂，支撑不了的时候，就需要开始改版了")]),_vm._v(" "),_c('h2',{attrs:{"id":"第一个版本"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#第一个版本"}},[_vm._v("#")]),_vm._v(" 第一个版本")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-20190630143117821.png */ "./docs/cache-pdp/assets/markdown-img-paste-20190630143117821.png"),"alt":""}})]),_vm._v(" "),_c('h3',{attrs:{"id":"架构设计"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#架构设计"}},[_vm._v("#")]),_vm._v(" 架构设计")]),_vm._v(" "),_c('p',[_vm._v("J2EE + Tomcat + MySQL")]),_vm._v(" "),_c('p',[_vm._v("动态页面，每次请求都要调用多个依赖服务的接口，从数据库里查询数据，\n然后通过类似 JSP 的技术渲染到 HTML 模板中，返回最终 HTML 页面")]),_vm._v(" "),_c('h3',{attrs:{"id":"架构缺陷"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#架构缺陷"}},[_vm._v("#")]),_vm._v(" 架构缺陷")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("每次请求都是要访问数据库的，性能肯定很差")]),_vm._v(" "),_c('li',[_vm._v("每次请求都要调用大量的依赖服务，依赖服务不稳定导致商品详情页展示的性能经常抖动")])]),_vm._v(" "),_c('h2',{attrs:{"id":"第二个版本"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#第二个版本"}},[_vm._v("#")]),_vm._v(" 第二个版本")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-20190630143618691.png */ "./docs/cache-pdp/assets/markdown-img-paste-20190630143618691.png"),"alt":""}})]),_vm._v(" "),_c('h3',{attrs:{"id":"架构设计-2"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#架构设计-2"}},[_vm._v("#")]),_vm._v(" 架构设计")]),_vm._v(" "),_c('p',[_vm._v("页面静态化技术")]),_vm._v(" "),_c('ul',[_c('li',[_c('p',[_vm._v("通过 MQ 得到商品详情页涉及到的数据的变更消息")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("通过 Java Worker 服务全量调用所有的依赖服务的接口")]),_vm._v(" "),_c('p',[_vm._v("查询数据库，获取到构成一个商品详情页的完整数据，并通过 velocity 等模板技术生成静态 HTML")]),_vm._v(" "),_c('p',[_vm._v("将静态 HTML 页面通过 rsync 工具直接推送到多台 nginx 服务器上，\n每台 nginx 服务器上都有全量的HTML静态页面，nginx 对商品详情页的访问请求直接返回本地的静态 HTML 页面")])])]),_vm._v(" "),_c('h3',{attrs:{"id":"架构缺陷-2"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#架构缺陷-2"}},[_vm._v("#")]),_vm._v(" 架构缺陷")]),_vm._v(" "),_c('ul',[_c('li',[_c('p',[_vm._v("全量更新问题")]),_vm._v(" "),_c('p',[_vm._v("如果某一个商品分类、商家等信息变更了")]),_vm._v(" "),_c('p',[_vm._v("那么那个分类、店铺、商家下面所有的商品详情页都需要重新生成静态 HTML 页面")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("更新速度过慢问题")]),_vm._v(" "),_c('p',[_vm._v("分类、店铺、商家、商品越来越多，重新生成 HTML 的负载越来越高，rsync 全量同步所有 nginx 的负载也越来越高")]),_vm._v(" "),_c('p',[_vm._v("从数据变更到生成静态 HTML，再到全量同步到所有 nginx，时间越来越慢")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("扩容问题")]),_vm._v(" "),_c('p',[_vm._v("因为每个商品详情页都要全量同步到所有的 nginx 上，导致系统无法扩容，无法增加系统容量")])])]),_vm._v(" "),_c('h3',{attrs:{"id":"架构优化"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#架构优化"}},[_vm._v("#")]),_vm._v(" 架构优化")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-20190630144024977.png */ "./docs/cache-pdp/assets/markdown-img-paste-20190630144024977.png"),"alt":""}})]),_vm._v(" "),_c('ul',[_c('li',[_c('p',[_vm._v("解决全量更新问题（维度化）")]),_vm._v(" "),_c('p',[_vm._v("每次 Java Worker 收到某个维度的变更消息，不是拉去全量维度并生成完整 HTML，而是按照维度拆分，\n生成一个变化维度的 HTML 片段")]),_vm._v(" "),_c('p',[_vm._v("nginx 对多个 HTML 片段通过 SSI 合并 html 片段然后输出一个完整的 html")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("解决扩容问题（集群化，每台机器负责其中一部分）")]),_vm._v(" "),_c('p',[_vm._v("每个商品详情页不是全量同步到所有的 nginx")]),_vm._v(" "),_c('p',[_vm._v("而是根据商品 id 路由到某一台 nginx 上，同时接入层 nginx 按照相同的逻辑路由请求")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("解决更新速度过慢问题（增加更多机器资源）")]),_vm._v(" "),_c('p',[_vm._v("多机房部署，每个机房部署一套 Java Worker + 应用 Nginx，\n所有机房用一套负载均衡设备，在每个机房内部完成全流程，不跨机房")])])]),_vm._v(" "),_c('h3',{attrs:{"id":"架构优化后的缺陷"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#架构优化后的缺陷"}},[_vm._v("#")]),_vm._v(" 架构优化后的缺陷")]),_vm._v(" "),_c('ul',[_c('li',[_c('p',[_vm._v("更新速度还是不够快的问题")]),_vm._v(" "),_c('p',[_vm._v("商品的每个维度都有一个 HTML 片段，rsync 推送大量的 HTML 片段，负载太高，性能较差")]),_vm._v(" "),_c('p',[_vm._v("Nginx 基于机械硬盘进行 SSI 合并，性能太差")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("还是存在全量更新的问题")]),_vm._v(" "),_c('p',[_vm._v("虽然解决了分类、商家、店铺维度的变更，只要增量重新生产较小的 HTML 片段即可，\n不用全量重新生成关联的所有商品详情页的 HTML")]),_vm._v(" "),_c('p',[_vm._v("但是如果某个页面模板变更，或者新加入一个页面模板，还是会导致几亿个商品的 HTML 片段都要重新生成和 rsync，\n要几天时间才能完成，无法响应需求")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("还是存在容量问题")]),_vm._v(" "),_c('p',[_vm._v("nginx 存储有限，不能无限存储几亿，以及增长的商品详情页的 HTML 文件")]),_vm._v(" "),_c('p',[_vm._v("如果 nginx 存储达到极限，需要删除部分商品详情页的 HTML 文件，改成 nginx 找不到 HTML，\n则调用后端接口，回到动态页面的架构")]),_vm._v(" "),_c('p',[_vm._v("动态页面架构在高并发访问的情况下，会对依赖系统造成过大的压力，几乎扛不住")])])]),_vm._v(" "),_c('h2',{attrs:{"id":"第三个版本"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#第三个版本"}},[_vm._v("#")]),_vm._v(" 第三个版本")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-2019063014442552.png */ "./docs/cache-pdp/assets/markdown-img-paste-2019063014442552.png"),"alt":""}})]),_vm._v(" "),_c('h3',{attrs:{"id":"需要支持的需求"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#需要支持的需求"}},[_vm._v("#")]),_vm._v(" 需要支持的需求")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("迅速响应各种页面模板的改版和个性化需求的新模板的加入")]),_vm._v(" "),_c('li',[_vm._v("页面模块化，页面中的某个区域变化，只要更新这个区域中的数据即可")]),_vm._v(" "),_c('li',[_vm._v("支持高性能访问")]),_vm._v(" "),_c('li',[_vm._v("支持水平扩容的伸缩性架构")])]),_vm._v(" "),_c('h3',{attrs:{"id":"系统架构设计"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#系统架构设计"}},[_vm._v("#")]),_vm._v(" 系统架构设计")]),_vm._v(" "),_c('ol',[_c('li',[_c('p',[_vm._v("依赖服务有数据变更发送消息到 MQ")])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("监听数据变更事件，写入缓存")]),_vm._v(" "),_c('p',[_vm._v("数据异构 Worker 服务监听 MQ 中的变更消息，调用依赖服务的接口，仅仅拉取有变更的数据即可，然后将数据存储到 redis 中")]),_vm._v(" "),_c('p',[_vm._v("数据异构 Worker 存储到 redis 中都是原子未加工数据，包括商品基本信息、商品扩展属性、\n商品其他信息、商品规格参数、商品分类、商家信息")]),_vm._v(" "),_c('p',[_vm._v("数据异构 Worker 发送消息到 MQ，数据聚合 Worker 监听到 MQ 消息")]),_vm._v(" "),_c('p',[_vm._v("数据聚合 Worker 将原子数据从 redis 中取出，按照维度聚合后存储到 redis 中，包括三个维度")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("基本信息维度：基本信息、扩展属性\n- 商品介绍：PC 版、移动版\n- 其他信息：商品分类、商家信息")])]),_vm._v(" "),_c('p',[_vm._v("nginx+lua：lua 从 redis 读取商品各个维度的数据，通过 nginx 动态渲染到 html 模板中，然后输出最终的 html")])])]),_vm._v(" "),_c('p',[_vm._v("简单说最大的变化就是：使用上了缓存、html 是通过模板动态渲染的")]),_vm._v(" "),_c('h3',{attrs:{"id":"如何解决的问题"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#如何解决的问题"}},[_vm._v("#")]),_vm._v(" 如何解决的问题")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("更新问题：不再是生成和推送 html 片段了，不再需要合成 html，直接数据更新到 redis，然后走动态渲染，性能大大提升")]),_vm._v(" "),_c('li',[_vm._v("全量更新问题：数据和模板分离，数据更新呢就更新数据，模板更新直接推送模板到 nginx，不需要重新生成所有 html，直接走动态渲染")]),_vm._v(" "),_c('li',[_vm._v("容量问题：不需要依赖 nginx 所在机器的磁盘空间存储大量的 html，将数据放 redis，html 就存放模板，大大减少空间占用，而且 redis 集群可扩容")])]),_vm._v(" "),_c('h2',{attrs:{"id":"小结"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#小结"}},[_vm._v("#")]),_vm._v(" 小结")]),_vm._v(" "),_c('p',[_vm._v("从三个版本架构的演进来看，其实就是由一个从简到繁，不停的打补丁，最后打补丁都无法解决了，\n才明白问题是出在根源上：没有使用缓存！")]),_vm._v(" "),_c('p',[_vm._v("当第三个版本的时候，使用上了缓存，整个架构从根上就开始变化，后续的手段都是基于这个变化而变化的。")])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=67.3233cf36.js.map