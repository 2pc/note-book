(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[68],{

/***/ "./docs/cache-pdp/dr/153.md":
/*!**********************************!*\
  !*** ./docs/cache-pdp/dr/153.md ***!
  \**********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _153_md_vue_type_template_id_b72ef6d2___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./153.md?vue&type=template&id=b72ef6d2& */ "./docs/cache-pdp/dr/153.md?vue&type=template&id=b72ef6d2&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _153_md_vue_type_template_id_b72ef6d2___WEBPACK_IMPORTED_MODULE_0__["render"],
  _153_md_vue_type_template_id_b72ef6d2___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/cache-pdp/dr/153.md?vue&type=template&id=b72ef6d2&":
/*!*****************************************************************!*\
  !*** ./docs/cache-pdp/dr/153.md?vue&type=template&id=b72ef6d2& ***!
  \*****************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_153_md_vue_type_template_id_b72ef6d2___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib??ref--1-1!../../../node_modules/@vuepress/markdown-loader??ref--1-2!./153.md?vue&type=template&id=b72ef6d2& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/dr/153.md?vue&type=template&id=b72ef6d2&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_153_md_vue_type_template_id_b72ef6d2___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_153_md_vue_type_template_id_b72ef6d2___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./docs/cache-pdp/dr/assets/markdown-img-paste-2019081122155195.png":
/*!**************************************************************************!*\
  !*** ./docs/cache-pdp/dr/assets/markdown-img-paste-2019081122155195.png ***!
  \**************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-2019081122155195.a2239e19.png";

/***/ }),

/***/ "./docs/cache-pdp/dr/assets/markdown-img-paste-20190811221717816.png":
/*!***************************************************************************!*\
  !*** ./docs/cache-pdp/dr/assets/markdown-img-paste-20190811221717816.png ***!
  \***************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-20190811221717816.604a7ebf.png";

/***/ }),

/***/ "./docs/cache-pdp/dr/assets/markdown-img-paste-20190811234102115.png":
/*!***************************************************************************!*\
  !*** ./docs/cache-pdp/dr/assets/markdown-img-paste-20190811234102115.png ***!
  \***************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-20190811234102115.63d04efa.png";

/***/ }),

/***/ "./docs/cache-pdp/dr/assets/markdown-img-paste-20190811235544729.png":
/*!***************************************************************************!*\
  !*** ./docs/cache-pdp/dr/assets/markdown-img-paste-20190811235544729.png ***!
  \***************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-20190811235544729.a30a5980.png";

/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/cache-pdp/dr/153.md?vue&type=template&id=b72ef6d2&":
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/cache-pdp/dr/153.md?vue&type=template&id=b72ef6d2& ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"_153-商品详情页动态渲染系统-spring-cloud-之-hystrix-熔断降级"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#_153-商品详情页动态渲染系统-spring-cloud-之-hystrix-熔断降级"}},[_vm._v("#")]),_vm._v(" 153. 商品详情页动态渲染系统：Spring Cloud 之 Hystrix 熔断降级")]),_vm._v(" "),_c('p',[_vm._v("微服务架构，很重要的就是多个服务之间互相调用，很可能某个服务就死了，然后依赖它的其他服务调用大量超时，最后耗尽资源，继续死，最终导致整个系统崩盘")]),_vm._v(" "),_c('p',[_vm._v("使用 hystrix 去做资源隔离、限流、熔断、降级")]),_vm._v(" "),_c('h2',{attrs:{"id":"整合-hystrix"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#整合-hystrix"}},[_vm._v("#")]),_vm._v(" 整合 hystrix")]),_vm._v(" "),_c('p',[_vm._v("添加依赖")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("// 注：spring-cloud-starter-netflix-eureka-client 中已经依赖了 ribbon、hystrix、openfeign\ncompile 'org.springframework.cloud:spring-cloud-starter-netflix-hystrix'\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br')])]),_c('p',[_vm._v("开启 hystrix")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("feign")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("hystrix")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("enabled")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token boolean important"}},[_vm._v("true")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br')])]),_c('p',[_vm._v("配置与降级逻辑实现")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@FeignClient")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("name "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"eshop-eurela-client\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" fallback "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("EurelaClientServiceFallback")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("class")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("interface")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("EurelaClientService")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@GetMapping")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"/\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("home")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@RequestParam")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("name "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"name\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" name"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@Component")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("class")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("EurelaClientServiceFallback")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("implements")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("EurelaClientService")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n\n    "),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@Override")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("home")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" name"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"error \"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" name"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br')])]),_c('p',[_vm._v("测试步骤：")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("重启项目后访问地址 http://localhost:9005/ 查看是否能访问")]),_vm._v(" "),_c('li',[_vm._v("关闭掉 eshop-eurela-client 实例")]),_vm._v(" "),_c('li',[_vm._v("再次访问 http://localhost:9005/ 查看是否走了降级机制")])]),_vm._v(" "),_c('p',[_vm._v("在测试过程中发现如下特性：")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("当其中一个实例关闭时，第一次访问到挂掉的实例时会走降级机制，后续就不会再访问到该实例了")]),_vm._v(" "),_c('li',[_vm._v("2 个实例都挂掉时，肯定每次访问都是走降级机制了")]),_vm._v(" "),_c('li',[_vm._v("当实例恢复后，又可以正常提供服务了")])]),_vm._v(" "),_c('h2',{attrs:{"id":"hystrix-dashboard-整合"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#hystrix-dashboard-整合"}},[_vm._v("#")]),_vm._v(" hystrix dashboard 整合")]),_vm._v(" "),_c('p',[_vm._v("添加依赖")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("// https://cloud.spring.io/spring-cloud-netflix/reference/html/#_how_to_include_hystrix\n// https://cloud.spring.io/spring-cloud-static/Greenwich.SR2/single/spring-cloud.html#_circuit_breaker_hystrix_dashboard\ncompile 'org.springframework.cloud:spring-cloud-starter-netflix-hystrix-dashboard'\ncompile 'org.springframework.boot:spring-boot-starter-actuator'\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])]),_c('p',[_vm._v("注解开启")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("@EnableHystrixDashboard\n@EnableCircuitBreaker\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br')])]),_c('p',[_vm._v("hystrix dashboard ui 使用")]),_vm._v(" "),_c('ul',[_c('li',[_c('p',[_vm._v("访问地址："),_c('code',[_vm._v("http://localhost:9005/hystrix")])])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("填入要监控的服务："),_c('code',[_vm._v("http://localhost:9005/actuator/hystrix.stream")])]),_vm._v(" "),_c('p',[_vm._v("由于我们在 greeting-service 上开启了 CircuitBreaker 断路器，它就会提供一个 "),_c('code',[_vm._v("/hystrix.stream")]),_vm._v(" 服务,\n通过这个服务，dashboard 就能拿到 greeting-service 上断路器状态数据并进行聚合展示了")])])]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-20190811221717816.png */ "./docs/cache-pdp/dr/assets/markdown-img-paste-20190811221717816.png"),"alt":""}})]),_vm._v(" "),_c('h2',{attrs:{"id":"hystrix-stream-404-问题解决"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#hystrix-stream-404-问题解决"}},[_vm._v("#")]),_vm._v(" /hystrix.stream 404 问题解决")]),_vm._v(" "),_c('p',[_vm._v("但是在访问 "),_c('code',[_vm._v("/hystrix.stream")]),_vm._v(" ，这是因为 boot 2 使用了 endpoint 来管理这些扩展端点，这个配置就是 actuator 包来自动配置的。\n暴露该端点")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("management")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("endpoints")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("web")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("exposure")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 暴露所有端点")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("include")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'*'")]),_vm._v("  "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 或者单独暴露 /hystrix.stream 断点")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br')])]),_c('p',[_vm._v("配置之后还是发现无法访问，最后在 dashboard ui 中看到了正确的地址")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("https://hystrix-app:port/actuator/hystrix.stream\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br')])]),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-2019081122155195.png */ "./docs/cache-pdp/dr/assets/markdown-img-paste-2019081122155195.png"),"alt":""}})]),_vm._v(" "),_c('h2',{attrs:{"id":"改造被调用服务也支持-hystrix"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#改造被调用服务也支持-hystrix"}},[_vm._v("#")]),_vm._v(" 改造被调用服务也支持 hystrix")]),_vm._v(" "),_c('p',[_vm._v("添加依赖等配置与上面的一致，唯一不同的一点就是下面这个。\n手动让自己提供服务的方法也支持 hystrix 的管控")]),_vm._v(" "),_c('p',[_vm._v("eshop-eurela-client 项目")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@RequestMapping")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"/\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@HystrixCommand")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("fallbackMethod "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"sayHello\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("home")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" name"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 注意，前面在 greeting-service 中调用没有传递相关参数")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 这里为了模拟异常，已添加上")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("if")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("name "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("!=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("null")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("&&")]),_vm._v(" name"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("equals")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"error\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("throw")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("RuntimeException")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"故意异常走降级机制\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"Hello world port \"")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("+")]),_vm._v(" port"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("public")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("sayHello")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("String")]),_vm._v(" name"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("return")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"降级机制\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br')])]),_c('p',[_vm._v("之前已经深入讲解过 hystrix 了，这里不再多说，这里只是使用了注解方式让我们自己的方法使用上 hystrix")]),_vm._v(" "),_c('p',[_vm._v("测试：访问地址 http://localhost:9005/?name=error，可以看到输出了 "),_c('code',[_vm._v("降级机制")])]),_vm._v(" "),_c('h2',{attrs:{"id":"turbine-hystrix-dashboard-集群聚合服务"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#turbine-hystrix-dashboard-集群聚合服务"}},[_vm._v("#")]),_vm._v(" turbine （hystrix dashboard 集群聚合服务）")]),_vm._v(" "),_c('p',[_c('a',{attrs:{"href":"https://cloud.spring.io/spring-cloud-static/Greenwich.SR2/single/spring-cloud.html#_turbine","target":"_blank","rel":"noopener noreferrer"}},[_vm._v("此方式在官网教程也有讲解"),_c('OutboundLink')],1)]),_vm._v(" "),_c('p',[_vm._v("turbine 只是一个聚合 hystrix dashboard stream 的服务，前面讲解的是单实例的 hystrix dashboard stream 支持。")]),_vm._v(" "),_c('div',{staticClass:"custom-block tip"},[_c('p',{staticClass:"custom-block-title"},[_vm._v("TIP")]),_vm._v(" "),_c('p',[_vm._v("这里只要注意 turbine 不要部署在但实例 hystrix dashboard 上，\n因为它是聚合多个流，一般建议建立一个空项目来开启 turbine")])]),_vm._v(" "),_c('p',[_vm._v("新创建一个项目 eshop-turbine")]),_vm._v(" "),_c('p',[_vm._v("eshop-turbine/build.gradle")]),_vm._v(" "),_c('div',{staticClass:"language-groovy line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-groovy"}},[_c('code',[_vm._v("plugins "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    id "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'org.springframework.boot'")]),_vm._v(" version "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'2.1.6.RELEASE'")]),_vm._v("\n    id "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'java'")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\napply plugin"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'io.spring.dependency-management'")]),_vm._v("\n\next "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("set")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'springCloudVersion'")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string gstring"}},[_vm._v("\"Greenwich.SR2\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\ndependencies "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    implementation "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'org.springframework.cloud:spring-cloud-starter-netflix-eureka-client'")]),_vm._v("\n    implementation "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'org.springframework.boot:spring-boot-starter-web'")]),_vm._v("\n    testImplementation "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'org.springframework.boot:spring-boot-starter-test'")]),_vm._v("\n    compile "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'org.springframework.boot:spring-boot-starter-actuator'")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 添加 turbine 自动配置")]),_vm._v("\n    compile "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'org.springframework.cloud:spring-cloud-starter-netflix-turbine'")]),_vm._v("\n    compile "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'org.springframework.cloud:spring-cloud-netflix-turbine'")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\ndependencyManagement "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    imports "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        mavenBom "),_c('span',{pre:true,attrs:{"class":"token string gstring"}},[_vm._v("\"org.springframework.cloud:spring-cloud-dependencies:"),_c('span',{pre:true,attrs:{"class":"token expression"}},[_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("$")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("springCloudVersion"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")])]),_vm._v("\"")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("27")]),_c('br')])]),_c('p',[_vm._v("使用注解开启")]),_vm._v(" "),_c('div',{staticClass:"language-java line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-java"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token annotation punctuation"}},[_vm._v("@EnableTurbine")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br')])]),_c('p',[_vm._v("application.yml")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("server")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("port")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("9007")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("spring")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("application")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("name")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" eshop"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("turbine\n\n"),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("eureka")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("client")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("serviceUrl")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("defaultZone")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" http"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("//localhost"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("8761/eureka/\n\n"),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("management")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("endpoints")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("web")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("exposure")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("include")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'*'")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("turbine")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 要聚合的服务")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("app-config")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" ESHOP"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("EURELA"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("CLIENT"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("GREETING"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("SERVICE\n  "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 聚合集群配置，其他客户端没有配置，则这里使用默认")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 注意下面的配置非常重要，否则访问 http://localhost:9007/clusters 不会出现任何 /urbine.stream 地址")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("aggregator")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("cluster-config")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" default\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("cluster-name-expression")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"'default'\"")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("20")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("21")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("22")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("23")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("24")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("25")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("26")]),_c('br')])]),_c('p',[_vm._v("启动项目后可访问如下地址：")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("turbine 支持聚合的服务地址： http://localhost:9007/clusters")]),_vm._v(" "),_c('li',[_vm._v("聚合流：http://localhost:9007/turbine.stream")])]),_vm._v(" "),_c('p',[_vm._v("在任意一个支持  hystrix dashboard ui 上填入这里的聚合流地址，都能监控所有已配置的服务")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-20190811234102115.png */ "./docs/cache-pdp/dr/assets/markdown-img-paste-20190811234102115.png"),"alt":""}})]),_vm._v(" "),_c('p',[_vm._v("可以从图上看到，通过这里的默认配置，把集群中的所有断路器名称都拿过来聚合了，\n这里也看到有一丝乱，因为集群没有分开，所以导致看到的是所有服务的")]),_vm._v(" "),_c('h3',{attrs:{"id":"分集群聚合"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#分集群聚合"}},[_vm._v("#")]),_vm._v(" 分集群聚合")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("turbine")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 要聚合的服务")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("app-config")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" ESHOP"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("EURELA"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("CLIENT"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("GREETING"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("SERVICE\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("aggregator")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("cluster-config")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" eshop"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("eurela"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("client\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("clusterNameExpression")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" metadata"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'cluster'")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br')])]),_c('p',[_vm._v("具体的客户端需要通过如下配置暴露自己的集群名称")]),_vm._v(" "),_c('div',{staticClass:"language-yml line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-yml"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("eureka")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("client")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("serviceUrl")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("defaultZone")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" http"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("//localhost"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("8761/eureka/\n  "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("instance")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("metadata-map")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 这里的 cluster 对应了 clusterNameExpression 中的 metadata['cluster'] 表达式要获取的字段")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("# 而这里的 eshop-eurela-client 则对应了 cluster-config 中的值")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token key atrule"}},[_vm._v("cluster")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(":")]),_vm._v(" eshop"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("eurela"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("-")]),_vm._v("client\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br')])]),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-20190811235544729.png */ "./docs/cache-pdp/dr/assets/markdown-img-paste-20190811235544729.png"),"alt":""}})]),_vm._v(" "),_c('p',[_vm._v("现在就把 client 项目中的数据分离开来聚合统计显示了")])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=68.fdddc8a3.js.map