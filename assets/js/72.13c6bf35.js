(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[72],{

/***/ "./docs/elasticsearch-core/distributed-document/18-concurrent-update.md":
/*!******************************************************************************!*\
  !*** ./docs/elasticsearch-core/distributed-document/18-concurrent-update.md ***!
  \******************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _18_concurrent_update_md_vue_type_template_id_b257a6f8___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./18-concurrent-update.md?vue&type=template&id=b257a6f8& */ "./docs/elasticsearch-core/distributed-document/18-concurrent-update.md?vue&type=template&id=b257a6f8&");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

var script = {}


/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_1__["default"])(
  script,
  _18_concurrent_update_md_vue_type_template_id_b257a6f8___WEBPACK_IMPORTED_MODULE_0__["render"],
  _18_concurrent_update_md_vue_type_template_id_b257a6f8___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./docs/elasticsearch-core/distributed-document/18-concurrent-update.md?vue&type=template&id=b257a6f8&":
/*!*************************************************************************************************************!*\
  !*** ./docs/elasticsearch-core/distributed-document/18-concurrent-update.md?vue&type=template&id=b257a6f8& ***!
  \*************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_18_concurrent_update_md_vue_type_template_id_b257a6f8___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib??ref--1-1!../../../node_modules/@vuepress/markdown-loader??ref--1-2!./18-concurrent-update.md?vue&type=template&id=b257a6f8& */ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/elasticsearch-core/distributed-document/18-concurrent-update.md?vue&type=template&id=b257a6f8&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_18_concurrent_update_md_vue_type_template_id_b257a6f8___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_cache_loader_dist_cjs_js_cacheDirectory_node_modules_vuepress_core_node_modules_cache_vuepress_cacheIdentifier_2e9acca5_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_cache_loader_dist_cjs_js_ref_1_0_node_modules_vue_loader_lib_index_js_ref_1_1_node_modules_vuepress_markdown_loader_index_js_ref_1_2_18_concurrent_update_md_vue_type_template_id_b257a6f8___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106131626576.png":
/*!******************************************************************************************************!*\
  !*** ./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106131626576.png ***!
  \******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-20190106131626576.3037a111.png";

/***/ }),

/***/ "./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106134912696.png":
/*!******************************************************************************************************!*\
  !*** ./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106134912696.png ***!
  \******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-20190106134912696.64b9f4e3.png";

/***/ }),

/***/ "./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106135147969.png":
/*!******************************************************************************************************!*\
  !*** ./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106135147969.png ***!
  \******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-20190106135147969.014388b3.png";

/***/ }),

/***/ "./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106141919670.png":
/*!******************************************************************************************************!*\
  !*** ./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106141919670.png ***!
  \******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/img/markdown-img-paste-20190106141919670.1f29ca94.png";

/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/@vuepress/core/node_modules/.cache/vuepress\",\"cacheIdentifier\":\"2e9acca5-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/cache-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/@vuepress/markdown-loader/index.js?!./docs/elasticsearch-core/distributed-document/18-concurrent-update.md?vue&type=template&id=b257a6f8&":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"2e9acca5-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./docs/elasticsearch-core/distributed-document/18-concurrent-update.md?vue&type=template&id=b257a6f8& ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('h1',{attrs:{"id":"并发更新冲突"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#并发更新冲突"}},[_vm._v("#")]),_vm._v(" 并发更新冲突")]),_vm._v(" "),_c('p',[_vm._v("本章记录 5 个小结的笔记；他们都是讲解如何解决更新冲突")]),_vm._v(" "),_c('p'),_c('div',{staticClass:"table-of-contents"},[_c('ul',[_c('li',[_c('a',{attrs:{"href":"#深度图解剖析-elasticsearch-并发冲突问题"}},[_vm._v("深度图解剖析 Elasticsearch 并发冲突问题")])]),_c('li',[_c('a',{attrs:{"href":"#深度图解剖析悲观锁与乐观锁两种并发控制方案"}},[_vm._v("深度图解剖析悲观锁与乐观锁两种并发控制方案")]),_c('ul',[_c('li',[_c('a',{attrs:{"href":"#悲观锁"}},[_vm._v("悲观锁")])]),_c('li',[_c('a',{attrs:{"href":"#乐观锁"}},[_vm._v("乐观锁")])]),_c('li',[_c('a',{attrs:{"href":"#优缺点"}},[_vm._v("优缺点")])])])]),_c('li',[_c('a',{attrs:{"href":"#图解-elasticsearch-内部基于-version-如何进行乐观锁并发控制"}},[_vm._v("图解 Elasticsearch 内部基于 _version 如何进行乐观锁并发控制")])]),_c('li',[_c('a',{attrs:{"href":"#实战-version-进行乐观锁并发控制"}},[_vm._v("实战 _version 进行乐观锁并发控制")])]),_c('li',[_c('a',{attrs:{"href":"#实战-external-version-进行乐观锁并发控"}},[_vm._v("实战 external version 进行乐观锁并发控")]),_c('ul',[_c('li',[_c('a',{attrs:{"href":"#语法"}},[_vm._v("语法")])])])])])]),_c('p'),_vm._v(" "),_c('ul',[_c('li',[_vm._v("18-深度图解剖析 Elasticsearch 并发冲突问题")]),_vm._v(" "),_c('li',[_vm._v("19-深度图解剖析悲观锁与乐观锁两种并发控制方案")]),_vm._v(" "),_c('li',[_vm._v("20-图解 Elasticsearch 内部基于 "),_c('code',[_vm._v("_version")]),_vm._v(" 如何进行乐观锁并发控制")]),_vm._v(" "),_c('li',[_vm._v("21-上机动手实战演练基于"),_c('code',[_vm._v("_version")]),_vm._v("进行乐观锁并发控制")]),_vm._v(" "),_c('li',[_vm._v("22-上机动手实战演练基于 external version 进行乐观锁并发控制")])]),_vm._v(" "),_c('h2',{attrs:{"id":"深度图解剖析-elasticsearch-并发冲突问题"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#深度图解剖析-elasticsearch-并发冲突问题"}},[_vm._v("#")]),_vm._v(" 深度图解剖析 Elasticsearch 并发冲突问题")]),_vm._v(" "),_c('p',[_vm._v("并发修改这个在很多数据库中都存在问题，一个场景：")]),_vm._v(" "),_c('p',[_vm._v("一个商品库存是 2 个，一共 3 个人购买，3个人同时下单，如果没有并发控制，那么久会超卖。")]),_vm._v(" "),_c('p',[_vm._v("为什么会超卖，这个就太基础了，不记录笔记了；")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-20190106131626576.png */ "./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106131626576.png"),"alt":""}})]),_vm._v(" "),_c('h2',{attrs:{"id":"深度图解剖析悲观锁与乐观锁两种并发控制方案"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#深度图解剖析悲观锁与乐观锁两种并发控制方案"}},[_vm._v("#")]),_vm._v(" 深度图解剖析悲观锁与乐观锁两种并发控制方案")]),_vm._v(" "),_c('h3',{attrs:{"id":"悲观锁"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#悲观锁"}},[_vm._v("#")]),_vm._v(" 悲观锁")]),_vm._v(" "),_c('p',[_vm._v("悲观锁：通过锁定某一条数据（独占），进行解决并发控制")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-20190106134912696.png */ "./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106134912696.png"),"alt":""}})]),_vm._v(" "),_c('h3',{attrs:{"id":"乐观锁"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#乐观锁"}},[_vm._v("#")]),_vm._v(" 乐观锁")]),_vm._v(" "),_c('p',[_vm._v("乐观锁：不加锁，通过条件（版本号）来更新数据；")]),_vm._v(" "),_c('p',[_vm._v("大致流程：")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("version = 1; 期望版本等于 1 的时候更新数据")]),_vm._v(" "),_c('li',[_vm._v("如果此时数据库中的数据版本变为了 2，那么此时不更新")]),_vm._v(" "),_c('li',[_vm._v("再次获取数据的版本号，再重复第 1、2步。")])]),_vm._v(" "),_c('div',{staticClass:"custom-block tip"},[_c('p',{staticClass:"custom-block-title"},[_vm._v("TIP")]),_vm._v(" "),_c('p',[_vm._v("关于条件更新：是需要依赖数据库的按指定条件更新的功能，而不是自行在程序中处理")])]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-20190106135147969.png */ "./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106135147969.png"),"alt":""}})]),_vm._v(" "),_c('h3',{attrs:{"id":"优缺点"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#优缺点"}},[_vm._v("#")]),_vm._v(" 优缺点")]),_vm._v(" "),_c('p',[_c('strong',[_vm._v("悲观锁")]),_vm._v("：")]),_vm._v(" "),_c('p',[_vm._v("优点：")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("方便，直接加锁")]),_vm._v(" "),_c('li',[_vm._v("对程序透明，不需要做额外操作")])]),_vm._v(" "),_c('p',[_vm._v("缺点：并发能力很低，同一时间只能有一条线程操作数据")]),_vm._v(" "),_c('p',[_c('strong',[_vm._v("乐观锁")]),_vm._v("：")]),_vm._v(" "),_c('p',[_vm._v("优点")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("并发能力很高，不给数据加锁")]),_vm._v(" "),_c('li',[_vm._v("大量线程并发操作")])]),_vm._v(" "),_c('p',[_vm._v("缺点：")]),_vm._v(" "),_c('ul',[_c('li',[_vm._v("麻烦，每次更新都要对比版本号")]),_vm._v(" "),_c('li',[_vm._v("可能多次加载数据，再次修改")])]),_vm._v(" "),_c('h2',{attrs:{"id":"图解-elasticsearch-内部基于-version-如何进行乐观锁并发控制"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#图解-elasticsearch-内部基于-version-如何进行乐观锁并发控制"}},[_vm._v("#")]),_vm._v(" 图解 Elasticsearch 内部基于 "),_c('code',[_vm._v("_version")]),_vm._v(" 如何进行乐观锁并发控制")]),_vm._v(" "),_c('p',[_vm._v("前面说的是概念，现在说说 es 内部对于并发修改是如何控制的；")]),_vm._v(" "),_c('p',[_c('code',[_vm._v("_version")]),_vm._v(" 的产生：在创建的时候值为 0 ，在修改和删除的时候回自动增加 1")]),_vm._v(" "),_c('p',[_vm._v("es 内部是基于 "),_c('code',[_vm._v("_version")]),_vm._v(" 版本号控制。")]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":__webpack_require__(/*! ./assets/markdown-img-paste-20190106141919670.png */ "./docs/elasticsearch-core/distributed-document/assets/markdown-img-paste-20190106141919670.png"),"alt":""}})]),_vm._v(" "),_c('p',[_vm._v("对于上图流程总结：")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("假设 a 操作修改条件是 version = 1;")]),_vm._v(" "),_c('li',[_vm._v("假设 b 操作修改条件也是 version = 1；")]),_vm._v(" "),_c('li',[_vm._v("那一条数据被先执行则生效，后到的则被丢弃")])]),_vm._v(" "),_c('p',[_vm._v("反正这一小节还是没有解决我心中的疑惑， es 到底是怎么实现并发版本的控制的，如果不加锁，怎么保证获取数据，再修改版本号的原子操作？")]),_vm._v(" "),_c('p',[_vm._v("对于 "),_c('a',{attrs:{"href":"https://blog.csdn.net/mmoren/article/details/79185862","target":"_blank","rel":"noopener noreferrer"}},[_vm._v("cas"),_c('OutboundLink')],1),_vm._v(" 在同一台机器中是硬件保证的，那么对于 es 这种分布式的呢？我没有明白")]),_vm._v(" "),_c('h2',{attrs:{"id":"实战-version-进行乐观锁并发控制"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#实战-version-进行乐观锁并发控制"}},[_vm._v("#")]),_vm._v(" 实战 "),_c('code',[_vm._v("_version")]),_vm._v(" 进行乐观锁并发控制")]),_vm._v(" "),_c('p',[_vm._v("实战的步骤也很简单，利用 es api 进行操作；")]),_vm._v(" "),_c('ol',[_c('li',[_c('p',[_vm._v("先添加一条数据,此时 version = 1")]),_vm._v(" "),_c('div',{staticClass:"language-json line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-json"}},[_c('code',[_vm._v("PUT /test_index/test_type/"),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("7")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"test_field\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"test test\"")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("带上 version = 1 更新数据，客户端1 更新成功")]),_vm._v(" "),_c('div',{staticClass:"language-json line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-json"}},[_c('code',[_vm._v("PUT /test_index/test_type/"),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("7")]),_vm._v("?version="),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"test_field\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"test client 1\"")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("带上 version = 1 更新数据")]),_vm._v(" "),_c('div',{staticClass:"language-json line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-json"}},[_c('code',[_vm._v("PUT /test_index/test_type/"),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("7")]),_vm._v("?version="),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("1")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"test_field\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"test client 2\"")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])]),_c('p',[_vm._v("因为客户端1 已结更新成功，那么此时再用版本1 更新将会返回失败信息")]),_vm._v(" "),_c('div',{staticClass:"language-json line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-json"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"error\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"root_cause\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("[")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"type\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"version_conflict_engine_exception\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"reason\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"[test_type][7]: version conflict, current version [2] is different than the one provided [1]\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"index_uuid\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"g4RJx2v8TXK95LdwlhRx5A\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"shard\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"0\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("\n        "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"index\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"test_index\"")]),_vm._v("\n      "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("]")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"type\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"version_conflict_engine_exception\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"reason\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"[test_type][7]: version conflict, current version [2] is different than the one provided [1]\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"index_uuid\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"g4RJx2v8TXK95LdwlhRx5A\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"shard\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"0\"")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("\n    "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"index\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("\"test_index\"")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(",")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token property"}},[_vm._v("\"status\"")]),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v(":")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("409")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("13")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("14")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("15")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("16")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("17")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("18")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("19")]),_c('br')])]),_c('p',[_vm._v("那么想要这条数据更新成功怎么办呢？\n需要获取到这条数据的版本号，再带上新的版本号去更新即可")])])]),_vm._v(" "),_c('p',[_vm._v("那么此次更新步骤就是 jdk 中的 cas，在并发频繁的时候，该步骤可能要尝试好多次才能更新进去")]),_vm._v(" "),_c('h2',{attrs:{"id":"实战-external-version-进行乐观锁并发控"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#实战-external-version-进行乐观锁并发控"}},[_vm._v("#")]),_vm._v(" 实战 external version 进行乐观锁并发控")]),_vm._v(" "),_c('p',[_c('strong',[_vm._v("external version 是什么？")])]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("这个值不是 es 中的 "),_c('code',[_vm._v("_version")]),_vm._v(",是你自己维护的（比如 mysql 中数据的版本）")]),_vm._v(" "),_c('li',[_vm._v("但是提供的值是与 es 中的 "),_c('code',[_vm._v("_version")]),_vm._v(" 比较的")]),_vm._v(" "),_c('li',[_vm._v("提供的值必须比 "),_c('code',[_vm._v("_vesion")]),_vm._v(" 的值大，才能更新成功")])]),_vm._v(" "),_c('div',{staticClass:"custom-block tip"},[_c('p',{staticClass:"custom-block-title"},[_vm._v("TIP")]),_vm._v(" "),_c('p',[_vm._v("内部版本号并发控制策略是提供的版本号必须一致才能更新成功")])]),_vm._v(" "),_c('h3',{attrs:{"id":"语法"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#语法"}},[_vm._v("#")]),_vm._v(" 语法")]),_vm._v(" "),_c('div',{staticClass:"language- line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-text"}},[_c('code',[_vm._v("?version\n?version=1&version_type=externalon=1\n\n只是多了一个 type ，其他的都是一致的，除了上面说的值比较有区别外\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br')])])])}
var staticRenderFns = []



/***/ })

}]);
//# sourceMappingURL=72.13c6bf35.js.map